<!DOCTYPE html>

<html>
<head>
  <title>expr-manager.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>expr-manager.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <pre><code>expr-manager.js <span class="hljs-number">0.1</span><span class="hljs-number">.0</span>
https:<span class="hljs-comment">//github.com/X37ddV/expr-manager</span>
(c) <span class="hljs-number">2016</span><span class="hljs-number">-2017</span> X37ddV
Released under the MIT License.
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>
(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">global, factory</span>) </span>{
	<span class="hljs-keyword">typeof</span> exports === <span class="hljs-string">'object'</span> &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">module</span> !== <span class="hljs-string">'undefined'</span> ? <span class="hljs-built_in">module</span>.exports = factory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'moment'</span>), <span class="hljs-built_in">require</span>(<span class="hljs-string">'decimal.js'</span>)) :
	<span class="hljs-keyword">typeof</span> define === <span class="hljs-string">'function'</span> &amp;&amp; define.amd ? define([<span class="hljs-string">'moment'</span>, <span class="hljs-string">'decimal.js'</span>], factory) :
	(global.ExprManager = factory(global.moment,global.Decimal));
}(<span class="hljs-keyword">this</span>, (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">moment,Decimal</span>) </span>{ <span class="hljs-string">'use strict'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2 id="-">依赖第三方库</h2>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <ul>
<li><strong><a href="https://github.com/MikeMcl/decimal.js" title="An arbitrary-precision Decimal type for JavaScript">decimal.js</a></strong> 用于高精度计算<br /></li>
<li><strong><a href="http://momentjs.com" title="Parse, validate, manipulate, and display dates in javascript">moment.js</a></strong> 用于日期计算</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>
moment = moment &amp;&amp; <span class="hljs-string">'default'</span> <span class="hljs-keyword">in</span> moment ? moment[<span class="hljs-string">'default'</span>] : moment;
Decimal = Decimal &amp;&amp; <span class="hljs-string">'default'</span> <span class="hljs-keyword">in</span> Decimal ? Decimal[<span class="hljs-string">'default'</span>] : Decimal;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__extends</span>(<span class="hljs-params">d, b</span>) </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> p <span class="hljs-keyword">in</span> b) <span class="hljs-keyword">if</span> (b.hasOwnProperty(p)) d[p] = b[p];
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__</span>(<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">this</span>.constructor = d; }
    d.prototype = b === <span class="hljs-literal">null</span> ? <span class="hljs-built_in">Object</span>.create(b) : (__.prototype = b.prototype, <span class="hljs-keyword">new</span> __());
}</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h2 id="-">内部公共函数</h2>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>获取<strong>值</strong>类型</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getValueType</span>(<span class="hljs-params">v</span>) </span>{
    <span class="hljs-keyword">return</span> v === <span class="hljs-literal">null</span> ? <span class="hljs-string">"null"</span> :
        <span class="hljs-built_in">Object</span>.prototype.toString.call(v).replace(<span class="hljs-string">"[object "</span>, <span class="hljs-string">""</span>).replace(<span class="hljs-string">"]"</span>, <span class="hljs-string">""</span>).toLowerCase();
}</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>是否为<strong>字符串</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isString</span>(<span class="hljs-params">v</span>) </span>{
    <span class="hljs-keyword">return</span> getValueType(v) === <span class="hljs-string">"string"</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>是否为<strong>数字</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isNumber</span>(<span class="hljs-params">v</span>) </span>{
    <span class="hljs-keyword">return</span> getValueType(v) === <span class="hljs-string">"number"</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>是否为<strong>对象</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isObject</span>(<span class="hljs-params">v</span>) </span>{
    <span class="hljs-keyword">return</span> getValueType(v) === <span class="hljs-string">"object"</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>是否为<strong>数组</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isArray</span>(<span class="hljs-params">v</span>) </span>{
    <span class="hljs-keyword">return</span> getValueType(v) === <span class="hljs-string">"array"</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>判断<strong>tokenType</strong>是否包含在<strong>tokenTypes</strong>中</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hasToken</span>(<span class="hljs-params">tokenTypes, tokenType</span>) </span>{
    <span class="hljs-keyword">return</span> (tokenTypes + <span class="hljs-string">","</span>).indexOf(tokenType + <span class="hljs-string">","</span>) &gt;= <span class="hljs-number">0</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>是否为<strong>数字</strong>组成字符</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isN</span>(<span class="hljs-params">s</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">"0123456789."</span>.indexOf(s) &gt;= <span class="hljs-number">0</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>是否为<strong>八进制数字</strong>组成字符</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isO</span>(<span class="hljs-params">s</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">"01234567"</span>.indexOf(s) &gt;= <span class="hljs-number">0</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>是否为<strong>十六进制数字</strong>组成字符</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isX</span>(<span class="hljs-params">s</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">"0123456789abcdefABCDEF"</span>.indexOf(s) &gt;= <span class="hljs-number">0</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>是否为<strong>标识符</strong>组成字符</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isC</span>(<span class="hljs-params">s</span>) </span>{
    <span class="hljs-keyword">return</span> s !== <span class="hljs-string">"."</span> &amp;&amp; isN(s) || <span class="hljs-string">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$_"</span>.indexOf(s) &gt;= <span class="hljs-number">0</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>是否至多包含一个”.”</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isNS</span>(<span class="hljs-params">s</span>) </span>{
    <span class="hljs-keyword">return</span> s.replace(<span class="hljs-regexp">/[^\.]/g</span>, <span class="hljs-string">""</span>).length &lt;= <span class="hljs-number">1</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>是否为不能识别的字符</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isUN</span>(<span class="hljs-params">s</span>) </span>{
    <span class="hljs-keyword">return</span> !isC(s) &amp;&amp; <span class="hljs-string">" ()[]{}!&lt;&gt;=+-&amp;|*/%'\",."</span>.indexOf(s) &lt; <span class="hljs-number">0</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>是否为变量标识符（排除函数名，对象属性名的情况）</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isIDENToken</span>(<span class="hljs-params">token</span>) </span>{
    <span class="hljs-keyword">var</span> p = token.parent;
    <span class="hljs-keyword">return</span> !(p &amp;&amp;
        (hasToken(<span class="hljs-string">"VTK_FUNCTION,TK_COLON"</span>, p.tokenType) &amp;&amp; p.childs[<span class="hljs-number">0</span>] === token ||
            p.tokenType === <span class="hljs-string">"TK_DOT"</span> &amp;&amp; p.childs[<span class="hljs-number">0</span>] !== token));
}</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>t是否为n(,,)函数形式中的”,”结点</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isFunctionToken</span>(<span class="hljs-params">t, name</span>) </span>{
    <span class="hljs-keyword">return</span> t &amp;&amp; t.tokenType === <span class="hljs-string">"VTK_COMMA"</span> &amp;&amp;
        t.parent &amp;&amp; t.parent.tokenType === <span class="hljs-string">"VTK_PAREN"</span> &amp;&amp;
        t.parent.parent &amp;&amp; t.parent.parent.tokenType === <span class="hljs-string">"TK_IDEN"</span> &amp;&amp;
        t.parent.parent.tokenValue === name;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>遍历<strong>语法树</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">eachToken</span>(<span class="hljs-params">token, fn, scope</span>) </span>{
    <span class="hljs-keyword">var</span> r = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (token.childs) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _i = <span class="hljs-number">0</span>, _a = token.childs; _i &lt; _a.length; _i++) {
            <span class="hljs-keyword">var</span> item = _a[_i];
            <span class="hljs-keyword">if</span> (eachToken(item, fn, scope) === <span class="hljs-literal">false</span>) {
                r = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">break</span>;
            }
        }
    }
    <span class="hljs-keyword">return</span> !r ? r : fn.call(scope, token);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>格式化字符串str, 替换掉str中的{0}、{1}等</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">format</span>(<span class="hljs-params">str</span>) </span>{
    <span class="hljs-keyword">var</span> values = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _i = <span class="hljs-number">1</span>; _i &lt; <span class="hljs-built_in">arguments</span>.length; _i++) {
        values[_i - <span class="hljs-number">1</span>] = <span class="hljs-built_in">arguments</span>[_i];
    }
    <span class="hljs-keyword">return</span> str.replace(<span class="hljs-regexp">/\{(\d+)\}/g</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">m, i</span>) </span>{ <span class="hljs-keyword">return</span> values[i]; });
}</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>比较<strong>数组</strong>是否相等</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compareArray</span>(<span class="hljs-params">farr, sarr, isKey</span>) </span>{
    <span class="hljs-keyword">var</span> r = farr.length === sarr.length;
    <span class="hljs-keyword">if</span> (r) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; farr.length; i++) {
            <span class="hljs-keyword">if</span> (isKey === <span class="hljs-literal">true</span>) {
                <span class="hljs-keyword">if</span> (sarr.indexOf(farr[i]) === <span class="hljs-number">-1</span>) {
                    r = <span class="hljs-literal">false</span>;
                    <span class="hljs-keyword">break</span>;
                }
            }
            <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">if</span> (!compare(farr[i], sarr[i])) {
                    r = <span class="hljs-literal">false</span>;
                    <span class="hljs-keyword">break</span>;
                }
            }
        }
    }
    <span class="hljs-keyword">return</span> r;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>比较<strong>对象</strong>是否相等</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compareObject</span>(<span class="hljs-params">fobj, sobj</span>) </span>{
    <span class="hljs-keyword">var</span> f = [];
    <span class="hljs-keyword">var</span> s = [];
    <span class="hljs-keyword">var</span> r = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> fobj) {
        <span class="hljs-keyword">if</span> (fobj.hasOwnProperty(i)) {
            f.push(i);
        }
    }
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j <span class="hljs-keyword">in</span> sobj) {
        <span class="hljs-keyword">if</span> (sobj.hasOwnProperty(j)) {
            s.push(j);
        }
    }
    <span class="hljs-keyword">if</span> (compareArray(f, s, <span class="hljs-literal">true</span>)) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> ele <span class="hljs-keyword">in</span> fobj) {
            <span class="hljs-keyword">if</span> (sobj.hasOwnProperty(ele) &amp;&amp; !compare(fobj[ele], sobj[ele])) {
                r = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">break</span>;
            }
        }
    }
    <span class="hljs-keyword">else</span> {
        r = <span class="hljs-literal">false</span>;
    }
    <span class="hljs-keyword">return</span> r;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>比较<strong>值</strong>是否相等</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compare</span>(<span class="hljs-params">fobj, sobj</span>) </span>{
    <span class="hljs-keyword">var</span> r;
    <span class="hljs-keyword">if</span> (fobj !== <span class="hljs-literal">null</span> &amp;&amp; sobj !== <span class="hljs-literal">null</span> &amp;&amp; fobj !== <span class="hljs-literal">undefined</span> &amp;&amp; sobj !== <span class="hljs-literal">undefined</span>) {
        <span class="hljs-keyword">var</span> ftype = <span class="hljs-keyword">typeof</span> (fobj);
        <span class="hljs-keyword">var</span> stype = <span class="hljs-keyword">typeof</span> (sobj);
        <span class="hljs-keyword">if</span> (ftype === stype) {
            <span class="hljs-keyword">if</span> (ftype === <span class="hljs-string">"object"</span>) {
                r = fobj.constructor === <span class="hljs-built_in">Date</span> &amp;&amp; sobj.constructor === <span class="hljs-built_in">Date</span> ? fobj.valueOf() === sobj.valueOf() :
                    fobj.constructor === <span class="hljs-built_in">Array</span> &amp;&amp; sobj.constructor === <span class="hljs-built_in">Array</span> ? compareArray(fobj, sobj, <span class="hljs-literal">false</span>) :
                        fobj.constructor !== <span class="hljs-built_in">Array</span> &amp;&amp; sobj.constructor !== <span class="hljs-built_in">Array</span> ? compareObject(fobj, sobj) :
                            <span class="hljs-literal">false</span>;
            }
            <span class="hljs-keyword">else</span> {
                r = fobj === sobj;
            }
        }
        <span class="hljs-keyword">else</span> {
            r = <span class="hljs-literal">false</span>;
        }
    }
    <span class="hljs-keyword">else</span> {
        r = fobj === sobj;
    }
    <span class="hljs-keyword">return</span> r;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>遍历对象c中的属性, 将属性键值对依次添加到对象o中</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">merger</span>(<span class="hljs-params">o, c</span>) </span>{
    <span class="hljs-keyword">if</span> (isObject(o) &amp;&amp; isObject(c)) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> p <span class="hljs-keyword">in</span> c) {
            <span class="hljs-keyword">if</span> (c.hasOwnProperty(p)) {
                <span class="hljs-keyword">if</span> (o[p] &amp;&amp; isObject(o[p])) {
                    merger(o[p], c[p]);
                }
                <span class="hljs-keyword">else</span> {
                    o[p] = c[p];
                }
            }
        }
    }
    <span class="hljs-keyword">return</span> o;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <h2 id="-">表达式函数</h2>

            </div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>条件判断函数，如果第一个参数为true，则获取第二个参数，否则获取第三个参数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcIIf = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, bool, tv, fv</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(bool ? tv : fv);
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"boolean"</span>, <span class="hljs-string">"undefined"</span>, <span class="hljs-string">"undefined"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"undefined"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>空值判断函数，如果第一个参数为null，则获取第二个参数，否则获取第一个参数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcIfNull = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, v, d</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue((v !== <span class="hljs-literal">null</span>) ? v : d);
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"undefined"</span>, <span class="hljs-string">"undefined"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"undefined"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>获取当前实体的父实体对象，如果当前为根则获取自己</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcParent = {
    <span class="hljs-attr">e</span>: <span class="hljs-string">"parent"</span>,
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context</span>) </span>{
        <span class="hljs-keyword">return</span> context.getParentValue(<span class="hljs-literal">null</span>);
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"object"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>获取当前实体的索引号，没有记录返回-1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcRecNo = {
    <span class="hljs-attr">e</span>: <span class="hljs-string">"value"</span>,
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context</span>) </span>{
        <span class="hljs-keyword">return</span> context.getRecNo(<span class="hljs-literal">null</span>);
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>获取实体根对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcRoot = {
    <span class="hljs-attr">e</span>: <span class="hljs-string">"root"</span>,
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context</span>) </span>{
        <span class="hljs-keyword">return</span> context.getRootValue();
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"object"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>获取本地当前日期时间</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcNow = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>());
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"date"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>获取当前字段唯一标识</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcFieldName = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context</span>) </span>{
        <span class="hljs-keyword">return</span> context.getContextVariableValue(<span class="hljs-string">"FieldName"</span>);
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"string"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>获取当前字段别名</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcFieldDisplayName = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context</span>) </span>{
        <span class="hljs-keyword">return</span> context.getContextVariableValue(<span class="hljs-string">"FieldDisplayName"</span>);
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"string"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>获取当前字段值</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcFieldValue = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context</span>) </span>{
        <span class="hljs-keyword">return</span> context.getContextVariableValue(<span class="hljs-string">"FieldValue"</span>);
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"undefined"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>获取对象属性值</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcPropValue = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, obj, prop, delimiter</span>) </span>{
        <span class="hljs-keyword">var</span> r;
        <span class="hljs-keyword">var</span> o = obj;
        <span class="hljs-keyword">if</span> (isString(delimiter) &amp;&amp; isArray(o)) {
            r = <span class="hljs-string">""</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; o.length; i++) {
                r += isObject(o[i]) ? o[i][prop] : <span class="hljs-string">""</span>;
                <span class="hljs-keyword">if</span> (i &lt; o.length - <span class="hljs-number">1</span>) {
                    r += delimiter;
                }
            }
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (isArray(o)) {
                o = o.length &gt; <span class="hljs-number">0</span> ? o[<span class="hljs-number">0</span>] : {};
            }
            r = isObject(o) ? o[prop] : <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">if</span> (r === <span class="hljs-literal">undefined</span>) {
            r = <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">return</span> context.genValue(r);
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"undefined"</span>, <span class="hljs-string">"string"</span>, <span class="hljs-string">"string?"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"undefined"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>返回介于 0 ~ 1 之间的一个随机数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcRandom = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(<span class="hljs-built_in">Math</span>.random());
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};
<span class="hljs-keyword">var</span> func__ = {
    <span class="hljs-attr">FieldDisplayName</span>: funcFieldDisplayName,
    <span class="hljs-attr">FieldName</span>: funcFieldName,
    <span class="hljs-attr">FieldValue</span>: funcFieldValue,
    <span class="hljs-attr">IIf</span>: funcIIf,
    <span class="hljs-attr">IfNull</span>: funcIfNull,
    <span class="hljs-attr">Now</span>: funcNow,
    <span class="hljs-attr">Parent</span>: funcParent,
    <span class="hljs-attr">PropValue</span>: funcPropValue,
    <span class="hljs-attr">Random</span>: funcRandom,
    <span class="hljs-attr">RecNo</span>: funcRecNo,
    <span class="hljs-attr">Root</span>: funcRoot,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <h2 id="-">集合私有函数</h2>

            </div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>分别将source中每个值作为计算环境求出expr的值</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doEachCollection</span>(<span class="hljs-params">source, expr, fn</span>) </span>{
    <span class="hljs-keyword">var</span> r;
    <span class="hljs-keyword">var</span> msg = <span class="hljs-string">""</span>;
    <span class="hljs-keyword">if</span> (source.isEntity()) {
        <span class="hljs-keyword">var</span> curr = {};
        <span class="hljs-keyword">var</span> pa = source.parentObj;
        <span class="hljs-keyword">while</span> (pa) {
            <span class="hljs-keyword">if</span> (pa.entity.name !== <span class="hljs-string">""</span> &amp;&amp; !curr[pa.entity.name]) {
                curr[pa.entity.name] = pa.entity.recNo;
            }
            pa = pa.parentObj;
        }
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> en <span class="hljs-keyword">in</span> curr) {
            <span class="hljs-keyword">if</span> (curr.hasOwnProperty(en)) {
                <span class="hljs-keyword">this</span>.pushEntityCurrent(en, curr[en]);
            }
        }
        <span class="hljs-keyword">var</span> map = source.entity.map;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; map.length; i++) {
            r = <span class="hljs-keyword">this</span>.calcEntityExpr(expr, source.entity.name, map[i]);
            msg = r.errorMsg;
            <span class="hljs-keyword">if</span> (msg === <span class="hljs-string">""</span>) {
                <span class="hljs-keyword">var</span> x = fn.call(<span class="hljs-keyword">this</span>, r, i);
                <span class="hljs-keyword">if</span> (x !== <span class="hljs-literal">undefined</span>) {
                    msg = x;
                    <span class="hljs-keyword">break</span>;
                }
            }
            <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">break</span>;
            }
        }
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> en <span class="hljs-keyword">in</span> curr) {
            <span class="hljs-keyword">if</span> (curr.hasOwnProperty(en)) {
                <span class="hljs-keyword">this</span>.popEntityCurrent();
            }
        }
    }
    <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; source.value.length; j++) {
            r = <span class="hljs-keyword">this</span>.calcDataExpr(expr, source.value[j]);
            msg = r.errorMsg;
            <span class="hljs-keyword">if</span> (msg === <span class="hljs-string">""</span>) {
                <span class="hljs-keyword">var</span> y = fn.call(<span class="hljs-keyword">this</span>, r, j);
                <span class="hljs-keyword">if</span> (y !== <span class="hljs-literal">undefined</span>) {
                    msg = y;
                    <span class="hljs-keyword">break</span>;
                }
            }
            <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">break</span>;
            }
        }
    }
    <span class="hljs-keyword">return</span> msg;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>将source中求出的值经过fn处理后最终的结果</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doCompCollection</span>(<span class="hljs-params">source, expr, fn</span>) </span>{
    <span class="hljs-keyword">var</span> _this = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">var</span> r;
    <span class="hljs-keyword">var</span> msg;
    msg = doEachCollection.call(<span class="hljs-keyword">this</span>, source, expr, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a</span>) </span>{
        <span class="hljs-keyword">if</span> (r) {
            <span class="hljs-keyword">var</span> tmp = fn.call(_this, r, a);
            <span class="hljs-keyword">if</span> (tmp.errorMsg) {
                <span class="hljs-keyword">return</span> tmp.errorMsg;
            }
            <span class="hljs-keyword">else</span> {
                r = tmp;
            }
        }
        <span class="hljs-keyword">else</span> {
            r = a;
        }
    });
    <span class="hljs-keyword">if</span> (msg !== <span class="hljs-string">""</span>) {
        r = <span class="hljs-keyword">this</span>.genErrorValue(msg);
    }
    <span class="hljs-keyword">if</span> (!r) {
        r = <span class="hljs-keyword">this</span>.genValue(<span class="hljs-literal">null</span>);
    }
    <span class="hljs-keyword">return</span> r;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <h2 id="-">集合函数</h2>

            </div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>获取集合元素个数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcArrayCount = {
    <span class="hljs-attr">e</span>: <span class="hljs-string">"value"</span>,
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">var</span> r = source.toValue().length;
        <span class="hljs-keyword">return</span> context.genValue(r, <span class="hljs-string">""</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">""</span>);
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>获取集合元素的合计值</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcArraySum = {
    <span class="hljs-attr">e</span>: <span class="hljs-string">"value"</span>,
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, expr</span>) </span>{
        expr = expr || <span class="hljs-string">"$0"</span>;
        <span class="hljs-keyword">var</span> r = doCompCollection.call(context, source, expr, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a, b</span>) </span>{
            <span class="hljs-keyword">return</span> a.add(b);
        });
        <span class="hljs-keyword">return</span> r;
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"expr?"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"undefined"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>获取集合元素的最大值</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcArrayMax = {
    <span class="hljs-attr">e</span>: <span class="hljs-string">"value"</span>,
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, expr</span>) </span>{
        expr = expr || <span class="hljs-string">"$0"</span>;
        <span class="hljs-keyword">var</span> r = doCompCollection.call(context, source, expr, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a, b</span>) </span>{
            <span class="hljs-keyword">var</span> v = a.compare(b, <span class="hljs-string">"&gt;"</span>);
            <span class="hljs-keyword">if</span> (v.errorMsg === <span class="hljs-string">""</span>) {
                v = v.toValue() ? a : b;
            }
            <span class="hljs-keyword">return</span> v;
        });
        <span class="hljs-keyword">return</span> r;
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"expr?"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"undefined"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>获取集合元素的最小值</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcArrayMin = {
    <span class="hljs-attr">e</span>: <span class="hljs-string">"value"</span>,
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, expr</span>) </span>{
        expr = expr || <span class="hljs-string">"$0"</span>;
        <span class="hljs-keyword">var</span> r = doCompCollection.call(context, source, expr, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a, b</span>) </span>{
            <span class="hljs-keyword">var</span> v = a.compare(b, <span class="hljs-string">"&lt;"</span>);
            <span class="hljs-keyword">if</span> (v.errorMsg === <span class="hljs-string">""</span>) {
                v = v.toValue() ? a : b;
            }
            <span class="hljs-keyword">return</span> v;
        });
        <span class="hljs-keyword">return</span> r;
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"expr?"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"undefined"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>获取集合元素的平均值</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcArrayAverage = {
    <span class="hljs-attr">e</span>: <span class="hljs-string">"value"</span>,
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, expr</span>) </span>{
        expr = expr || <span class="hljs-string">"$0"</span>;
        <span class="hljs-keyword">var</span> r = doCompCollection.call(context, source, expr, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a, b</span>) </span>{
            <span class="hljs-keyword">return</span> a.add(b);
        });
        <span class="hljs-keyword">if</span> (r.errorMsg === <span class="hljs-string">""</span>) {
            <span class="hljs-keyword">if</span> (r.toValue() === <span class="hljs-literal">null</span>) {
                r = context.genValue(<span class="hljs-number">0</span>);
            }
            <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">var</span> c = source.toValue().length;
                r = r.divide(context.genValue(c));
            }
        }
        <span class="hljs-keyword">return</span> r;
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"expr?"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>获取集合中唯一元素的集合</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcArrayDistinct = {
    <span class="hljs-attr">e</span>: <span class="hljs-string">"data"</span>,
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, expr</span>) </span>{
        expr = expr || <span class="hljs-string">"$0"</span>;
        <span class="hljs-keyword">var</span> r = context.genValue([], <span class="hljs-string">"array"</span>);
        <span class="hljs-keyword">var</span> arr = [];
        <span class="hljs-keyword">if</span> (source.entity) {
            r.entity = context.genEntityInfo(source.entity.fullName);
            r.entity.map = [];
            r.parentObj = source.parentObj;
        }
        <span class="hljs-keyword">var</span> find = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">v</span>) </span>{
            <span class="hljs-keyword">var</span> f = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _i = <span class="hljs-number">0</span>, arr_1 = arr; _i &lt; arr_1.length; _i++) {
                <span class="hljs-keyword">var</span> item = arr_1[_i];
                f = compare(item, v);
                <span class="hljs-keyword">if</span> (f) {
                    <span class="hljs-keyword">break</span>;
                }
            }
            <span class="hljs-keyword">return</span> f;
        };
        <span class="hljs-keyword">var</span> msg = doEachCollection.call(context, source, expr, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a, i</span>) </span>{
            <span class="hljs-keyword">var</span> b = a.toValue();
            <span class="hljs-keyword">if</span> (!find(b)) {
                arr.push(b);
                r.arrayPush(source.subscript(context.genValue(i)));
                <span class="hljs-keyword">if</span> (r.entity &amp;&amp; r.entity.map) {
                    r.entity.map.push(source.entity.map[i]);
                }
            }
        });
        <span class="hljs-keyword">if</span> (msg !== <span class="hljs-string">""</span>) {
            r = context.genErrorValue(msg);
        }
        <span class="hljs-keyword">return</span> r;
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"expr?"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"array"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>获取满足条件的元素集合</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcArrayWhere = {
    <span class="hljs-attr">e</span>: <span class="hljs-string">"data"</span>,
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, expr</span>) </span>{
        expr = expr || <span class="hljs-string">"true"</span>;
        <span class="hljs-keyword">var</span> r = context.genValue([], <span class="hljs-string">"array"</span>);
        <span class="hljs-keyword">if</span> (source.entity) {
            r.entity = context.genEntityInfo(source.entity.fullName);
            r.entity.map = [];
            r.parentObj = source.parentObj;
        }
        <span class="hljs-keyword">var</span> msg = doEachCollection.call(context, source, expr, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a, i</span>) </span>{
            <span class="hljs-keyword">if</span> (a.toValue()) {
                r.arrayPush(source.subscript(context.genValue(i)));
                <span class="hljs-keyword">if</span> (r.entity &amp;&amp; r.entity.map) {
                    r.entity.map.push(source.entity.map[i]);
                }
            }
        });
        <span class="hljs-keyword">if</span> (msg !== <span class="hljs-string">""</span>) {
            r = context.genErrorValue(msg);
        }
        <span class="hljs-keyword">return</span> r;
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"expr"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"array"</span>,
};
<span class="hljs-keyword">var</span> func_array = {
    <span class="hljs-attr">Average</span>: funcArrayAverage,
    <span class="hljs-attr">Count</span>: funcArrayCount,
    <span class="hljs-attr">Distinct</span>: funcArrayDistinct,
    <span class="hljs-attr">Max</span>: funcArrayMax,
    <span class="hljs-attr">Min</span>: funcArrayMin,
    <span class="hljs-attr">Sum</span>: funcArraySum,
    <span class="hljs-attr">Where</span>: funcArrayWhere,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <h2 id="-">布尔函数</h2>

            </div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>转换布尔类型为字符串</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcBooleanToString = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(source.toValue() + <span class="hljs-string">""</span>);
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"string"</span>,
};
<span class="hljs-keyword">var</span> func_boolean = {
    <span class="hljs-attr">ToString</span>: funcBooleanToString,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <h2 id="-">日期函数</h2>

            </div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>转换日期时间类型为字符串</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcDateToString = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, format</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(moment(source.toValue()).format(format || <span class="hljs-string">""</span>));
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"string?"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"string"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>获取 Date 对象的日期部分</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcDateDateOf = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(moment(source.toValue()).startOf(<span class="hljs-string">"day"</span>).toDate());
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"date"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>从 Date 对象获取一个月中的某一天（1 ~ 31）</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcDateDayOf = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(moment(source.toValue()).date());
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>得到一周中的星期几（0 ~ 6）</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcDateDayOfWeek = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(moment(source.toValue()).day());
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>获取日期差</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcDateDaysBetween = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, endDate</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(-moment(source.toValue()).diff(endDate, <span class="hljs-string">"days"</span>));
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"date"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>从 Date 对象获取一天中的第几个小时</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcDateHourOf = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(moment(source.toValue()).hour());
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>获取小时差</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcDateHoursBetween = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, endDate</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(-moment(source.toValue()).diff(endDate, <span class="hljs-string">"hours"</span>));
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"date"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>增加指定的天数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcDateIncDay = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, days</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(moment(source.toValue()).add(days, <span class="hljs-string">"days"</span>).toDate());
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"number"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"date"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>增加指定的小时数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcDateIncHour = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, hours</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(moment(source.toValue()).add(hours, <span class="hljs-string">"hours"</span>).toDate());
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"number"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"date"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>增加指定的分钟数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcDateIncMinute = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, minutes</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(moment(source.toValue()).add(minutes, <span class="hljs-string">"minutes"</span>).toDate());
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"number"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"date"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>增加指定的月数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcDateIncMonth = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, months</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(moment(source.toValue()).add(months, <span class="hljs-string">"months"</span>).toDate());
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"number"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"date"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>增加指定的秒数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcDateIncSecond = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, seconds</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(moment(source.toValue()).add(seconds, <span class="hljs-string">"seconds"</span>).toDate());
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"number"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"date"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>增加指定的周数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcDateIncWeek = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, weeks</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(moment(source.toValue()).add(weeks, <span class="hljs-string">"weeks"</span>).toDate());
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"number"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"date"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>增加指定的年数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcDateIncYear = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, years</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(moment(source.toValue()).add(years, <span class="hljs-string">"years"</span>).toDate());
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"number"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"date"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>从 Date 对象获取毫秒</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcDateMilliSecondOf = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(moment(source.toValue()).millisecond());
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>获取毫秒差</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcDateMilliSecondsBetween = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, endDate</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(-moment(source.toValue()).diff(endDate, <span class="hljs-string">"milliseconds"</span>));
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"date"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>从 Date 对象获取分钟（0 ~ 59）</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcDateMinuteOf = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(moment(source.toValue()).minute());
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>获取分钟差</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcDateMinutesBetween = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, endDate</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(-moment(source.toValue()).diff(endDate, <span class="hljs-string">"minutes"</span>));
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"date"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>从 Date 对象获取月份（1 ~ 12）</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcDateMonthOf = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(moment(source.toValue()).month() + <span class="hljs-number">1</span>);
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>获取月份差</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcDateMonthsBetween = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, endDate</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(-moment(source.toValue()).diff(endDate, <span class="hljs-string">"months"</span>));
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"date"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>从 Date 对象获取秒数（0 ~ 59）</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcDateSecondOf = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(moment(source.toValue()).second());
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>获取秒差</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcDateSecondsBetween = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, endDate</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(-moment(source.toValue()).diff(endDate, <span class="hljs-string">"seconds"</span>));
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"date"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>从 Date 对象获取一年中的第几周（1 ~ 53）</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcDateWeekOf = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(moment(source.toValue()).week());
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>获取周差</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcDateWeeksBetween = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, endDate</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(-moment(source.toValue()).diff(endDate, <span class="hljs-string">"weeks"</span>));
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"date"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>从 Date 对象获取年份</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcDateYearOf = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(moment(source.toValue()).year());
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>获取年差</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcDateYearsBetween = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, endDate</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(-moment(source.toValue()).diff(endDate, <span class="hljs-string">"years"</span>));
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"date"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};
<span class="hljs-keyword">var</span> func_date = {
    <span class="hljs-attr">DateOf</span>: funcDateDateOf,
    <span class="hljs-attr">DayOf</span>: funcDateDayOf,
    <span class="hljs-attr">DayOfWeek</span>: funcDateDayOfWeek,
    <span class="hljs-attr">DaysBetween</span>: funcDateDaysBetween,
    <span class="hljs-attr">HourOf</span>: funcDateHourOf,
    <span class="hljs-attr">HoursBetween</span>: funcDateHoursBetween,
    <span class="hljs-attr">IncDay</span>: funcDateIncDay,
    <span class="hljs-attr">IncHour</span>: funcDateIncHour,
    <span class="hljs-attr">IncMinute</span>: funcDateIncMinute,
    <span class="hljs-attr">IncMonth</span>: funcDateIncMonth,
    <span class="hljs-attr">IncSecond</span>: funcDateIncSecond,
    <span class="hljs-attr">IncWeek</span>: funcDateIncWeek,
    <span class="hljs-attr">IncYear</span>: funcDateIncYear,
    <span class="hljs-attr">MilliSecondOf</span>: funcDateMilliSecondOf,
    <span class="hljs-attr">MilliSecondsBetween</span>: funcDateMilliSecondsBetween,
    <span class="hljs-attr">MinuteOf</span>: funcDateMinuteOf,
    <span class="hljs-attr">MinutesBetween</span>: funcDateMinutesBetween,
    <span class="hljs-attr">MonthOf</span>: funcDateMonthOf,
    <span class="hljs-attr">MonthsBetween</span>: funcDateMonthsBetween,
    <span class="hljs-attr">SecondOf</span>: funcDateSecondOf,
    <span class="hljs-attr">SecondsBetween</span>: funcDateSecondsBetween,
    <span class="hljs-attr">ToString</span>: funcDateToString,
    <span class="hljs-attr">WeekOf</span>: funcDateWeekOf,
    <span class="hljs-attr">WeeksBetween</span>: funcDateWeeksBetween,
    <span class="hljs-attr">YearOf</span>: funcDateYearOf,
    <span class="hljs-attr">YearsBetween</span>: funcDateYearsBetween,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <h2 id="-">数值函数</h2>

            </div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>转换数字类型为字符串</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcNumberToString = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(source.toValue() + <span class="hljs-string">""</span>);
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"string"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>获取数的绝对值</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcNumberAbs = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">return</span> source.abs();
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>对数进行向上取整</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcNumberCeil = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">return</span> source.ceil();
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>对数进行向下取整</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcNumberFloor = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">return</span> source.floor();
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>获取数的余弦</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcNumberCos = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">return</span> source.cos();
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>获取 e 的指数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcNumberExp = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">return</span> source.exp();
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>获取数的自然对数（底为 e）</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcNumberLn = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">return</span> source.ln();
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>获取数的指定底数的对数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcNumberLog = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, base</span>) </span>{
        <span class="hljs-keyword">return</span> source.log(base);
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"number"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>获取数的指定指数的次幂</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcNumberPower = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, exponent</span>) </span>{
        <span class="hljs-keyword">return</span> source.power(exponent);
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"number"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>根据保留的小数位数对数四舍五入</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcNumberRound = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, scale</span>) </span>{
        <span class="hljs-keyword">return</span> source.round(scale);
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"number"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>获取数的正弦</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcNumberSin = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">return</span> source.sin();
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>获取数的平方根</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcNumberSqrt = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">return</span> source.sqrt();
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>获取树的正切值</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcNumberTan = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">return</span> source.tan();
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>根据保留的小数位数对数进行截断</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcNumberTrunc = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, scale</span>) </span>{
        <span class="hljs-keyword">return</span> source.trunc(scale);
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"number"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>获取人民币大写</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcNumberToRMB = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, rmb, big</span>) </span>{
        <span class="hljs-keyword">var</span> conversion = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">num, isRMB, isBig</span>) </span>{
            <span class="hljs-keyword">var</span> cn = (isBig ? <span class="hljs-string">"零壹贰叁肆伍陆柒捌玖"</span> : <span class="hljs-string">"零一二三四五六七八九"</span>).split(<span class="hljs-string">""</span>);
            <span class="hljs-keyword">var</span> cq = (isBig ? <span class="hljs-string">"拾佰仟"</span> : <span class="hljs-string">"十百千"</span>).split(<span class="hljs-string">""</span>);
            cq.unshift(<span class="hljs-string">""</span>);
            <span class="hljs-keyword">var</span> cw = <span class="hljs-string">"万亿兆"</span>.split(<span class="hljs-string">""</span>);
            cw.unshift(<span class="hljs-string">""</span>);
            <span class="hljs-keyword">var</span> cd = isRMB ? <span class="hljs-string">"元"</span> : <span class="hljs-string">"点"</span>;
            <span class="hljs-keyword">var</span> cl = <span class="hljs-string">"角分厘"</span>.split(<span class="hljs-string">""</span>);
            <span class="hljs-keyword">var</span> cz = isRMB ? <span class="hljs-string">"整"</span> : <span class="hljs-string">""</span>;
            <span class="hljs-keyword">var</span> cf = <span class="hljs-string">"负"</span>;
            <span class="hljs-keyword">var</span> v = <span class="hljs-string">""</span>;
            <span class="hljs-keyword">var</span> s = (num + <span class="hljs-string">"."</span>).split(<span class="hljs-string">"."</span>, <span class="hljs-number">2</span>);
            <span class="hljs-keyword">var</span> x = s[<span class="hljs-number">0</span>].split(<span class="hljs-string">""</span>);
            <span class="hljs-keyword">var</span> y = s[<span class="hljs-number">1</span>].split(<span class="hljs-string">""</span>);
            <span class="hljs-keyword">var</span> isNegative = x[<span class="hljs-number">0</span>] === <span class="hljs-string">"-"</span>;
            <span class="hljs-keyword">if</span> (isNegative) {
                x.shift();
            }
            x = x.reverse();</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <ul>
<li>处理整数部分</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> c = <span class="hljs-string">""</span>;
            <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">var</span> t = [];
            <span class="hljs-keyword">var</span> inZero = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">while</span> (i &lt; x.length) {
                t.push(x[i++]);
                <span class="hljs-keyword">if</span> (t.length === <span class="hljs-number">4</span> || i === x.length) {</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <ul>
<li>从个位数起以每四位数为一小节</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; t.length; j++) {
                        <span class="hljs-keyword">var</span> n = <span class="hljs-built_in">Number</span>(t[j]);
                        <span class="hljs-keyword">if</span> (n === <span class="hljs-number">0</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <ol>
<li>避免 “零” 的重覆出现;</li>
<li>个位数的 0 不必转成 “零”</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            <span class="hljs-keyword">if</span> (!inZero &amp;&amp; j !== <span class="hljs-number">0</span>) {
                                c = cn[<span class="hljs-number">0</span>] + c;
                            }
                            inZero = <span class="hljs-literal">true</span>;
                        }
                        <span class="hljs-keyword">else</span> {
                            c = cn[n] + cq[j] + c;
                            inZero = <span class="hljs-literal">false</span>;
                        }
                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <ul>
<li>加上该小节的位数</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (c.length === <span class="hljs-number">0</span>) {
                        <span class="hljs-keyword">if</span> (v.length &gt; <span class="hljs-number">0</span> &amp;&amp; v.split(<span class="hljs-string">""</span>)[<span class="hljs-number">0</span>] !== cn[<span class="hljs-number">0</span>]) {
                            v = cn[<span class="hljs-number">0</span>] + v;
                        }
                    }
                    <span class="hljs-keyword">else</span> {
                        v = c + (cw[<span class="hljs-built_in">Math</span>.floor((i - <span class="hljs-number">1</span>) / <span class="hljs-number">4</span>)] || <span class="hljs-string">""</span>) + v;
                    }
                    c = <span class="hljs-string">""</span>;
                    t = [];
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <ul>
<li>处理小数部分</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (y.length &gt; <span class="hljs-number">0</span>) {
                v += cd;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k = <span class="hljs-number">0</span>; k &lt; y.length; k++) {
                    <span class="hljs-keyword">var</span> m = <span class="hljs-built_in">Number</span>(y[k]);
                    <span class="hljs-keyword">if</span> (isRMB) {</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <ul>
<li>避免小数点后 “零” 的重覆出现</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> ((m !== <span class="hljs-number">0</span>) || (v.substring(v.length - <span class="hljs-number">1</span>) !== cn[<span class="hljs-number">0</span>]) || (k &gt; <span class="hljs-number">2</span>)) {
                            v += cn[m];
                        }
                        <span class="hljs-keyword">if</span> ((m !== <span class="hljs-number">0</span>) || (v.substring(v.length - <span class="hljs-number">1</span>) === cn[<span class="hljs-number">0</span>]) &amp;&amp; (k === <span class="hljs-number">2</span>)) {
                            v += cl[k] || <span class="hljs-string">""</span>;
                        }
                    }
                    <span class="hljs-keyword">else</span> {
                        v += cn[m];
                    }
                }
            }
            <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <ul>
<li>处理无小数部分时整数部分的结尾</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (v.length === <span class="hljs-number">0</span>) {
                    v = cn[<span class="hljs-number">0</span>];
                }
                <span class="hljs-keyword">if</span> (isRMB) {
                    v += cd + cz;
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <ul>
<li>其他例外状况的处理, 非人民币则将 “壹拾” 或 “一十” 改为 “拾” 或 “十”</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (!isRMB &amp;&amp; v.substring(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>) === cn[<span class="hljs-number">1</span>] + cq[<span class="hljs-number">1</span>]) {
                v = v.substring(<span class="hljs-number">1</span>);
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <ul>
<li>没有整数部分 且 有小数部分</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (v.split(<span class="hljs-string">""</span>)[<span class="hljs-number">0</span>] === cd) {
                v = isRMB ? v.substring(<span class="hljs-number">1</span>) : cn[<span class="hljs-number">0</span>] + v;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <ul>
<li>是否为负数</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (isNegative) {
                v = cf + v;
            }
            <span class="hljs-keyword">return</span> v;
        };
        <span class="hljs-keyword">var</span> v = source.toValue();
        <span class="hljs-keyword">return</span> context.genValue(isNumber(v) ?
            conversion(v, rmb === <span class="hljs-literal">undefined</span> || rmb, big === <span class="hljs-literal">undefined</span> || big) : <span class="hljs-literal">null</span>);
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"boolean?"</span>, <span class="hljs-string">"boolean?"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"string"</span>,
};
<span class="hljs-keyword">var</span> func_number = {
    <span class="hljs-attr">Abs</span>: funcNumberAbs,
    <span class="hljs-attr">Ceil</span>: funcNumberCeil,
    <span class="hljs-attr">Cos</span>: funcNumberCos,
    <span class="hljs-attr">Exp</span>: funcNumberExp,
    <span class="hljs-attr">Floor</span>: funcNumberFloor,
    <span class="hljs-attr">Ln</span>: funcNumberLn,
    <span class="hljs-attr">Log</span>: funcNumberLog,
    <span class="hljs-attr">Power</span>: funcNumberPower,
    <span class="hljs-attr">Round</span>: funcNumberRound,
    <span class="hljs-attr">Sin</span>: funcNumberSin,
    <span class="hljs-attr">Sqrt</span>: funcNumberSqrt,
    <span class="hljs-attr">Tan</span>: funcNumberTan,
    <span class="hljs-attr">ToRMB</span>: funcNumberToRMB,
    <span class="hljs-attr">ToString</span>: funcNumberToString,
    <span class="hljs-attr">Trunc</span>: funcNumberTrunc,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <h2 id="-">对象函数</h2>

            </div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>获取父实体对象，如果当前为根则获取自己</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcObjectParent = {
    <span class="hljs-attr">e</span>: <span class="hljs-string">"parent"</span>,
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">return</span> context.getParentValue(source);
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"object"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <p>获取当前实体的索引号，没有实体返回-1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcObjectRecNo = {
    <span class="hljs-attr">e</span>: <span class="hljs-string">"value"</span>,
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">return</span> context.getRecNo(source);
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};
<span class="hljs-keyword">var</span> func_object = {
    <span class="hljs-attr">Parent</span>: funcObjectParent,
    <span class="hljs-attr">RecNo</span>: funcObjectRecNo,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <h2 id="-">多语言处理</h2>

            </div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> Locale = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Locale</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">this</span>.localeName = <span class="hljs-string">"zh-cn"</span>;
        <span class="hljs-keyword">this</span>.locales = {};
        <span class="hljs-keyword">this</span>.functions = {};
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>定义多语言</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Locale.prototype.defineLocale = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, config</span>) </span>{
        <span class="hljs-keyword">if</span> (config !== <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">this</span>.locales[name] = merger(<span class="hljs-keyword">this</span>.locales[name] || {}, config);
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.locales[name];
        }
        <span class="hljs-keyword">return</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <p>获取多语言</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Locale.prototype.getLocale = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.locales[name || <span class="hljs-keyword">this</span>.localeName];
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <p>定义函数描述</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Locale.prototype.defineFunction = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, config</span>) </span>{
        <span class="hljs-keyword">if</span> (config !== <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">this</span>.functions[name] = merger(<span class="hljs-keyword">this</span>.functions[name] || {}, config);
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.functions[name];
        }
        <span class="hljs-keyword">return</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <p>获取函数描述</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Locale.prototype.getFunction = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.functions[name || <span class="hljs-keyword">this</span>.localeName];
    };
    <span class="hljs-keyword">return</span> Locale;
}());
<span class="hljs-keyword">var</span> locale = <span class="hljs-keyword">new</span> Locale();</pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <h2 id="-">字符串函数</h2>

            </div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <p>转换字符串类型为字符串</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcStringToString = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">return</span> context.genValue(source.toValue() + <span class="hljs-string">""</span>);
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"string"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              <p>转换字符串类型为数字</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcStringToNumber = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">var</span> n = <span class="hljs-built_in">Number</span>(source.toValue());
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">isNaN</span>(n) ?
            context.genErrorValue(format(locale.getLocale().MSG_EF_STR_TO_NUM, source.toValue())) :
            context.genValue(n);
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <p>转换字符串类型为日期时间</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcStringToDate = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, fmt</span>) </span>{
        fmt = fmt || <span class="hljs-string">""</span>;
        <span class="hljs-keyword">var</span> s = source.toValue();
        <span class="hljs-keyword">var</span> m = moment(s, fmt);
        <span class="hljs-keyword">return</span> m.isValid() ?
            context.genValue(m.toDate()) :
            context.genErrorValue(format(locale.getLocale().MSG_EF_STR_TO_NUM, s, fmt));
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"string?"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"date"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p>获取字符串长度</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcStringLength = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">var</span> value = source.toValue();
        <span class="hljs-keyword">return</span> context.genValue(isString(value) ? value.length : <span class="hljs-literal">null</span>);
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>转换字符串为大写</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcStringUpper = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">var</span> value = source.toValue();
        <span class="hljs-keyword">return</span> context.genValue(isString(value) ? value.toUpperCase() : <span class="hljs-literal">null</span>);
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"string"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <p>转换字符串为小写</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcStringLower = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">var</span> value = source.toValue();
        <span class="hljs-keyword">return</span> context.genValue(isString(value) ? value.toLowerCase() : <span class="hljs-literal">null</span>);
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"string"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p>去除字符串两端空格</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcStringTrim = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">var</span> value = source.toValue();
        <span class="hljs-keyword">return</span> context.genValue(isString(value) ? value.trim() : <span class="hljs-literal">null</span>);
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"string"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <p>去除字符串左端空格</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcStringTrimLeft = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">var</span> value = source.toValue();
        <span class="hljs-keyword">return</span> context.genValue(isString(value) ? value.replace(<span class="hljs-regexp">/^\s+/g</span>, <span class="hljs-string">""</span>) : <span class="hljs-literal">null</span>);
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"string"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              <p>去除字符串右端空格</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcStringTrimRight = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source</span>) </span>{
        <span class="hljs-keyword">var</span> value = source.toValue();
        <span class="hljs-keyword">return</span> context.genValue(isString(value) ? value.replace(<span class="hljs-regexp">/\s+$/g</span>, <span class="hljs-string">""</span>) : <span class="hljs-literal">null</span>);
    },
    <span class="hljs-attr">p</span>: [],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"string"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <p>获取字符串的子字符串，指定开始位置和长度</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcStringSubString = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, start, len</span>) </span>{
        <span class="hljs-keyword">var</span> value = source.toValue();
        <span class="hljs-keyword">var</span> left = start &gt;= <span class="hljs-number">0</span> ? start : value.toString().length + start;
        <span class="hljs-keyword">var</span> right = left + len;
        <span class="hljs-keyword">if</span> (left &gt; right) {
            right = left;
        }
        <span class="hljs-keyword">return</span> context.genValue(isString(value) &amp;&amp; isNumber(start) &amp;&amp; isNumber(len) ?
            value.substring(left, right) : <span class="hljs-literal">null</span>);
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"number"</span>, <span class="hljs-string">"number"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"string"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              <p>获取字符串的左子字符串，指定长度</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcStringLeftString = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, len</span>) </span>{
        <span class="hljs-keyword">var</span> value = source.toValue();
        <span class="hljs-keyword">return</span> context.genValue(isString(value) &amp;&amp; isNumber(len) ? value.substring(<span class="hljs-number">0</span>, len) : <span class="hljs-literal">null</span>);
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"number"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"string"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <p>获取字符串的右子字符串，指定长度</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcStringRightString = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, len</span>) </span>{
        <span class="hljs-keyword">var</span> value = source.toValue();
        <span class="hljs-keyword">return</span> context.genValue(isString(value) &amp;&amp; isNumber(len) ?
            value.substring(value.length - len, value.length) : <span class="hljs-literal">null</span>);
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"number"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"string"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-125">&#182;</a>
              </div>
              <p>检索字符串，获取子字符串在字符串中的起始位置</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcStringPos = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, subValue</span>) </span>{
        <span class="hljs-keyword">var</span> value = source.toValue();
        <span class="hljs-keyword">return</span> context.genValue(isString(value) &amp;&amp; isString(subValue) ?
            value.indexOf(subValue) : <span class="hljs-literal">null</span>);
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"string"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"number"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-126">&#182;</a>
              </div>
              <p>字符串替换</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcStringReplace = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, srcStr, desStr, model</span>) </span>{
        <span class="hljs-keyword">var</span> r;
        <span class="hljs-keyword">var</span> t;
        <span class="hljs-keyword">if</span> (model === <span class="hljs-literal">undefined</span>) {
            model = <span class="hljs-string">"g"</span>;
        }
        <span class="hljs-keyword">var</span> value = source.toValue();
        <span class="hljs-keyword">var</span> index = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">var</span> length = srcStr.length;
        <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^m?g?i?$/</span>.test(model)) {
            <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/g/</span>.test(model)) {
                <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/i/</span>.test(model)) {
                    index = value.toUpperCase().indexOf(srcStr.toUpperCase(), index);
                    <span class="hljs-keyword">while</span> (index !== <span class="hljs-number">-1</span>) {
                        t = value.split(<span class="hljs-string">""</span>);
                        <span class="hljs-keyword">var</span> param = [index, length];
                        param = param.concat(desStr.split(<span class="hljs-string">""</span>));
                        <span class="hljs-built_in">Array</span>.prototype.splice.apply(t, param);
                        value = t.join(<span class="hljs-string">""</span>);
                        index = value.toUpperCase().indexOf(srcStr.toUpperCase(), index);
                    }
                }
                <span class="hljs-keyword">else</span> {
                    index = value.indexOf(srcStr, index);
                    <span class="hljs-keyword">while</span> (index !== <span class="hljs-number">-1</span>) {
                        t = value.split(<span class="hljs-string">""</span>);
                        <span class="hljs-keyword">var</span> param = [index, length];
                        param = param.concat(desStr.split(<span class="hljs-string">""</span>));
                        <span class="hljs-built_in">Array</span>.prototype.splice.apply(t, param);
                        value = t.join(<span class="hljs-string">""</span>);
                        index = value.indexOf(srcStr, index);
                    }
                }
            }
            <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/i/</span>.test(model)) {
                    index = value.toUpperCase().indexOf(srcStr.toUpperCase(), index);
                    <span class="hljs-keyword">if</span> (index !== <span class="hljs-number">-1</span>) {
                        t = value.split(<span class="hljs-string">""</span>);
                        <span class="hljs-keyword">var</span> param = [index, length];
                        param = param.concat(desStr.split(<span class="hljs-string">""</span>));
                        <span class="hljs-built_in">Array</span>.prototype.splice.apply(t, param);
                        value = t.join(<span class="hljs-string">""</span>);
                    }
                }
                <span class="hljs-keyword">else</span> {
                    value = value.replace(srcStr, desStr);
                }
            }
        }
        <span class="hljs-keyword">else</span> {
            r = context.genErrorValue(format(locale.getLocale().MSG_EF_MODEL, model));
        }
        <span class="hljs-keyword">if</span> (!r) {
            r = context.genValue(value);
        }
        <span class="hljs-keyword">return</span> r;
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"string"</span>, <span class="hljs-string">"string"</span>, <span class="hljs-string">"string?"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"string"</span>,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-127">&#182;</a>
              </div>
              <p>正则替换</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> funcStringReplaceReg = {
    <span class="hljs-attr">fn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, source, srcStr, desStr, model</span>) </span>{
        <span class="hljs-keyword">var</span> r;
        <span class="hljs-keyword">if</span> (model === <span class="hljs-literal">undefined</span>) {
            model = <span class="hljs-string">"g"</span>;
        }
        <span class="hljs-keyword">var</span> value = source.toValue();
        <span class="hljs-keyword">var</span> regexp;
        <span class="hljs-keyword">try</span> {
            regexp = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(srcStr, model);
        }
        <span class="hljs-keyword">catch</span> (e) {
            r = context.genErrorValue(format(locale.getLocale().MSG_EF_MODEL, model));
        }
        value = value.replace(regexp, desStr);
        <span class="hljs-keyword">if</span> (!r) {
            r = context.genValue(value);
        }
        <span class="hljs-keyword">return</span> r;
    },
    <span class="hljs-attr">p</span>: [<span class="hljs-string">"string"</span>, <span class="hljs-string">"string"</span>, <span class="hljs-string">"string?"</span>],
    <span class="hljs-attr">r</span>: <span class="hljs-string">"string"</span>,
};
<span class="hljs-keyword">var</span> func_string = {
    <span class="hljs-attr">LeftString</span>: funcStringLeftString,
    <span class="hljs-attr">Length</span>: funcStringLength,
    <span class="hljs-attr">Lower</span>: funcStringLower,
    <span class="hljs-attr">Pos</span>: funcStringPos,
    <span class="hljs-attr">Replace</span>: funcStringReplace,
    <span class="hljs-attr">ReplaceReg</span>: funcStringReplaceReg,
    <span class="hljs-attr">RightString</span>: funcStringRightString,
    <span class="hljs-attr">SubString</span>: funcStringSubString,
    <span class="hljs-attr">ToDate</span>: funcStringToDate,
    <span class="hljs-attr">ToNumber</span>: funcStringToNumber,
    <span class="hljs-attr">ToString</span>: funcStringToString,
    <span class="hljs-attr">Trim</span>: funcStringTrim,
    <span class="hljs-attr">TrimLeft</span>: funcStringTrimLeft,
    <span class="hljs-attr">TrimRight</span>: funcStringTrimRight,
    <span class="hljs-attr">Upper</span>: funcStringUpper,
};

<span class="hljs-keyword">var</span> func = {
    <span class="hljs-attr">_</span>: func__,
    <span class="hljs-attr">array</span>: func_array,
    <span class="hljs-attr">boolean</span>: func_boolean,
    <span class="hljs-attr">date</span>: func_date,
    <span class="hljs-attr">number</span>: func_number,
    <span class="hljs-attr">object</span>: func_object,
    <span class="hljs-attr">string</span>: func_string,
};</pre></div></div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-128">&#182;</a>
              </div>
              <h2 id="-">词法分析器</h2>

            </div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-129">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> Lexer = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Lexer</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">this</span>.expr = []; <span class="hljs-comment">// 表达式字符数组</span>
        <span class="hljs-keyword">this</span>.index = <span class="hljs-number">0</span>; <span class="hljs-comment">// 当前索引位置</span>
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-130">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-130">&#182;</a>
              </div>
              <p>设置表达式</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Lexer.prototype.setExpr = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">expr</span>) </span>{
        <span class="hljs-keyword">this</span>.expr = expr ? expr.split(<span class="hljs-string">""</span>) : [];
        <span class="hljs-keyword">this</span>.reset();
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-131">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-131">&#182;</a>
              </div>
              <p>重置词法分析器，以便再次从头开始解析</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Lexer.prototype.reset = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">this</span>.index = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-132">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-132">&#182;</a>
              </div>
              <p>下一个Token结点</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Lexer.prototype.nextToken = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> s = <span class="hljs-keyword">this</span>.expr;
        <span class="hljs-keyword">var</span> n = <span class="hljs-keyword">this</span>.index;
        <span class="hljs-keyword">var</span> hasWrong = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">var</span> token;
        <span class="hljs-keyword">while</span> (n &lt; s.length) {
            <span class="hljs-keyword">if</span> (s[n] !== <span class="hljs-string">" "</span>) {
                <span class="hljs-keyword">break</span>;
            }
            <span class="hljs-keyword">else</span> {
                n++;
            }
        }
        <span class="hljs-keyword">var</span> tValue = <span class="hljs-string">""</span>;
        <span class="hljs-keyword">var</span> tType = <span class="hljs-string">""</span>;
        <span class="hljs-keyword">var</span> tText = <span class="hljs-string">""</span>;
        <span class="hljs-keyword">var</span> tIndex = n + <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (n &lt; s.length) {
            <span class="hljs-keyword">switch</span> (s[n]) {
                <span class="hljs-keyword">case</span> <span class="hljs-string">"["</span>:
                <span class="hljs-keyword">case</span> <span class="hljs-string">"]"</span>:
                <span class="hljs-keyword">case</span> <span class="hljs-string">"{"</span>:
                <span class="hljs-keyword">case</span> <span class="hljs-string">"}"</span>:
                <span class="hljs-keyword">case</span> <span class="hljs-string">"."</span>:
                <span class="hljs-keyword">case</span> <span class="hljs-string">"("</span>:
                <span class="hljs-keyword">case</span> <span class="hljs-string">")"</span>:
                <span class="hljs-keyword">case</span> <span class="hljs-string">"*"</span>:
                <span class="hljs-keyword">case</span> <span class="hljs-string">"/"</span>:
                <span class="hljs-keyword">case</span> <span class="hljs-string">"%"</span>:
                <span class="hljs-keyword">case</span> <span class="hljs-string">"+"</span>:
                <span class="hljs-keyword">case</span> <span class="hljs-string">"-"</span>:
                <span class="hljs-keyword">case</span> <span class="hljs-string">":"</span>:
                <span class="hljs-keyword">case</span> <span class="hljs-string">","</span>:
                    tText = tValue = s[n++];
                    tType =
                        tValue === <span class="hljs-string">"["</span> ? <span class="hljs-string">"TK_LA"</span> :
                            tValue === <span class="hljs-string">"]"</span> ? <span class="hljs-string">"TK_RA"</span> :
                                tValue === <span class="hljs-string">"{"</span> ? <span class="hljs-string">"TK_LO"</span> :
                                    tValue === <span class="hljs-string">"}"</span> ? <span class="hljs-string">"TK_RO"</span> :
                                        tValue === <span class="hljs-string">"."</span> ? <span class="hljs-string">"TK_DOT"</span> :
                                            tValue === <span class="hljs-string">"("</span> ? <span class="hljs-string">"TK_LP"</span> :
                                                tValue === <span class="hljs-string">")"</span> ? <span class="hljs-string">"TK_RP"</span> :
                                                    tValue === <span class="hljs-string">"*"</span> ? <span class="hljs-string">"TK_MULTI"</span> :
                                                        tValue === <span class="hljs-string">"/"</span> ? <span class="hljs-string">"TK_DIV"</span> :
                                                            tValue === <span class="hljs-string">"%"</span> ? <span class="hljs-string">"TK_MOD"</span> :
                                                                tValue === <span class="hljs-string">"+"</span> ? <span class="hljs-string">"TK_PLUS"</span> :
                                                                    tValue === <span class="hljs-string">"-"</span> ? <span class="hljs-string">"TK_MINUS"</span> :
                                                                        tValue === <span class="hljs-string">":"</span> ? <span class="hljs-string">"TK_COLON"</span> :
                                                                            tValue === <span class="hljs-string">","</span> ? <span class="hljs-string">"TK_COMMA"</span> :
                                                                                <span class="hljs-string">""</span>;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"!"</span>:
                    tValue = s[n++];
                    <span class="hljs-keyword">if</span> (n &lt; s.length &amp;&amp; s[n] === <span class="hljs-string">"="</span>) {
                        tValue += s[n++];
                        tType = <span class="hljs-string">"TK_CO"</span>;
                    }
                    <span class="hljs-keyword">else</span> {
                        tType = <span class="hljs-string">"TK_NOT"</span>;
                    }
                    tText = tValue;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"&gt;"</span>:
                <span class="hljs-keyword">case</span> <span class="hljs-string">"&lt;"</span>:
                    tValue = s[n++];
                    <span class="hljs-keyword">if</span> (n &lt; s.length &amp;&amp; s[n] === <span class="hljs-string">"="</span>) {
                        tValue += s[n++];
                    }
                    tText = tValue;
                    tType = <span class="hljs-string">"TK_CO"</span>;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"="</span>:
                <span class="hljs-keyword">case</span> <span class="hljs-string">"&amp;"</span>:
                <span class="hljs-keyword">case</span> <span class="hljs-string">"|"</span>:
                    tValue = s[n++];
                    <span class="hljs-keyword">if</span> (n &lt; s.length &amp;&amp; s[n] === tValue) {
                        tType =
                            tValue === <span class="hljs-string">"&amp;"</span> ? <span class="hljs-string">"TK_AND"</span> :
                                tValue === <span class="hljs-string">"|"</span> ? <span class="hljs-string">"TK_OR"</span> :
                                    <span class="hljs-string">"TK_CO"</span>;
                        tValue += s[n++];
                    }
                    <span class="hljs-keyword">else</span> {
                        tType = <span class="hljs-string">"TK_UNKNOWN"</span>;
                    }
                    tText = tValue;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"'"</span>:
                <span class="hljs-keyword">case</span> <span class="hljs-string">"\""</span>:
                    <span class="hljs-keyword">var</span> start = s[n];
                    <span class="hljs-keyword">var</span> v = [];
                    <span class="hljs-keyword">var</span> endFlag = <span class="hljs-literal">false</span>;
                    tValue += s[n++];
                    <span class="hljs-keyword">while</span> (!hasWrong &amp;&amp; n &lt; s.length) {
                        <span class="hljs-keyword">if</span> (s[n] === <span class="hljs-string">"\\"</span>) {
                            <span class="hljs-keyword">switch</span> (s[n + <span class="hljs-number">1</span>]) {
                                <span class="hljs-keyword">case</span> <span class="hljs-string">"\\"</span>:
                                    n++;
                                    v.push(<span class="hljs-string">"\\"</span>);
                                    <span class="hljs-keyword">break</span>;
                                <span class="hljs-keyword">case</span> <span class="hljs-string">"n"</span>:
                                    n++;
                                    v.push(<span class="hljs-string">"\n"</span>);
                                    <span class="hljs-keyword">break</span>;
                                <span class="hljs-keyword">case</span> <span class="hljs-string">"\'"</span>:
                                    n++;
                                    v.push(<span class="hljs-string">"\'"</span>);
                                    <span class="hljs-keyword">break</span>;
                                <span class="hljs-keyword">case</span> <span class="hljs-string">"\""</span>:
                                    n++;
                                    v.push(<span class="hljs-string">"\""</span>);
                                    <span class="hljs-keyword">break</span>;
                                <span class="hljs-keyword">case</span> <span class="hljs-string">"t"</span>:
                                    n++;
                                    v.push(<span class="hljs-string">"\t"</span>);
                                    <span class="hljs-keyword">break</span>;
                                <span class="hljs-keyword">case</span> <span class="hljs-string">"b"</span>:
                                    n++;
                                    v.push(<span class="hljs-string">"\b"</span>);
                                    <span class="hljs-keyword">break</span>;
                                <span class="hljs-keyword">case</span> <span class="hljs-string">"r"</span>:
                                    n++;
                                    v.push(<span class="hljs-string">"\r"</span>);
                                    <span class="hljs-keyword">break</span>;
                                <span class="hljs-keyword">case</span> <span class="hljs-string">"f"</span>:
                                    n++;
                                    v.push(<span class="hljs-string">"\f"</span>);
                                    <span class="hljs-keyword">break</span>;
                                <span class="hljs-keyword">case</span> <span class="hljs-string">"u"</span>:
                                    <span class="hljs-keyword">var</span> strU = s.join(<span class="hljs-string">""</span>).substring(n + <span class="hljs-number">2</span>, n + <span class="hljs-number">6</span>);
                                    <span class="hljs-keyword">if</span> (isX(s[n + <span class="hljs-number">2</span>]) &amp;&amp; isX(s[n + <span class="hljs-number">3</span>]) &amp;&amp; isX(s[n + <span class="hljs-number">4</span>]) &amp;&amp; isX(s[n + <span class="hljs-number">5</span>])) {
                                        v.push(<span class="hljs-built_in">String</span>.fromCharCode(<span class="hljs-built_in">parseInt</span>(strU, <span class="hljs-number">16</span>)));
                                        n += <span class="hljs-number">5</span>;
                                    }
                                    <span class="hljs-keyword">else</span> {
                                        hasWrong = <span class="hljs-literal">true</span>;
                                        token = {
                                            <span class="hljs-attr">tokenErrorMsg</span>: format(locale.getLocale().MSG_EL_SYNTAX_UC, <span class="hljs-string">"\\u"</span> + strU),
                                            <span class="hljs-attr">tokenIndex</span>: n,
                                            <span class="hljs-attr">tokenType</span>: <span class="hljs-string">"TK_STRING"</span>,
                                        };
                                    }
                                    <span class="hljs-keyword">break</span>;
                                <span class="hljs-keyword">case</span> <span class="hljs-string">"x"</span>:
                                    <span class="hljs-keyword">var</span> strX = s.join(<span class="hljs-string">""</span>).substring(n + <span class="hljs-number">2</span>, n + <span class="hljs-number">4</span>);
                                    <span class="hljs-keyword">if</span> (isX(s[n + <span class="hljs-number">2</span>]) &amp;&amp; isX(s[n + <span class="hljs-number">3</span>])) {
                                        v.push(<span class="hljs-built_in">String</span>.fromCharCode(<span class="hljs-built_in">parseInt</span>(strX, <span class="hljs-number">16</span>)));
                                        n += <span class="hljs-number">3</span>;
                                    }
                                    <span class="hljs-keyword">else</span> {
                                        hasWrong = <span class="hljs-literal">true</span>;
                                        token = {
                                            <span class="hljs-attr">tokenErrorMsg</span>: format(locale.getLocale().MSG_EL_SYNTAX_XN, <span class="hljs-string">"\\x"</span> + strX),
                                            <span class="hljs-attr">tokenIndex</span>: n,
                                            <span class="hljs-attr">tokenType</span>: <span class="hljs-string">"TK_STRING"</span>,
                                        };
                                    }
                                    <span class="hljs-keyword">break</span>;
                                <span class="hljs-keyword">case</span> <span class="hljs-string">"0"</span>:
                                <span class="hljs-keyword">case</span> <span class="hljs-string">"1"</span>:
                                <span class="hljs-keyword">case</span> <span class="hljs-string">"2"</span>:
                                <span class="hljs-keyword">case</span> <span class="hljs-string">"3"</span>:
                                <span class="hljs-keyword">case</span> <span class="hljs-string">"4"</span>:
                                <span class="hljs-keyword">case</span> <span class="hljs-string">"5"</span>:
                                <span class="hljs-keyword">case</span> <span class="hljs-string">"6"</span>:
                                <span class="hljs-keyword">case</span> <span class="hljs-string">"7"</span>:
                                    <span class="hljs-keyword">var</span> strN = s.join(<span class="hljs-string">""</span>).substring(n + <span class="hljs-number">1</span>, n + <span class="hljs-number">4</span>);
                                    <span class="hljs-keyword">if</span> (isO(s[n + <span class="hljs-number">1</span>]) &amp;&amp; isO(s[n + <span class="hljs-number">2</span>]) &amp;&amp; isO(s[n + <span class="hljs-number">3</span>])) {
                                        v.push(<span class="hljs-built_in">String</span>.fromCharCode(<span class="hljs-built_in">parseInt</span>(strN, <span class="hljs-number">8</span>)));
                                        n += <span class="hljs-number">3</span>;
                                    }
                                    <span class="hljs-keyword">else</span> {
                                        hasWrong = <span class="hljs-literal">true</span>;
                                        token = {
                                            <span class="hljs-attr">tokenErrorMsg</span>: format(locale.getLocale().MSG_EL_SYNTAX_ON, <span class="hljs-string">"\\"</span> + strN),
                                            <span class="hljs-attr">tokenIndex</span>: n,
                                            <span class="hljs-attr">tokenType</span>: <span class="hljs-string">"TK_STRING"</span>,
                                        };
                                    }
                                    <span class="hljs-keyword">break</span>;
                                <span class="hljs-keyword">default</span>:
                                    n++;
                                    v.push(s[n]);
                                    <span class="hljs-keyword">break</span>;
                            }
                        }
                        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (s[n] === start) {
                            endFlag = <span class="hljs-literal">true</span>;
                            <span class="hljs-keyword">break</span>;
                        }
                        <span class="hljs-keyword">else</span> {
                            v.push(s[n]);
                        }
                        n++;
                    }
                    <span class="hljs-keyword">if</span> (!hasWrong) {
                        <span class="hljs-keyword">if</span> (endFlag === <span class="hljs-literal">true</span>) {
                            tValue += v.join(<span class="hljs-string">""</span>) + start;
                        }
                        <span class="hljs-keyword">else</span> {
                            hasWrong = <span class="hljs-literal">true</span>;
                            token = {
                                <span class="hljs-attr">tokenErrorMsg</span>: format(locale.getLocale().MSG_EL_SYNTAX_S, tValue + v.join(<span class="hljs-string">""</span>)),
                                <span class="hljs-attr">tokenIndex</span>: n,
                                <span class="hljs-attr">tokenType</span>: <span class="hljs-string">"TK_STRING"</span>,
                            };
                            <span class="hljs-keyword">break</span>;
                        }
                        n++;
                        tText = tValue;
                        tValue = v.join(<span class="hljs-string">""</span>);
                        tType = <span class="hljs-string">"TK_STRING"</span>;
                    }
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">default</span>:
                    tValue = s[n++];
                    <span class="hljs-keyword">if</span> (isN(tValue)) {
                        <span class="hljs-keyword">while</span> (n &lt; s.length) {
                            <span class="hljs-keyword">if</span> (!isN(s[n]) || (s[n] === <span class="hljs-string">"."</span> &amp;&amp; !isN(s[n + <span class="hljs-number">1</span>]))) {
                                <span class="hljs-keyword">break</span>;
                            }
                            tValue += s[n++];
                        }
                        tType = isNS(tValue) ? <span class="hljs-string">"TK_NUMBER"</span> : <span class="hljs-string">"TK_UNKNOWN"</span>;
                    }
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isC(tValue)) {
                        <span class="hljs-keyword">while</span> (n &lt; s.length) {
                            <span class="hljs-keyword">if</span> (!isC(s[n])) {
                                <span class="hljs-keyword">break</span>;
                            }
                            tValue += s[n++];
                        }
                        <span class="hljs-keyword">switch</span> (tValue) {
                            <span class="hljs-keyword">case</span> <span class="hljs-string">"true"</span>:
                            <span class="hljs-keyword">case</span> <span class="hljs-string">"false"</span>:
                                tType = <span class="hljs-string">"TK_BOOL"</span>;
                                <span class="hljs-keyword">break</span>;
                            <span class="hljs-keyword">case</span> <span class="hljs-string">"null"</span>:
                                tType = <span class="hljs-string">"TK_NULL"</span>;
                                <span class="hljs-keyword">break</span>;
                            <span class="hljs-keyword">default</span>:
                                tType = <span class="hljs-string">"TK_IDEN"</span>;
                        }
                    }
                    <span class="hljs-keyword">else</span> {
                        <span class="hljs-keyword">while</span> (n &lt; s.length) {
                            <span class="hljs-keyword">if</span> (!isUN(s[n])) {
                                <span class="hljs-keyword">break</span>;
                            }
                            tValue += s[n++];
                        }
                        tType = <span class="hljs-string">"TK_UNKNOWN"</span>;
                    }
                    tText = tValue;
            }
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">if</span> (tType === <span class="hljs-string">"TK_PLUS"</span> || tType === <span class="hljs-string">"TK_MINUS"</span>) {
            <span class="hljs-keyword">var</span> j = n - tText.length - <span class="hljs-number">1</span>;
            <span class="hljs-keyword">while</span> (j &gt;= <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">if</span> (<span class="hljs-string">"({[+-*/%&gt;&lt;=&amp;|:,"</span>.indexOf(s[j]) &gt;= <span class="hljs-number">0</span>) {
                    tType = <span class="hljs-string">"TK_UNARY"</span>;
                    <span class="hljs-keyword">break</span>;
                }
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (s[j] !== <span class="hljs-string">" "</span>) {
                    <span class="hljs-keyword">break</span>;
                }
                j--;
            }
            <span class="hljs-keyword">if</span> (j === <span class="hljs-number">-1</span>) {
                tType = <span class="hljs-string">"TK_UNARY"</span>;
            }
        }
        <span class="hljs-keyword">this</span>.index = n;
        <span class="hljs-keyword">if</span> (!hasWrong) {
            token = {
                <span class="hljs-attr">tokenIndex</span>: tIndex,
                <span class="hljs-attr">tokenText</span>: tText,
                <span class="hljs-attr">tokenType</span>: tType,
                <span class="hljs-attr">tokenValue</span>: tValue,
            };
        }
        <span class="hljs-keyword">return</span> token;
    };
    <span class="hljs-keyword">return</span> Lexer;
}());</pre></div></div>
            
        </li>
        
        
        <li id="section-133">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-133">&#182;</a>
              </div>
              <h2 id="-">语法规则</h2>

            </div>
            
        </li>
        
        
        <li id="section-134">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-134">&#182;</a>
              </div>
              <p>节点类型</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> tokens = (<span class="hljs-string">"TK_UNKNOWN,TK_STRING,TK_NUMBER,TK_BOOL,TK_NULL,TK_IDEN,TK_DOT,TK_LP,TK_LA,"</span> +
    <span class="hljs-string">"TK_LO,TK_RP,TK_RA,TK_RO,TK_UNARY,TK_NOT,TK_MULTI,TK_DIV,TK_MOD,TK_PLUS,TK_MINUS,"</span> +
    <span class="hljs-string">"TK_CO,TK_AND,TK_OR,TK_COLON,TK_COMMA"</span>).split(<span class="hljs-string">","</span>);
<span class="hljs-keyword">var</span> genTokenState = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">tks, opts</span>) </span>{
    <span class="hljs-keyword">var</span> r = {};
    tks.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">v, i</span>) </span>{ <span class="hljs-keyword">return</span> r[v] = opts[i] === <span class="hljs-string">"1"</span>; });
    <span class="hljs-keyword">return</span> r;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-135">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-135">&#182;</a>
              </div>
              <p>起始节点规则</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> RULE_BTOKENS = genTokenState(tokens, <span class="hljs-string">"0111110111000110000000000"</span>.split(<span class="hljs-string">""</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-136">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-136">&#182;</a>
              </div>
              <p>结束节点规则</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> RULE_ETOKENS = genTokenState(tokens, <span class="hljs-string">"0111110000111000000000000"</span>.split(<span class="hljs-string">""</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-137">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-137">&#182;</a>
              </div>
              <p>后序节点规则</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> RULE_LEXICAL = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">tks, opts</span>) </span>{
    <span class="hljs-keyword">var</span> r = {};
    tks.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">v, i</span>) </span>{ <span class="hljs-keyword">return</span> r[v] = genTokenState(tks, opts[i].split(<span class="hljs-string">""</span>)); });
    <span class="hljs-keyword">return</span> r;
})(tokens, (<span class="hljs-string">"0000000000000000000000000,"</span> +
    <span class="hljs-string">"0000001010111001111111111,"</span> +
    <span class="hljs-string">"0000001000111001111111111,"</span> +
    <span class="hljs-string">"0000001000111001111111111,"</span> +
    <span class="hljs-string">"0000000000111001111111111,"</span> +
    <span class="hljs-string">"0000001110111001111111111,"</span> +
    <span class="hljs-string">"0000010000000000000000000,"</span> +
    <span class="hljs-string">"0111110111100110000000000,"</span> +
    <span class="hljs-string">"0111110111010110000000000,"</span> +
    <span class="hljs-string">"0111110000001000000000000,"</span> +
    <span class="hljs-string">"0000001010111001111111101,"</span> +
    <span class="hljs-string">"0000001010111001111111101,"</span> +
    <span class="hljs-string">"0000001011111001111111101,"</span> +
    <span class="hljs-string">"0111110111000110000000000,"</span> +
    <span class="hljs-string">"0111110111000110000000000,"</span> +
    <span class="hljs-string">"0111110111000110000000000,"</span> +
    <span class="hljs-string">"0111110111000110000000000,"</span> +
    <span class="hljs-string">"0111110111000110000000000,"</span> +
    <span class="hljs-string">"0111110111000110000000000,"</span> +
    <span class="hljs-string">"0111110111000110000000000,"</span> +
    <span class="hljs-string">"0111110111000110000000000,"</span> +
    <span class="hljs-string">"0111110111000110000000000,"</span> +
    <span class="hljs-string">"0111110111000110000000000,"</span> +
    <span class="hljs-string">"0111110111000110000000000,"</span> +
    <span class="hljs-string">"0111110111000110000000000"</span>
).split(<span class="hljs-string">","</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-138">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-138">&#182;</a>
              </div>
              <h2 id="-">语法解析器</h2>

            </div>
            
        </li>
        
        
        <li id="section-139">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-139">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> Parser = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Parser</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">this</span>.tokens = [];
        <span class="hljs-keyword">this</span>.rootToken = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">this</span>.errorMsg = <span class="hljs-string">""</span>;
        <span class="hljs-keyword">this</span>.lexer = <span class="hljs-keyword">new</span> Lexer();
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-140">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-140">&#182;</a>
              </div>
              <p>表达式解析</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Parser.prototype.parser = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">expr</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-141">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-141">&#182;</a>
              </div>
              <ul>
<li>初始化</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.doInit(expr);</pre></div></div>
            
        </li>
        
        
        <li id="section-142">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-142">&#182;</a>
              </div>
              <ul>
<li>构建Token双向链表</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.errorMsg === <span class="hljs-string">""</span>) {
            <span class="hljs-keyword">this</span>.errorMsg = <span class="hljs-keyword">this</span>.doDoublyLinkedList();
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-143">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-143">&#182;</a>
              </div>
              <ul>
<li>构建语法树，返回根节点</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.errorMsg === <span class="hljs-string">""</span>) {
            <span class="hljs-keyword">this</span>.rootToken = <span class="hljs-keyword">this</span>.doParser(<span class="hljs-keyword">this</span>.tokens);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-144">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-144">&#182;</a>
              </div>
              <ul>
<li>检查语法错误</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.errorMsg === <span class="hljs-string">""</span> &amp;&amp; <span class="hljs-keyword">this</span>.rootToken) {
            <span class="hljs-keyword">this</span>.errorMsg = <span class="hljs-keyword">this</span>.doCheckSyntax(<span class="hljs-keyword">this</span>.rootToken);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-145">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-145">&#182;</a>
              </div>
              <ul>
<li>返回自己</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-146">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-146">&#182;</a>
              </div>
              <p>初始化语法分析器对象，清空rootToken，tokens和errorMsg</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Parser.prototype.doInit = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">expr</span>) </span>{
        <span class="hljs-keyword">if</span> (!expr) {
            <span class="hljs-keyword">this</span>.errorMsg = locale.getLocale().MSG_EP_EMPTY;
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">this</span>.rootToken = <span class="hljs-literal">null</span>;
            <span class="hljs-keyword">this</span>.tokens = [];
            <span class="hljs-keyword">this</span>.errorMsg = <span class="hljs-string">""</span>;
            <span class="hljs-keyword">this</span>.lexer.setExpr(expr);
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-147">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-147">&#182;</a>
              </div>
              <p>创建虚节点</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Parser.prototype.doCreateVirtualToken = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">type</span>) </span>{
        <span class="hljs-keyword">var</span> v;
        <span class="hljs-keyword">switch</span> (type) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">"VTK_COMMA"</span>:
                v = <span class="hljs-string">","</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"VTK_PAREN"</span>:
                v = <span class="hljs-string">"()"</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"VTK_ARRAY"</span>:
                v = <span class="hljs-string">"[]"</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"VTK_OBJECT"</span>:
                v = <span class="hljs-string">"{}"</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"VTK_SUBSCRIPT"</span>:
                v = <span class="hljs-string">"[n]"</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"VTK_FUNCTION"</span>:
                v = <span class="hljs-string">"Fn()"</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">default</span>:
                v = <span class="hljs-string">""</span>;
        }
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">childs</span>: [],
            <span class="hljs-attr">parent</span>: <span class="hljs-literal">null</span>,
            <span class="hljs-attr">tokenText</span>: v,
            <span class="hljs-attr">tokenType</span>: type,
            <span class="hljs-attr">tokenValue</span>: v,
        };
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-148">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-148">&#182;</a>
              </div>
              <p>将表达式构建成Token双向链表</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Parser.prototype.doDoublyLinkedList = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> t = <span class="hljs-keyword">this</span>.lexer.nextToken();
        <span class="hljs-keyword">var</span> ts = <span class="hljs-keyword">this</span>.tokens;
        <span class="hljs-keyword">var</span> stack = [];
        <span class="hljs-keyword">var</span> r = <span class="hljs-string">""</span>;
        <span class="hljs-keyword">while</span> (!r &amp;&amp; t) {
            <span class="hljs-keyword">if</span> (t.tokenType === <span class="hljs-string">"TK_UNKNOWN"</span>) {
                r = format(locale.getLocale().MSG_EP_UNKNOWN, t.tokenText);
                <span class="hljs-keyword">break</span>;
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (t.tokenType === <span class="hljs-string">"TK_STRING"</span>) {
                <span class="hljs-keyword">if</span> (t.tokenErrorMsg) {
                    r = t.tokenErrorMsg;
                    <span class="hljs-keyword">break</span>;
                }
            }
            t.parent = <span class="hljs-literal">null</span>;
            t.childs = [];
            <span class="hljs-keyword">this</span>.tokens.push(t);</pre></div></div>
            
        </li>
        
        
        <li id="section-149">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-149">&#182;</a>
              </div>
              <ul>
<li>检查前后依赖关系正确性</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (ts.length === <span class="hljs-number">1</span> &amp;&amp; !RULE_BTOKENS[t.tokenType]) {
                r = format(locale.getLocale().MSG_EP_LEXICAL_B, t.tokenText);
                <span class="hljs-keyword">break</span>;
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ts.length !== <span class="hljs-number">1</span> &amp;&amp; !RULE_LEXICAL[ts[ts.length - <span class="hljs-number">2</span>].tokenType][t.tokenType]) {
               
                r = format(locale.getLocale().MSG_EP_LEXICAL_L, ts[ts.length - <span class="hljs-number">2</span>].tokenText, t.tokenText);
                <span class="hljs-keyword">break</span>;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-150">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-150">&#182;</a>
              </div>
              <ul>
<li>检查括号匹配正确性</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">switch</span> (t.tokenType) {
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_LP"</span>:
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_LA"</span>:
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_LO"</span>:
                    stack.push(t);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_RP"</span>:
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_RA"</span>:
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_RO"</span>:
                    <span class="hljs-keyword">if</span> (stack.length) {
                        <span class="hljs-keyword">if</span> (t.tokenType.replace(<span class="hljs-string">"R"</span>, <span class="hljs-string">"L"</span>) === stack[stack.length - <span class="hljs-number">1</span>].tokenType) {
                            stack.pop();
                        }
                        <span class="hljs-keyword">else</span> {
                            r = format(locale.getLocale().MSG_EP_MATCH, stack[stack.length - <span class="hljs-number">1</span>].tokenText);
                        }
                    }
                    <span class="hljs-keyword">else</span> {
                        r = format(locale.getLocale().MSG_EP_MATCH, t.tokenText);
                    }
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">default</span>:
                    <span class="hljs-keyword">break</span>;
            }
            t = <span class="hljs-keyword">this</span>.lexer.nextToken();
        }
        <span class="hljs-keyword">if</span> (!r &amp;&amp; !RULE_ETOKENS[ts[ts.length - <span class="hljs-number">1</span>].tokenType]) {
            r = format(locale.getLocale().MSG_EP_LEXICAL_E, ts[ts.length - <span class="hljs-number">1</span>].tokenText);
        }
        <span class="hljs-keyword">if</span> (!r &amp;&amp; stack.length) {
            r = format(locale.getLocale().MSG_EP_MATCH, stack[stack.length - <span class="hljs-number">1</span>].tokenText);
        }
        <span class="hljs-keyword">return</span> r;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-151">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-151">&#182;</a>
              </div>
              <p>构建语法树，返回根节点</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Parser.prototype.doParser = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ts</span>) </span>{
        <span class="hljs-keyword">var</span> p = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">if</span> (ts &amp;&amp; !ts.length) {
            <span class="hljs-keyword">return</span> p;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-152">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-152">&#182;</a>
              </div>
              <ul>
<li>处理 ()[]{} 括号节点</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        p = <span class="hljs-keyword">this</span>.doParser_0(ts);</pre></div></div>
            
        </li>
        
        
        <li id="section-153">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-153">&#182;</a>
              </div>
              <ul>
<li>处理能构成 function 的节点</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        p = <span class="hljs-keyword">this</span>.doParser_1(p);</pre></div></div>
            
        </li>
        
        
        <li id="section-154">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-154">&#182;</a>
              </div>
              <ul>
<li>处理 . [] 节点构成的子项调用</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        p = <span class="hljs-keyword">this</span>.doParser_2(p);</pre></div></div>
            
        </li>
        
        
        <li id="section-155">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-155">&#182;</a>
              </div>
              <ul>
<li>处理 + - ! 单目运算节点</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        p = <span class="hljs-keyword">this</span>.doParser_3(p);</pre></div></div>
            
        </li>
        
        
        <li id="section-156">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-156">&#182;</a>
              </div>
              <ul>
<li>处理 * / % 四则运算</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        p = <span class="hljs-keyword">this</span>.doParser_4(p, <span class="hljs-string">"TK_MULTI,TK_DIV,TK_MOD"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-157">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-157">&#182;</a>
              </div>
              <ul>
<li>处理 + - 四则运算</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        p = <span class="hljs-keyword">this</span>.doParser_4(p, <span class="hljs-string">"TK_PLUS,TK_MINUS"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-158">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-158">&#182;</a>
              </div>
              <ul>
<li>处理 &lt; &lt;= &gt; &gt;= == != 比较运算符</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        p = <span class="hljs-keyword">this</span>.doParser_4(p, <span class="hljs-string">"TK_CO,TK_EO"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-159">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-159">&#182;</a>
              </div>
              <ul>
<li>处理 &amp;&amp; 与运算</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        p = <span class="hljs-keyword">this</span>.doParser_4(p, <span class="hljs-string">"TK_AND"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-160">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-160">&#182;</a>
              </div>
              <ul>
<li>处理 || 或运算</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        p = <span class="hljs-keyword">this</span>.doParser_4(p, <span class="hljs-string">"TK_OR"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-161">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-161">&#182;</a>
              </div>
              <ul>
<li>处理 : 冒号</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        p = <span class="hljs-keyword">this</span>.doParser_4(p, <span class="hljs-string">"TK_COLON"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-162">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-162">&#182;</a>
              </div>
              <ul>
<li>处理 , 逗号</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        p = <span class="hljs-keyword">this</span>.doParser_5(p);
        <span class="hljs-keyword">if</span> (p.length &gt; <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">this</span>.errorMsg = <span class="hljs-string">"语法解析错误"</span>;
        }
        <span class="hljs-keyword">return</span> p[<span class="hljs-number">0</span>];
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-163">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-163">&#182;</a>
              </div>
              <p>检查语法错误</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Parser.prototype.doCheckSyntax = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">rootToken</span>) </span>{
        <span class="hljs-keyword">var</span> msg = <span class="hljs-string">""</span>;
        <span class="hljs-keyword">var</span> s;
        <span class="hljs-keyword">var</span> id = <span class="hljs-number">0</span>;
        eachToken(<span class="hljs-keyword">this</span>.rootToken, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
            t.id = id++;
            s = t.tokenText;
            <span class="hljs-keyword">switch</span> (t.tokenType) {</pre></div></div>
            
        </li>
        
        
        <li id="section-164">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-164">&#182;</a>
              </div>
              <ul>
<li>点操作符检查</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_DOT"</span>:
                    <span class="hljs-keyword">if</span> (t.childs[<span class="hljs-number">1</span>].tokenType === <span class="hljs-string">"TK_IDEN"</span> &amp;&amp;
                        !hasToken(<span class="hljs-string">"VTK_FUNCTION,TK_IDEN,TK_DOT,VTK_SUBSCRIPT,VTK_PAREN,VTK_OBJECT"</span>, t.childs[<span class="hljs-number">0</span>].tokenType)) {
                        msg = format(locale.getLocale().MSG_EP_SYNTAX_D, t.childs[<span class="hljs-number">0</span>].tokenType);
                    }
                    <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-165">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-165">&#182;</a>
              </div>
              <ul>
<li>冒号操作符检查</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_COLON"</span>:
                    <span class="hljs-keyword">if</span> (!t.parent || !hasToken(<span class="hljs-string">"VTK_OBJECT,VTK_COMMA"</span>, t.parent.tokenType)) {
                        msg = format(locale.getLocale().MSG_EP_SYNTAX_P, s);
                    }
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (t.childs &amp;&amp; t.childs[<span class="hljs-number">0</span>] &amp;&amp; t.childs[<span class="hljs-number">0</span>].childs &amp;&amp;
                        t.childs[<span class="hljs-number">0</span>].childs.length &gt; <span class="hljs-number">0</span>) {
                        msg = format(locale.getLocale().MSG_EP_SYNTAX_E, s);
                    }
                    <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-166">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-166">&#182;</a>
              </div>
              <ul>
<li>逗号操作符检查</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">case</span> <span class="hljs-string">"VTK_COMMA"</span>:
                    <span class="hljs-keyword">if</span> (!t.parent || !hasToken(<span class="hljs-string">"VTK_OBJECT,VTK_ARRAY,VTK_PAREN"</span>, t.parent.tokenType)) {
                        msg = format(locale.getLocale().MSG_EP_SYNTAX_C, s);
                    }
                    <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-167">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-167">&#182;</a>
              </div>
              <ul>
<li>小括号检查</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">case</span> <span class="hljs-string">"VTK_PAREN"</span>:
                    <span class="hljs-keyword">if</span> (t.parent &amp;&amp; t.parent.tokenType !== <span class="hljs-string">"TK_IDEN"</span> || !t.parent) {
                        <span class="hljs-keyword">if</span> (t.childs.length === <span class="hljs-number">0</span>) {
                            msg = format(locale.getLocale().MSG_EP_SYNTAX_N, s);
                        }
                        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (t.childs[<span class="hljs-number">0</span>].tokenType === <span class="hljs-string">"VTK_COMMA"</span>) {
                            msg = format(locale.getLocale().MSG_EP_SYNTAX_M, s);
                        }
                    }
                    <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-168">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-168">&#182;</a>
              </div>
              <ul>
<li>中括号检查</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">case</span> <span class="hljs-string">"VTK_ARRAY"</span>:
                    <span class="hljs-keyword">if</span> (t.childs &amp;&amp; t.childs.length &gt; <span class="hljs-number">0</span>) {
                        <span class="hljs-keyword">if</span> (t.childs[<span class="hljs-number">0</span>] === <span class="hljs-string">"TK_COLON"</span>) {
                            msg = format(locale.getLocale().MSG_EP_SYNTAX_A, <span class="hljs-string">":"</span>);
                        }
                        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (t.childs[<span class="hljs-number">0</span>].tokenType === <span class="hljs-string">"VTK_COMMA"</span>) {
                            <span class="hljs-keyword">if</span> (t.parent &amp;&amp; t.parent.tokenType === <span class="hljs-string">"VTK_SUBSCRIPT"</span> &amp;&amp;
                                t.parent.childs[<span class="hljs-number">0</span>] !== t) {
                                msg = format(locale.getLocale().MSG_EP_SYNTAX_SUB, <span class="hljs-string">","</span>);
                            }
                            <span class="hljs-keyword">if</span> (t.childs[<span class="hljs-number">0</span>].childs) {
                                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _i = <span class="hljs-number">0</span>, _a = t.childs[<span class="hljs-number">0</span>].childs; _i &lt; _a.length; _i++) {
                                    <span class="hljs-keyword">var</span> item = _a[_i];
                                    <span class="hljs-keyword">if</span> (item.tokenType === <span class="hljs-string">"TK_COLON"</span>) {
                                        msg = format(locale.getLocale().MSG_EP_SYNTAX_A, <span class="hljs-string">":"</span>);
                                        <span class="hljs-keyword">break</span>;
                                    }
                                }
                            }
                        }
                    }
                    <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-169">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-169">&#182;</a>
              </div>
              <ul>
<li>大括号检查</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">case</span> <span class="hljs-string">"VTK_OBJECT"</span>:
                    <span class="hljs-keyword">var</span> y = <span class="hljs-literal">false</span>;
                    <span class="hljs-keyword">if</span> (t.childs &amp;&amp; (t.childs.length === <span class="hljs-number">0</span> || hasToken(<span class="hljs-string">"TK_COLON,VTK_COMMA"</span>, t.childs[<span class="hljs-number">0</span>].tokenType))) {
                        <span class="hljs-keyword">if</span> (t.childs.length &gt; <span class="hljs-number">0</span> &amp;&amp; t.childs[<span class="hljs-number">0</span>].tokenType === <span class="hljs-string">"VTK_COMMA"</span>) {
                            <span class="hljs-keyword">if</span> (t.childs[<span class="hljs-number">0</span>].childs) {
                                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _b = <span class="hljs-number">0</span>, _c = t.childs[<span class="hljs-number">0</span>].childs; _b &lt; _c.length; _b++) {
                                    <span class="hljs-keyword">var</span> item = _c[_b];
                                    y = item.tokenType === <span class="hljs-string">"TK_COLON"</span>;
                                    <span class="hljs-keyword">if</span> (!y) {
                                        <span class="hljs-keyword">break</span>;
                                    }
                                }
                            }
                        }
                        <span class="hljs-keyword">else</span> {
                            y = <span class="hljs-literal">true</span>;
                        }
                    }
                    <span class="hljs-keyword">if</span> (!y) {
                        msg = locale.getLocale().MSG_EP_SYNTAX_O;
                    }
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">default</span>:
                    <span class="hljs-keyword">break</span>;
            }
            <span class="hljs-keyword">if</span> (msg !== <span class="hljs-string">""</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
        }, <span class="hljs-keyword">this</span>);
        <span class="hljs-keyword">return</span> msg;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-170">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-170">&#182;</a>
              </div>
              <p>() [] {}，将括号中的多个token拿出来计算并生成虚Token插入到原来的Token数组中</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Parser.prototype.doParser_0 = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ts</span>) </span>{
        <span class="hljs-keyword">var</span> t;
        <span class="hljs-keyword">var</span> l = [];
        <span class="hljs-keyword">var</span> counter = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">var</span> queue = [];
        <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (i &lt; ts.length) {
            t = ts[i];
            <span class="hljs-keyword">if</span> (hasToken(<span class="hljs-string">"TK_LP,TK_LA,TK_LO"</span>, t.tokenType)) {
                counter++;
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (hasToken(<span class="hljs-string">"TK_RP,TK_RA,TK_RO"</span>, t.tokenType)) {
                counter--;
            }
            <span class="hljs-keyword">if</span> (counter &gt; <span class="hljs-number">0</span>) {
                queue.push(t);
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (queue.length &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">var</span> root = queue.shift();
                <span class="hljs-keyword">var</span> rootType = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
                <span class="hljs-keyword">switch</span> (root.tokenType) {
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_LP"</span>:
                        rootType = <span class="hljs-string">"VTK_PAREN"</span>;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_LA"</span>:
                        rootType = <span class="hljs-string">"VTK_ARRAY"</span>;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_LO"</span>:
                        rootType = <span class="hljs-string">"VTK_OBJECT"</span>;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">default</span>: <span class="hljs-keyword">break</span>;
                }
                t = <span class="hljs-keyword">this</span>.doCreateVirtualToken(rootType);
                t.tokenIndex = root.tokenIndex;
                <span class="hljs-keyword">var</span> tmp = <span class="hljs-keyword">this</span>.doParser(queue);
                <span class="hljs-keyword">if</span> (tmp) {
                    t.childs.push(tmp);
                    tmp.parent = t;
                }
                l.push(t);
                queue = [];
            }
            <span class="hljs-keyword">else</span> {
                l.push(t);
            }
            i++;
        }
        <span class="hljs-keyword">return</span> l;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-171">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-171">&#182;</a>
              </div>
              <p>标识符与()相连构成函数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Parser.prototype.doParser_1 = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ts</span>) </span>{
        <span class="hljs-keyword">var</span> t;
        <span class="hljs-keyword">var</span> n;
        <span class="hljs-keyword">var</span> l = [];
        <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (i &lt; ts.length) {
            t = ts[i];
            n = ts[i + <span class="hljs-number">1</span>];
           
            <span class="hljs-keyword">if</span> (t.tokenType === <span class="hljs-string">"TK_IDEN"</span> &amp;&amp; n &amp;&amp; n.tokenType === <span class="hljs-string">"VTK_PAREN"</span>) {
                <span class="hljs-keyword">var</span> tmp = <span class="hljs-keyword">this</span>.doCreateVirtualToken(<span class="hljs-string">"VTK_FUNCTION"</span>);
                tmp.tokenIndex = t.tokenIndex;
                tmp.childs.push(t);
                t.parent = tmp;
                tmp.childs.push(n);
                n.parent = t;
                i++;
                l.push(tmp);
            }
            <span class="hljs-keyword">else</span> {
                l.push(t);
            }
            i++;
        }
        <span class="hljs-keyword">return</span> l;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-172">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-172">&#182;</a>
              </div>
              <p>处理 . [] 与标识符、string、()、[]、{}一起构成下标访问属性访问</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Parser.prototype.doParser_2 = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ts</span>) </span>{
        <span class="hljs-keyword">var</span> t;
        <span class="hljs-keyword">var</span> n;
        <span class="hljs-keyword">var</span> l = [];
        <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (i &lt; ts.length) {
            t = ts[i];
            n = ts[i + <span class="hljs-number">1</span>];
            <span class="hljs-keyword">if</span> (n &amp;&amp; (n.tokenType === <span class="hljs-string">"TK_DOT"</span> || n.tokenType === <span class="hljs-string">"VTK_ARRAY"</span> &amp;&amp; hasToken(<span class="hljs-string">"TK_IDEN,TK_STRING,VTK_PAREN,VTK_FUNCTION,VTK_ARRAY,VTK_OBJECT"</span>, t.tokenType))) {
                <span class="hljs-keyword">do</span> {
                    <span class="hljs-keyword">switch</span> (n.tokenType) {
                        <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_DOT"</span>:
                            n.childs.push(t);
                            t.parent = n;
                            i += <span class="hljs-number">2</span>;
                            t = ts[i];
                            n.childs.push(t);
                            t.parent = n;
                            t = n;
                            n = ts[i + <span class="hljs-number">1</span>];
                            <span class="hljs-keyword">break</span>;
                        <span class="hljs-keyword">case</span> <span class="hljs-string">"VTK_ARRAY"</span>:
                            <span class="hljs-keyword">var</span> tmp = <span class="hljs-keyword">this</span>.doCreateVirtualToken(<span class="hljs-string">"VTK_SUBSCRIPT"</span>);
                            tmp.childs.push(t);
                            t.parent = tmp;
                            tmp.childs.push(n);
                            n.parent = tmp;
                            t = tmp;
                            i++;
                            n = ts[i + <span class="hljs-number">1</span>];
                            <span class="hljs-keyword">break</span>;
                        <span class="hljs-keyword">default</span>:
                            <span class="hljs-keyword">break</span>;
                    }
                } <span class="hljs-keyword">while</span> (n &amp;&amp; (n.tokenType === <span class="hljs-string">"TK_DOT"</span> || n.tokenType === <span class="hljs-string">"VTK_ARRAY"</span>));
                l.push(t);
            }
            <span class="hljs-keyword">else</span> {
                l.push(t);
            }
            i++;
        }
        <span class="hljs-keyword">return</span> l;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-173">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-173">&#182;</a>
              </div>
              <p>处理 + - ! 单目运算</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Parser.prototype.doParser_3 = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ts</span>) </span>{
        <span class="hljs-keyword">var</span> t;
        <span class="hljs-keyword">var</span> l = [];
        <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (i &lt; ts.length) {
            t = ts[i];
            <span class="hljs-keyword">if</span> (hasToken(<span class="hljs-string">"TK_UNARY,TK_NOT"</span>, t.tokenType)) {
                l.push(t);
                <span class="hljs-keyword">do</span> {
                    <span class="hljs-keyword">var</span> tmp = ts[++i];
                    t.childs.push(tmp);
                    tmp.parent = t;
                    t = ts[i];
                } <span class="hljs-keyword">while</span> (hasToken(<span class="hljs-string">"TK_UNARY,TK_NOT"</span>, t.tokenType));
            }
            <span class="hljs-keyword">else</span> {
                l.push(t);
            }
            i++;
        }
        <span class="hljs-keyword">return</span> l;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-174">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-174">&#182;</a>
              </div>
              <p>处理 1.* / % 2.+ - 3.&lt; &lt;= &gt; &gt;= == != 4.&amp;&amp; 5.|| 6.: 优先级</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Parser.prototype.doParser_4 = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ts, tts</span>) </span>{
        <span class="hljs-keyword">var</span> t;
        <span class="hljs-keyword">var</span> n;
        <span class="hljs-keyword">var</span> l = [];
        <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (i &lt; ts.length) {
            t = ts[i];
            n = ts[i + <span class="hljs-number">1</span>];
            <span class="hljs-keyword">if</span> (n &amp;&amp; hasToken(tts, n.tokenType)) {
                <span class="hljs-keyword">var</span> tmp = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
                <span class="hljs-keyword">do</span> {
                    n.childs.push(t);
                    t.parent = n;
                    tmp = n;
                    i += <span class="hljs-number">2</span>;
                    t = ts[i];
                    n = ts[i + <span class="hljs-number">1</span>];
                    tmp.childs.push(t);
                    t.parent = tmp;
                    <span class="hljs-keyword">if</span> (n &amp;&amp; hasToken(tts, n.tokenType)) {
                        t = tmp;
                    }
                    <span class="hljs-keyword">else</span> {
                        <span class="hljs-keyword">break</span>;
                    }
                } <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>);
                l.push(tmp);
            }
            <span class="hljs-keyword">else</span> {
                l.push(t);
            }
            i++;
        }
        <span class="hljs-keyword">return</span> l;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-175">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-175">&#182;</a>
              </div>
              <p>处理 , 即对象字段分隔{a:1,b:’re’}或数组元素[1,2,3]，函数参数分隔符fun(a,b)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Parser.prototype.doParser_5 = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ts</span>) </span>{
        <span class="hljs-keyword">var</span> t;
        <span class="hljs-keyword">var</span> n;
        <span class="hljs-keyword">var</span> l = [];
        <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (i &lt; ts.length) {
            t = ts[i];
            n = ts[i + <span class="hljs-number">1</span>];
            <span class="hljs-keyword">if</span> (n &amp;&amp; n.tokenType === <span class="hljs-string">"TK_COMMA"</span>) {
                <span class="hljs-keyword">var</span> tmp = <span class="hljs-keyword">this</span>.doCreateVirtualToken(<span class="hljs-string">"VTK_COMMA"</span>);
                tmp.tokenIndex = n.tokenIndex;
                <span class="hljs-keyword">while</span> (n &amp;&amp; n.tokenType === <span class="hljs-string">"TK_COMMA"</span>) {
                    tmp.childs.push(t);
                    t.parent = tmp;
                    i += <span class="hljs-number">2</span>;
                    t = ts[i];
                    n = ts[i + <span class="hljs-number">1</span>];
                }
                tmp.childs.push(t);
                t.parent = tmp;
                l.push(tmp);
            }
            <span class="hljs-keyword">else</span> {
                l.push(t);
            }
            i++;
        }
        <span class="hljs-keyword">return</span> l;
    };
    <span class="hljs-keyword">return</span> Parser;
}());</pre></div></div>
            
        </li>
        
        
        <li id="section-176">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-176">&#182;</a>
              </div>
              <h2 id="-">类型</h2>

            </div>
            
        </li>
        
        
        <li id="section-177">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-177">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> Type = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-178">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-178">&#182;</a>
              </div>
              <p>类型构造函数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Type</span>(<span class="hljs-params">context, type, info, data, entity, depends, errorMsg</span>) </span>{
        <span class="hljs-keyword">this</span>.context = context;
        <span class="hljs-keyword">this</span>.type = type || <span class="hljs-string">"undefined"</span>;
        <span class="hljs-keyword">this</span>.info = info || type;
        <span class="hljs-keyword">this</span>.data = data;
        <span class="hljs-keyword">this</span>.entity = entity || <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">this</span>.depends = depends || <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">this</span>.errorMsg = errorMsg || <span class="hljs-string">""</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-179">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-179">&#182;</a>
              </div>
              <p>生成类型对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Type.prototype.genType = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">type, info, data, entity, depends, errorMsg</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Type(<span class="hljs-keyword">this</span>.context, type, info, data, entity, depends, errorMsg);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-180">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-180">&#182;</a>
              </div>
              <p>生成错误类型对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Type.prototype.genErrorType = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">errorMsg</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.genType(<span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, errorMsg);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-181">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-181">&#182;</a>
              </div>
              <p>该类型对象是否包含了数据</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Type.prototype.hasData = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.data !== <span class="hljs-literal">undefined</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-182">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-182">&#182;</a>
              </div>
              <p>得到类型值</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Type.prototype.toValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.type;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-183">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-183">&#182;</a>
              </div>
              <p>追加数组元素</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Type.prototype.arrayPush = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">et</span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"array"</span>) {
            <span class="hljs-keyword">this</span>.info.push(et.info);
            <span class="hljs-keyword">this</span>.data.push(et.data);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-184">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-184">&#182;</a>
              </div>
              <p>连接数组元素</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Type.prototype.arrayConcat = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">et</span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"array"</span> &amp;&amp; et.type === <span class="hljs-string">"array"</span>) {
            <span class="hljs-keyword">this</span>.info = <span class="hljs-keyword">this</span>.info.concat(et.info);
            <span class="hljs-keyword">this</span>.data = <span class="hljs-keyword">this</span>.data.concat(et.data);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-185">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-185">&#182;</a>
              </div>
              <p>设置对象属性</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Type.prototype.objectSetProperty = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">et</span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"object"</span>) {
            <span class="hljs-keyword">var</span> h = et.info;
            <span class="hljs-keyword">this</span>.info[h.key] = h.value;
            <span class="hljs-keyword">var</span> d = et.data;
            <span class="hljs-keyword">this</span>.data[d.key] = d.value;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-186">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-186">&#182;</a>
              </div>
              <p>批量设置对象属性</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Type.prototype.objectSetProperties = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">et</span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"object"</span> &amp;&amp; et.type === <span class="hljs-string">"array"</span>) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _i = <span class="hljs-number">0</span>, _a = et.info; _i &lt; _a.length; _i++) {
                <span class="hljs-keyword">var</span> item = _a[_i];
                <span class="hljs-keyword">this</span>.info[item.key] = item.value;
            }
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _b = <span class="hljs-number">0</span>, _c = et.data; _b &lt; _c.length; _b++) {
                <span class="hljs-keyword">var</span> item = _c[_b];
                <span class="hljs-keyword">this</span>.data[item.key] = item.value;
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-187">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-187">&#182;</a>
              </div>
              <p>取正/负值</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Type.prototype.negative = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">op</span>) </span>{
        <span class="hljs-keyword">var</span> t;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"undefined"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"number"</span>) {
            t = <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"number"</span>);
        }
        <span class="hljs-keyword">else</span> {
            t = op === <span class="hljs-string">"-"</span> ? locale.getLocale().MSG_EX_NEGATIVE : locale.getLocale().MSG_EX_POSITIVE;
            t = <span class="hljs-keyword">this</span>.genErrorType(format(t, <span class="hljs-keyword">this</span>.type));
        }
        <span class="hljs-keyword">return</span> t;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-188">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-188">&#182;</a>
              </div>
              <p>非运算</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Type.prototype.not = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"boolean"</span>);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-189">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-189">&#182;</a>
              </div>
              <p>乘法</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Type.prototype.multiply = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">et</span>) </span>{
        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span> &amp;&amp; et.type === <span class="hljs-string">"null"</span>) ? <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"null"</span>) :
            ((<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"number"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"undefined"</span>) &amp;&amp;
                (et.type === <span class="hljs-string">"number"</span> || et.type === <span class="hljs-string">"null"</span> || et.type === <span class="hljs-string">"undefined"</span>)) ? <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"number"</span>) :
                <span class="hljs-keyword">this</span>.genErrorType(format(locale.getLocale().MSG_EX_MULTIPLY, <span class="hljs-keyword">this</span>.type, et.type));
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-190">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-190">&#182;</a>
              </div>
              <p>除法</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Type.prototype.divide = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">et</span>) </span>{
        <span class="hljs-keyword">var</span> t;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span> &amp;&amp; et.type === <span class="hljs-string">"null"</span>) {
            t = <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"null"</span>);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"number"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"undefined"</span>) &amp;&amp;
            (et.type === <span class="hljs-string">"number"</span> || et.type === <span class="hljs-string">"undefined"</span>)) {
            t = (et.hasData() &amp;&amp; (et.data === <span class="hljs-string">"null"</span> || et.type === <span class="hljs-string">"number"</span> &amp;&amp; <span class="hljs-built_in">Number</span>(et.data) === <span class="hljs-number">0</span>)) ?
                <span class="hljs-keyword">this</span>.genErrorType(format(locale.getLocale().MSG_EX_DIVIDE_N, et.info)) :
                <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"number"</span>);
        }
        <span class="hljs-keyword">else</span> {
            t = <span class="hljs-keyword">this</span>.genErrorType(format(locale.getLocale().MSG_EX_DIVIDE, <span class="hljs-keyword">this</span>.type, et.type));
        }
        <span class="hljs-keyword">return</span> t;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-191">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-191">&#182;</a>
              </div>
              <p>求余</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Type.prototype.remainder = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">et</span>) </span>{
        <span class="hljs-keyword">var</span> t;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span> &amp;&amp; et.type === <span class="hljs-string">"null"</span>) {
            t = <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"null"</span>);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"number"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"undefined"</span>) &amp;&amp;
            (et.type === <span class="hljs-string">"number"</span> || et.type === <span class="hljs-string">"undefined"</span>)) {
            t = (et.hasData() &amp;&amp; (et.data === <span class="hljs-string">"null"</span> || et.type === <span class="hljs-string">"number"</span> &amp;&amp; <span class="hljs-built_in">Number</span>(et.data) === <span class="hljs-number">0</span>)) ?
                <span class="hljs-keyword">this</span>.genErrorType(format(locale.getLocale().MSG_EX_REMAINDER_N, et.info)) :
                <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"number"</span>);
        }
        <span class="hljs-keyword">else</span> {
            t = <span class="hljs-keyword">this</span>.genErrorType(format(locale.getLocale().MSG_EX_REMAINDER, <span class="hljs-keyword">this</span>.type, et.type));
        }
        <span class="hljs-keyword">return</span> t;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-192">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-192">&#182;</a>
              </div>
              <p>加法</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Type.prototype.add = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">et</span>) </span>{
        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"undefined"</span> &amp;&amp; et.type === <span class="hljs-string">"undefined"</span>) ? <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"undefined"</span>) :
            (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span> &amp;&amp; et.type === <span class="hljs-string">"null"</span>) ? <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"null"</span>) :
                ((<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"number"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"undefined"</span>) &amp;&amp;
                    (et.type === <span class="hljs-string">"number"</span> || et.type === <span class="hljs-string">"null"</span> || et.type === <span class="hljs-string">"undefined"</span>)) ? <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"number"</span>) :
                    ((<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"string"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"number"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span> ||
                        <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"undefined"</span>) &amp;&amp; (et.type === <span class="hljs-string">"string"</span> || et.type === <span class="hljs-string">"number"</span> ||
                        et.type === <span class="hljs-string">"null"</span> || et.type === <span class="hljs-string">"undefined"</span>)) ? <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"string"</span>) :
                        ((<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"array"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"undefined"</span>) &amp;&amp;
                            (et.type === <span class="hljs-string">"array"</span> || et.type === <span class="hljs-string">"null"</span> ||
                                et.type === <span class="hljs-string">"undefined"</span>)) ? <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"array"</span>) :
                            <span class="hljs-keyword">this</span>.genErrorType(format(locale.getLocale().MSG_EX_ADD, <span class="hljs-keyword">this</span>.type, et.type));
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-193">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-193">&#182;</a>
              </div>
              <p>减法</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Type.prototype.subtract = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">et</span>) </span>{
        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"undefined"</span> &amp;&amp; et.type === <span class="hljs-string">"undefined"</span>) ?
            <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"undefined"</span>) :
            (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span> &amp;&amp; et.type === <span class="hljs-string">"null"</span>) ?
                <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"null"</span>) :
                ((<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"number"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"undefined"</span>) &amp;&amp;
                    (et.type === <span class="hljs-string">"number"</span> || et.type === <span class="hljs-string">"null"</span> || et.type === <span class="hljs-string">"undefined"</span>)) ?
                    <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"number"</span>) :
                    ((<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"array"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"undefined"</span>) &amp;&amp;
                        (et.type === <span class="hljs-string">"array"</span> || et.type === <span class="hljs-string">"null"</span> || et.type === <span class="hljs-string">"undefined"</span>)) ?
                        <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"array"</span>) :
                        <span class="hljs-keyword">this</span>.genErrorType(format(locale.getLocale().MSG_EX_SUBTRACT, <span class="hljs-keyword">this</span>.type, et.type));
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-194">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-194">&#182;</a>
              </div>
              <p>等于</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Type.prototype.equal = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">et, op</span>) </span>{
        <span class="hljs-keyword">var</span> t;
        <span class="hljs-keyword">var</span> b = op === <span class="hljs-string">"=="</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"undefined"</span> || et.type === <span class="hljs-string">"undefined"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span> || et.type === <span class="hljs-string">"null"</span> ||
            <span class="hljs-keyword">this</span>.type === et.type) {
            t = <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"boolean"</span>);
        }
        <span class="hljs-keyword">else</span> {
            t = b ? locale.getLocale().MSG_EX_EQUAL : locale.getLocale().MSG_EX_EQUAL_N;
            t = <span class="hljs-keyword">this</span>.genErrorType(format(t, <span class="hljs-keyword">this</span>.type, et.type));
        }
        <span class="hljs-keyword">return</span> t;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-195">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-195">&#182;</a>
              </div>
              <p>比较运算</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Type.prototype.compare = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">et, op</span>) </span>{
        <span class="hljs-keyword">if</span> (op === <span class="hljs-string">"=="</span> || op === <span class="hljs-string">"!="</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.equal(et, op);
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">var</span> t = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"undefined"</span> || et.type === <span class="hljs-string">"undefined"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span> || et.type === <span class="hljs-string">"null"</span> ||
                (<span class="hljs-keyword">this</span>.type === et.type &amp;&amp; (et.type === <span class="hljs-string">"string"</span> || et.type === <span class="hljs-string">"date"</span> || et.type === <span class="hljs-string">"number"</span>))) {
                t = <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"boolean"</span>);
            }
            <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">switch</span> (op) {
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"&gt;"</span>:
                        t = locale.getLocale().MSG_EX_COMPARE_A;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"&lt;"</span>:
                        t = locale.getLocale().MSG_EX_COMPARE_B;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"&gt;="</span>:
                        t = locale.getLocale().MSG_EX_COMPARE_C;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"&lt;="</span>:
                        t = locale.getLocale().MSG_EX_COMPARE_D;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">default</span>: <span class="hljs-keyword">break</span>;
                }
                t = <span class="hljs-keyword">this</span>.genErrorType(format(t, <span class="hljs-keyword">this</span>.type, et.type));
            }
            <span class="hljs-keyword">return</span> t;
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-196">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-196">&#182;</a>
              </div>
              <p>与运算</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Type.prototype.and = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">et</span>) </span>{
        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"undefined"</span> || et.type === <span class="hljs-string">"undefined"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span> || et.type === <span class="hljs-string">"null"</span> ||
            (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"boolean"</span> &amp;&amp; et.type === <span class="hljs-string">"boolean"</span>)) ?
            <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"boolean"</span>) :
            <span class="hljs-keyword">this</span>.genErrorType(format(locale.getLocale().MSG_EX_AND, <span class="hljs-keyword">this</span>.type, et.type));
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-197">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-197">&#182;</a>
              </div>
              <p>或运算</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Type.prototype.or = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">et</span>) </span>{
        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"undefined"</span> || et.type === <span class="hljs-string">"undefined"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span> || et.type === <span class="hljs-string">"null"</span> ||
            (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"boolean"</span> &amp;&amp; et.type === <span class="hljs-string">"boolean"</span>)) ?
            <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"boolean"</span>) :
            <span class="hljs-keyword">this</span>.genErrorType(format(locale.getLocale().MSG_EX_OR, <span class="hljs-keyword">this</span>.type, et.type));
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-198">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-198">&#182;</a>
              </div>
              <p>下标运算</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Type.prototype.subscript = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">et</span>) </span>{
        <span class="hljs-keyword">var</span> t;
        <span class="hljs-keyword">var</span> i = (et.type === <span class="hljs-string">"array"</span>) ?
            et.info[<span class="hljs-number">0</span>] :
            et.info;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"string"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"array"</span>) {
            <span class="hljs-keyword">if</span> (i === <span class="hljs-string">"number"</span>) {
                t = (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"array"</span> &amp;&amp; <span class="hljs-keyword">this</span>.entity) ?
                    <span class="hljs-keyword">this</span>.context.getEntityType(<span class="hljs-keyword">this</span>) :
                    (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"string"</span>) ?
                        <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"string"</span>) :
                        <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"undefined"</span>);
            }
            <span class="hljs-keyword">else</span> {
                t = <span class="hljs-keyword">this</span>.genErrorType(format(locale.getLocale().MSG_EX_SUBSCRIPT_T, i));
            }
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"object"</span>) {
            t = <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"string"</span>, <span class="hljs-string">"string"</span>, i);
            t = t.getVariableType(<span class="hljs-keyword">this</span>);
        }
        <span class="hljs-keyword">else</span> {
            t = (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"undefined"</span>) ?
                <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"undefined"</span>) :
                <span class="hljs-keyword">this</span>.genErrorType(format(locale.getLocale().MSG_EX_SUBSCRIPT, <span class="hljs-keyword">this</span>.type));
        }
        <span class="hljs-keyword">return</span> t;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-199">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-199">&#182;</a>
              </div>
              <p>获取{key:…,value:…}键值对对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Type.prototype.hashItem = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">et</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"object"</span>, { <span class="hljs-attr">key</span>: <span class="hljs-keyword">this</span>.data, <span class="hljs-attr">value</span>: et.info }, { <span class="hljs-attr">key</span>: <span class="hljs-keyword">this</span>.data, <span class="hljs-attr">value</span>: et.data });
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-200">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-200">&#182;</a>
              </div>
              <p>获取变量值类型对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Type.prototype.getVariableType = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">et</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.context.getVariableType(<span class="hljs-keyword">this</span>.data, et);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-201">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-201">&#182;</a>
              </div>
              <p>获取函数返回结果类型对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Type.prototype.getFunctionType = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">et</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.context.getFunctionType(<span class="hljs-keyword">this</span>.info.key, et, <span class="hljs-keyword">this</span>.info.value, <span class="hljs-keyword">this</span>.data.value);
    };
    <span class="hljs-keyword">return</span> Type;
}());</pre></div></div>
            
        </li>
        
        
        <li id="section-202">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-202">&#182;</a>
              </div>
              <p>大数据值计算对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> Big = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">v</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Decimal(v);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-203">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-203">&#182;</a>
              </div>
              <h2 id="-">值</h2>

            </div>
            
        </li>
        
        
        <li id="section-204">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-204">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> Value = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-205">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-205">&#182;</a>
              </div>
              <p>值构造函数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Value</span>(<span class="hljs-params">context, value, type, entity, errorMsg, parentObj</span>) </span>{
        <span class="hljs-keyword">this</span>.context = context;
        <span class="hljs-keyword">this</span>.type = type ? type : getValueType(value);
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"number"</span>) {
            value += <span class="hljs-string">""</span>;
        }
        <span class="hljs-keyword">this</span>.value = value;
        <span class="hljs-keyword">this</span>.entity = entity || <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">this</span>.errorMsg = errorMsg || <span class="hljs-string">""</span>;
        <span class="hljs-keyword">this</span>.parentObj = parentObj || <span class="hljs-literal">null</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-206">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-206">&#182;</a>
              </div>
              <p>生成值对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.genValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value, type, entity, errorMsg, parentObj</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Value(<span class="hljs-keyword">this</span>.context, value, type, entity, errorMsg, parentObj);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-207">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-207">&#182;</a>
              </div>
              <p>生成错误值对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.genErrorValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">errorMsg</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.genValue(<span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, errorMsg, <span class="hljs-literal">undefined</span>);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-208">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-208">&#182;</a>
              </div>
              <p>得到值内容</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.toValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"number"</span> ? <span class="hljs-built_in">Number</span>(<span class="hljs-keyword">this</span>.value) : <span class="hljs-keyword">this</span>.value;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-209">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-209">&#182;</a>
              </div>
              <p>是否为实体</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.isEntity = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.entity != <span class="hljs-literal">null</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-210">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-210">&#182;</a>
              </div>
              <p>追加数组元素</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.arrayPush = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ev</span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"array"</span>) {
            ev = ev || <span class="hljs-keyword">this</span>.genValue(<span class="hljs-literal">null</span>);
            <span class="hljs-keyword">this</span>.toValue().push(ev.toValue());
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-211">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-211">&#182;</a>
              </div>
              <p>连接数组元素</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.arrayConcat = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ev</span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"array"</span> &amp;&amp; ev.type === <span class="hljs-string">"array"</span>) {
            <span class="hljs-keyword">this</span>.value = <span class="hljs-keyword">this</span>.toValue().concat(ev.toValue());
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-212">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-212">&#182;</a>
              </div>
              <p>设置对象属性</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.objectSetProperty = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ev</span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"object"</span>) {
            <span class="hljs-keyword">var</span> h = ev.toValue();
            <span class="hljs-keyword">this</span>.value[h.key] = h.value;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-213">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-213">&#182;</a>
              </div>
              <p>批量设置对象属性</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.objectSetProperties = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ev</span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"object"</span> &amp;&amp; ev.type === <span class="hljs-string">"array"</span>) {
            <span class="hljs-keyword">var</span> h = ev.toValue();
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _i = <span class="hljs-number">0</span>, h_1 = h; _i &lt; h_1.length; _i++) {
                <span class="hljs-keyword">var</span> item = h_1[_i];
                <span class="hljs-keyword">this</span>.value[item.key] = item.value;
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-214">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-214">&#182;</a>
              </div>
              <p>取正/负值</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.negative = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">op</span>) </span>{
        <span class="hljs-keyword">var</span> v;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span>) {
            v = <span class="hljs-keyword">this</span>.genValue(<span class="hljs-string">"0"</span>, <span class="hljs-string">"number"</span>);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"number"</span>) {
            v = op === <span class="hljs-string">"-"</span> ? Big(<span class="hljs-keyword">this</span>.value).times(Big(<span class="hljs-number">-1</span>)).toString() : <span class="hljs-keyword">this</span>.value;
            v = <span class="hljs-keyword">this</span>.genValue(v, <span class="hljs-string">"number"</span>);
        }
        <span class="hljs-keyword">else</span> {
            v = op === <span class="hljs-string">"-"</span> ? locale.getLocale().MSG_EX_NEGATIVE : locale.getLocale().MSG_EX_POSITIVE;
            v = <span class="hljs-keyword">this</span>.genErrorValue(format(v, <span class="hljs-keyword">this</span>.type));
        }
        <span class="hljs-keyword">return</span> v;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-215">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-215">&#182;</a>
              </div>
              <p>非运算</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.not = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"boolean"</span>) ?
            <span class="hljs-keyword">this</span>.genValue(!<span class="hljs-keyword">this</span>.value, <span class="hljs-string">"boolean"</span>) :
            (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"string"</span> &amp;&amp; <span class="hljs-keyword">this</span>.value === <span class="hljs-string">""</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"number"</span> &amp;&amp; <span class="hljs-keyword">this</span>.value === <span class="hljs-string">"0"</span>
                || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span>) ?
                <span class="hljs-keyword">this</span>.genValue(<span class="hljs-literal">true</span>, <span class="hljs-string">"boolean"</span>) :
                <span class="hljs-keyword">this</span>.genValue(<span class="hljs-literal">false</span>, <span class="hljs-string">"boolean"</span>);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-216">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-216">&#182;</a>
              </div>
              <p>乘法</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.multiply = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ev</span>) </span>{
        <span class="hljs-keyword">var</span> v;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span> &amp;&amp; ev.type === <span class="hljs-string">"null"</span>) {
            v = <span class="hljs-keyword">this</span>.genValue(<span class="hljs-literal">null</span>, <span class="hljs-string">"null"</span>);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"number"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span>) &amp;&amp; (ev.type === <span class="hljs-string">"number"</span> || ev.type === <span class="hljs-string">"null"</span>)) {
            <span class="hljs-keyword">var</span> vl = Big(<span class="hljs-keyword">this</span>.value || <span class="hljs-string">"0"</span>);
            <span class="hljs-keyword">var</span> vr = Big(ev.value || <span class="hljs-string">"0"</span>);
            v = <span class="hljs-keyword">this</span>.genValue(vl.times(vr).toString(), <span class="hljs-string">"number"</span>);
        }
        <span class="hljs-keyword">else</span> {
            v = <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EX_MULTIPLY, <span class="hljs-keyword">this</span>.type, ev.type));
        }
        <span class="hljs-keyword">return</span> v;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-217">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-217">&#182;</a>
              </div>
              <p>除法</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.divide = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ev</span>) </span>{
        <span class="hljs-keyword">var</span> v;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span> &amp;&amp; ev.type === <span class="hljs-string">"null"</span>) {
            v = <span class="hljs-keyword">this</span>.genValue(<span class="hljs-literal">null</span>, <span class="hljs-string">"null"</span>);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ev.type === <span class="hljs-string">"null"</span> || ev.type === <span class="hljs-string">"number"</span> &amp;&amp; ev.value === <span class="hljs-string">"0"</span>) {
            v = <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EX_DIVIDE_N, ev.value));
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"number"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span>) &amp;&amp; (ev.type === <span class="hljs-string">"number"</span>)) {
            <span class="hljs-keyword">var</span> vl = Big(<span class="hljs-keyword">this</span>.value || <span class="hljs-string">"0"</span>);
            <span class="hljs-keyword">var</span> vr = Big(ev.value);
            v = <span class="hljs-keyword">this</span>.genValue(vl.div(vr).toString(), <span class="hljs-string">"number"</span>);
        }
        <span class="hljs-keyword">else</span> {
            v = <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EX_DIVIDE, <span class="hljs-keyword">this</span>.type, ev.type));
        }
        <span class="hljs-keyword">return</span> v;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-218">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-218">&#182;</a>
              </div>
              <p>求余</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.remainder = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ev</span>) </span>{
        <span class="hljs-keyword">var</span> v;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span> &amp;&amp; ev.type === <span class="hljs-string">"null"</span>) {
            v = <span class="hljs-keyword">this</span>.genValue(<span class="hljs-literal">null</span>, <span class="hljs-string">"null"</span>);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ev.type === <span class="hljs-string">"null"</span> || ev.type === <span class="hljs-string">"number"</span> &amp;&amp; ev.value === <span class="hljs-string">"0"</span>) {
            v = <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EX_REMAINDER_N, ev.value));
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"number"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span>) &amp;&amp; (ev.type === <span class="hljs-string">"number"</span>)) {
            <span class="hljs-keyword">var</span> vl = Big(<span class="hljs-keyword">this</span>.value || <span class="hljs-string">"0"</span>);
            <span class="hljs-keyword">var</span> vr = Big(ev.value);
            v = <span class="hljs-keyword">this</span>.genValue(vl.mod(vr).toString(), <span class="hljs-string">"number"</span>);
        }
        <span class="hljs-keyword">else</span> {
            v = <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EX_REMAINDER, <span class="hljs-keyword">this</span>.type, ev.type));
        }
        <span class="hljs-keyword">return</span> v;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-219">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-219">&#182;</a>
              </div>
              <p>加法</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.add = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ev</span>) </span>{
        <span class="hljs-keyword">var</span> v;
        <span class="hljs-keyword">var</span> vl;
        <span class="hljs-keyword">var</span> vr;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span> &amp;&amp; ev.type === <span class="hljs-string">"null"</span>) {
            v = <span class="hljs-keyword">this</span>.genValue(<span class="hljs-literal">null</span>, <span class="hljs-string">"null"</span>);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"number"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span>) &amp;&amp; (ev.type === <span class="hljs-string">"number"</span> || ev.type === <span class="hljs-string">"null"</span>)) {
            vl = Big(<span class="hljs-keyword">this</span>.value || <span class="hljs-string">"0"</span>);
            vr = Big(ev.value || <span class="hljs-string">"0"</span>);
            v = <span class="hljs-keyword">this</span>.genValue(vl.plus(vr).toString(), <span class="hljs-string">"number"</span>);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"string"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span>) &amp;&amp; (ev.type === <span class="hljs-string">"string"</span> || ev.type === <span class="hljs-string">"null"</span>)) {
            vl = <span class="hljs-keyword">this</span>.toValue();
            vr = ev.toValue();
            vl = vl || <span class="hljs-string">""</span>;
            vr = vr || <span class="hljs-string">""</span>;
            v = <span class="hljs-keyword">this</span>.genValue(vl + vr, <span class="hljs-string">"string"</span>);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"array"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span>) &amp;&amp; (ev.type === <span class="hljs-string">"array"</span> || ev.type === <span class="hljs-string">"null"</span>)) {
            vl = <span class="hljs-keyword">this</span>.value || [];
            vr = ev.value || [];
            v = <span class="hljs-keyword">this</span>.genValue(vl.concat(vr), <span class="hljs-string">"array"</span>);
        }
        <span class="hljs-keyword">else</span> {
            v = <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EX_ADD, <span class="hljs-keyword">this</span>.type, ev.type));
        }
        <span class="hljs-keyword">return</span> v;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-220">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-220">&#182;</a>
              </div>
              <p>减法</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.subtract = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ev</span>) </span>{
        <span class="hljs-keyword">var</span> v;
        <span class="hljs-keyword">var</span> vl;
        <span class="hljs-keyword">var</span> vr;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span> &amp;&amp; ev.type === <span class="hljs-string">"null"</span>) {
            v = <span class="hljs-keyword">this</span>.genValue(<span class="hljs-literal">null</span>, <span class="hljs-string">"null"</span>);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"number"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span>) &amp;&amp; (ev.type === <span class="hljs-string">"number"</span> || ev.type === <span class="hljs-string">"null"</span>)) {
            vl = Big(<span class="hljs-keyword">this</span>.value || <span class="hljs-string">"0"</span>);
            vr = Big(ev.value || <span class="hljs-string">"0"</span>);
            v = <span class="hljs-keyword">this</span>.genValue(vl.minus(vr).toString(), <span class="hljs-string">"number"</span>);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"array"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span>) &amp;&amp; (ev.type === <span class="hljs-string">"array"</span> || ev.type === <span class="hljs-string">"null"</span>)) {
            vl = <span class="hljs-keyword">this</span>.value || [];
            vr = ev.value || [];
            v = [];
            <span class="hljs-keyword">var</span> found = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _i = <span class="hljs-number">0</span>, vl_1 = vl; _i &lt; vl_1.length; _i++) {
                <span class="hljs-keyword">var</span> left = vl_1[_i];
                found = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _a = <span class="hljs-number">0</span>, vr_1 = vr; _a &lt; vr_1.length; _a++) {
                    <span class="hljs-keyword">var</span> right = vr_1[_a];
                    found = compare(left, right);
                    <span class="hljs-keyword">if</span> (found) {
                        <span class="hljs-keyword">break</span>;
                    }
                }
                <span class="hljs-keyword">if</span> (!found) {
                    v.push(left);
                }
            }
            v = <span class="hljs-keyword">this</span>.genValue(v, <span class="hljs-string">"array"</span>);
        }
        <span class="hljs-keyword">else</span> {
            v = <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EX_SUBTRACT, <span class="hljs-keyword">this</span>.type, ev.type));
        }
        <span class="hljs-keyword">return</span> v;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-221">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-221">&#182;</a>
              </div>
              <p>等于</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.equal = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ev, op</span>) </span>{
        <span class="hljs-keyword">var</span> v;
        <span class="hljs-keyword">var</span> vl;
        <span class="hljs-keyword">var</span> vr;
        <span class="hljs-keyword">var</span> b = op === <span class="hljs-string">"=="</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span> &amp;&amp; ev.type === <span class="hljs-string">"null"</span>) {
            v = <span class="hljs-keyword">this</span>.genValue(b, <span class="hljs-string">"boolean"</span>);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span> || ev.type === <span class="hljs-string">"null"</span>) {
            v = <span class="hljs-keyword">this</span>.genValue(!b, <span class="hljs-string">"boolean"</span>);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"number"</span> &amp;&amp; ev.type === <span class="hljs-string">"number"</span>) {
            vl = Big(<span class="hljs-keyword">this</span>.value);
            vr = Big(ev.value);
            v = vl.equals(vr);
            v = <span class="hljs-keyword">this</span>.genValue(b ? v : !v, <span class="hljs-string">"boolean"</span>);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === ev.type) {
            v = compare(<span class="hljs-keyword">this</span>.value, ev.value);
            v = <span class="hljs-keyword">this</span>.genValue(b ? v : !v, <span class="hljs-string">"boolean"</span>);
        }
        <span class="hljs-keyword">else</span> {
            v = b ? locale.getLocale().MSG_EX_EQUAL : locale.getLocale().MSG_EX_EQUAL_N;
            v = <span class="hljs-keyword">this</span>.genErrorValue(format(v, <span class="hljs-keyword">this</span>.type, ev.type));
        }
        <span class="hljs-keyword">return</span> v;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-222">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-222">&#182;</a>
              </div>
              <p>比较运算</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.compare = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ev, op</span>) </span>{
        <span class="hljs-keyword">if</span> (op === <span class="hljs-string">"=="</span> || op === <span class="hljs-string">"!="</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.equal(ev, op);
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">var</span> v = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
            <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"string"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span>) &amp;&amp; (ev.type === <span class="hljs-string">"string"</span> || ev.type === <span class="hljs-string">"null"</span>)) {
                <span class="hljs-keyword">switch</span> (op) {
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"&gt;"</span>:
                        v = <span class="hljs-keyword">this</span>.value &gt; ev.value;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"&lt;"</span>:
                        v = <span class="hljs-keyword">this</span>.value &lt; ev.value;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"&gt;="</span>:
                        v = <span class="hljs-keyword">this</span>.value &gt;= ev.value;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"&lt;="</span>:
                        v = <span class="hljs-keyword">this</span>.value &lt;= ev.value;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">default</span>: <span class="hljs-keyword">break</span>;
                }
                v = <span class="hljs-keyword">this</span>.genValue(v, <span class="hljs-string">"boolean"</span>);
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"date"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span>) &amp;&amp; (ev.type === <span class="hljs-string">"date"</span> || ev.type === <span class="hljs-string">"null"</span>)) {
                v = <span class="hljs-keyword">this</span>.value - ev.value;
                <span class="hljs-keyword">switch</span> (op) {
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"&gt;"</span>:
                        v = v &gt; <span class="hljs-number">0</span>;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"&lt;"</span>:
                        v = v &lt; <span class="hljs-number">0</span>;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"&gt;="</span>:
                        v = v &gt;= <span class="hljs-number">0</span>;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"&lt;="</span>:
                        v = v &lt;= <span class="hljs-number">0</span>;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">default</span>: <span class="hljs-keyword">break</span>;
                }
                v = <span class="hljs-keyword">this</span>.genValue(v, <span class="hljs-string">"boolean"</span>);
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"number"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span>) &amp;&amp;
                (ev.type === <span class="hljs-string">"number"</span> || ev.type === <span class="hljs-string">"null"</span>)) {
                <span class="hljs-keyword">var</span> vl = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
                <span class="hljs-keyword">var</span> vr = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
                vl = Big(<span class="hljs-keyword">this</span>.value || <span class="hljs-string">"0"</span>);
                vr = Big(ev.value || <span class="hljs-string">"0"</span>);
                <span class="hljs-keyword">switch</span> (op) {
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"&gt;"</span>:
                        v = vl.greaterThan(vr);
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"&lt;"</span>:
                        v = vl.lessThan(vr);
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"&gt;="</span>:
                        v = vl.greaterThanOrEqualTo(vr);
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"&lt;="</span>:
                        v = vl.lessThanOrEqualTo(vr);
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">default</span>: <span class="hljs-keyword">break</span>;
                }
                v = <span class="hljs-keyword">this</span>.genValue(v, <span class="hljs-string">"boolean"</span>);
            }
            <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">switch</span> (op) {
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"&gt;"</span>:
                        v = locale.getLocale().MSG_EX_COMPARE_A;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"&lt;"</span>:
                        v = locale.getLocale().MSG_EX_COMPARE_B;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"&gt;="</span>:
                        v = locale.getLocale().MSG_EX_COMPARE_C;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"&lt;="</span>:
                        v = locale.getLocale().MSG_EX_COMPARE_D;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">default</span>: <span class="hljs-keyword">break</span>;
                }
                v = <span class="hljs-keyword">this</span>.genErrorValue(format(v, <span class="hljs-keyword">this</span>.type, ev.type));
            }
            <span class="hljs-keyword">return</span> v;
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-223">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-223">&#182;</a>
              </div>
              <p>与运算</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.and = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ev</span>) </span>{
        <span class="hljs-keyword">var</span> v;
        <span class="hljs-keyword">if</span> (!ev) {
            v = (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"boolean"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span>) ?
                <span class="hljs-keyword">this</span>.genValue(<span class="hljs-literal">false</span>, <span class="hljs-string">"boolean"</span>) :
                <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EX_AND_L, <span class="hljs-keyword">this</span>.type));
        }
        <span class="hljs-keyword">else</span> {
            v = (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"boolean"</span> &amp;&amp; (ev.type === <span class="hljs-string">"boolean"</span> || ev.type === <span class="hljs-string">"null"</span>)) ?
                <span class="hljs-keyword">this</span>.genValue(!!(<span class="hljs-keyword">this</span>.value &amp;&amp; ev.value), <span class="hljs-string">"boolean"</span>) :
                <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EX_AND, <span class="hljs-keyword">this</span>.type, ev.type));
        }
        <span class="hljs-keyword">return</span> v;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-224">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-224">&#182;</a>
              </div>
              <p>或运算</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.or = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ev</span>) </span>{
        <span class="hljs-keyword">var</span> v;
        <span class="hljs-keyword">if</span> (!ev) {
            v = (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"boolean"</span>) ?
                <span class="hljs-keyword">this</span>.genValue(<span class="hljs-literal">true</span>, <span class="hljs-string">"boolean"</span>) :
                <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EX_OR_L, <span class="hljs-keyword">this</span>.type));
        }
        <span class="hljs-keyword">else</span> {
            v = ((<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"boolean"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"null"</span>) &amp;&amp; (ev.type === <span class="hljs-string">"boolean"</span> || ev.type === <span class="hljs-string">"null"</span>)) ?
                <span class="hljs-keyword">this</span>.genValue(!!(<span class="hljs-keyword">this</span>.value || ev.value), <span class="hljs-string">"boolean"</span>) :
                <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EX_OR, <span class="hljs-keyword">this</span>.type, ev.type));
        }
        <span class="hljs-keyword">return</span> v;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-225">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-225">&#182;</a>
              </div>
              <p>下标运算</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.subscript = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ev</span>) </span>{
        <span class="hljs-keyword">var</span> v;
        <span class="hljs-keyword">var</span> i;
        <span class="hljs-keyword">var</span> t;
        <span class="hljs-keyword">if</span> (ev.type === <span class="hljs-string">"array"</span>) {
            i = ev.toValue()[<span class="hljs-number">0</span>];
            t = getValueType(i);
        }
        <span class="hljs-keyword">else</span> {
            i = ev.toValue();
            t = ev.type;
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"string"</span> || <span class="hljs-keyword">this</span>.type === <span class="hljs-string">"array"</span>) {
            <span class="hljs-keyword">if</span> (t === <span class="hljs-string">"number"</span>) {
                v = <span class="hljs-keyword">this</span>.toValue();
                <span class="hljs-keyword">if</span> (v.length &gt; i &amp;&amp; i &gt;= <span class="hljs-number">0</span> &amp;&amp; v.length &gt; <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"array"</span> &amp;&amp; <span class="hljs-keyword">this</span>.entity) {
                        v = <span class="hljs-keyword">this</span>.context.getEntityValue(<span class="hljs-keyword">this</span>, i);
                    }
                    <span class="hljs-keyword">else</span> {
                        v = v[i];
                        v = <span class="hljs-keyword">this</span>.genValue(v, getValueType(v), <span class="hljs-literal">null</span>);
                    }
                }
                <span class="hljs-keyword">else</span> {
                    v = <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EX_SUBSCRIPT_U, <span class="hljs-keyword">this</span>.type, i));
                }
            }
            <span class="hljs-keyword">else</span> {
                v = <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EX_SUBSCRIPT_T, i));
            }
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">"object"</span>) {
            v = <span class="hljs-keyword">this</span>.genValue(i);
            v = v.getVariableValue(<span class="hljs-keyword">this</span>);
        }
        <span class="hljs-keyword">else</span> {
            v = <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EX_SUBSCRIPT, <span class="hljs-keyword">this</span>.type));
        }
        <span class="hljs-keyword">return</span> v;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-226">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-226">&#182;</a>
              </div>
              <p>获取{key:…,value:…}键值对对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.hashItem = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ev</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.genValue({ <span class="hljs-attr">key</span>: <span class="hljs-keyword">this</span>.toValue(), <span class="hljs-attr">value</span>: ev.toValue() }, <span class="hljs-string">"object"</span>);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-227">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-227">&#182;</a>
              </div>
              <p>获取变量值</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.getVariableValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ev</span>) </span>{
        <span class="hljs-keyword">return</span> (ev &amp;&amp; ev.type !== <span class="hljs-string">"object"</span>) ?
            <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EX_DOT, ev.type)) :
            <span class="hljs-keyword">this</span>.context.getVariableValue(<span class="hljs-keyword">this</span>.toValue(), ev);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-228">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-228">&#182;</a>
              </div>
              <p>获取函数返回结果值</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.getFunctionValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ev</span>) </span>{
        <span class="hljs-keyword">var</span> v = <span class="hljs-keyword">this</span>.toValue();
        <span class="hljs-keyword">return</span> (ev &amp;&amp; ev.value === <span class="hljs-literal">null</span>) ?
            <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EX_FUNC_NULL, v.key)) :
            <span class="hljs-keyword">this</span>.context.getFunctionValue(v.key, ev, v.value);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-229">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-229">&#182;</a>
              </div>
              <p>绝对值</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.abs = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> v = Big(<span class="hljs-keyword">this</span>.value || <span class="hljs-string">"0"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.genValue(v.abs().toString(), <span class="hljs-string">"number"</span>);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-230">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-230">&#182;</a>
              </div>
              <p>向上取整</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.ceil = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> v = Big(<span class="hljs-keyword">this</span>.value || <span class="hljs-string">"0"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.genValue(v.ceil().toString(), <span class="hljs-string">"number"</span>);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-231">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-231">&#182;</a>
              </div>
              <p>向下取整</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.floor = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> v = Big(<span class="hljs-keyword">this</span>.value || <span class="hljs-string">"0"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.genValue(v.floor().toString(), <span class="hljs-string">"number"</span>);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-232">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-232">&#182;</a>
              </div>
              <p>四舍五入保留scale位小数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.round = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">scale</span>) </span>{
        <span class="hljs-keyword">var</span> v;
        <span class="hljs-keyword">if</span> (scale &gt;= <span class="hljs-number">0</span>) {
            v = Big(<span class="hljs-keyword">this</span>.value || <span class="hljs-string">"0"</span>);
            v = v.toDecimalPlaces(scale, <span class="hljs-number">4</span>);
            v = <span class="hljs-keyword">this</span>.genValue(v.toString(), <span class="hljs-string">"number"</span>);
        }
        <span class="hljs-keyword">else</span> {
            v = <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EX_ROUND, scale));
        }
        <span class="hljs-keyword">return</span> v;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-233">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-233">&#182;</a>
              </div>
              <p>按精度截断数据</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.trunc = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">scale</span>) </span>{
        <span class="hljs-keyword">var</span> v;
        <span class="hljs-keyword">if</span> (scale &gt;= <span class="hljs-number">0</span>) {
            v = Big(<span class="hljs-keyword">this</span>.value || <span class="hljs-string">"0"</span>);
            v = v.toDecimalPlaces(scale, <span class="hljs-number">1</span>);
            v = <span class="hljs-keyword">this</span>.genValue(v.toString(), <span class="hljs-string">"number"</span>);
        }
        <span class="hljs-keyword">else</span> {
            v = <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EX_TRUNC, scale));
        }
        <span class="hljs-keyword">return</span> v;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-234">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-234">&#182;</a>
              </div>
              <p>获取数的余弦</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.cos = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> v = Big(<span class="hljs-keyword">this</span>.value || <span class="hljs-string">"0"</span>);
        <span class="hljs-keyword">var</span> name = <span class="hljs-string">"cos"</span>;
        v = v[name]();
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.genValue(v.toString(), <span class="hljs-string">"number"</span>);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-235">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-235">&#182;</a>
              </div>
              <p>获取 e 的指数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.exp = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> v = Big(<span class="hljs-keyword">this</span>.value || <span class="hljs-string">"0"</span>);
        v = v.exp();
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.genValue(v.toString(), <span class="hljs-string">"number"</span>);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-236">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-236">&#182;</a>
              </div>
              <p>获取数的自然对数（底为 e）</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.ln = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> value;
        <span class="hljs-keyword">var</span> v = Big(<span class="hljs-keyword">this</span>.value || <span class="hljs-string">"0"</span>);
        <span class="hljs-keyword">if</span> (v.greaterThan(<span class="hljs-string">"0"</span>)) {
            v = v.ln();
            value = <span class="hljs-keyword">this</span>.genValue(v.toString(), <span class="hljs-string">"number"</span>);
        }
        <span class="hljs-keyword">else</span> {
            value = <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EX_LN, v.toString()));
        }
        <span class="hljs-keyword">return</span> value;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-237">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-237">&#182;</a>
              </div>
              <p>获取数的指定底数的对数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.log = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">base</span>) </span>{
        <span class="hljs-keyword">var</span> value;
        <span class="hljs-keyword">var</span> v = Big(<span class="hljs-keyword">this</span>.value || <span class="hljs-string">"0"</span>);
        <span class="hljs-keyword">if</span> (v.greaterThan(<span class="hljs-string">"0"</span>) &amp;&amp; base &gt; <span class="hljs-number">0</span> &amp;&amp; base !== <span class="hljs-number">1</span>) {
            v = v.log(base);
            value = <span class="hljs-keyword">this</span>.genValue(v.toString(), <span class="hljs-string">"number"</span>);
        }
        <span class="hljs-keyword">else</span> {
            value = <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EX_LOG, base, v.toString()));
        }
        <span class="hljs-keyword">return</span> value;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-238">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-238">&#182;</a>
              </div>
              <p>获取数的指定指数的次幂</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.power = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">exponent</span>) </span>{
        <span class="hljs-keyword">var</span> v = Big(<span class="hljs-keyword">this</span>.value || <span class="hljs-string">"0"</span>);
        v = v.pow(exponent);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.genValue(v.toString(), <span class="hljs-string">"number"</span>);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-239">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-239">&#182;</a>
              </div>
              <p>获取数的正弦</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.sin = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> v = Big(<span class="hljs-keyword">this</span>.value || <span class="hljs-string">"0"</span>);
        <span class="hljs-keyword">var</span> name = <span class="hljs-string">"sin"</span>;
        v = v[name]();
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.genValue(v.toString(), <span class="hljs-string">"number"</span>);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-240">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-240">&#182;</a>
              </div>
              <p>获取数的平方根</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.sqrt = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> v = Big(<span class="hljs-keyword">this</span>.value || <span class="hljs-string">"0"</span>);
        v = v.sqrt();
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.genValue(v.toString(), <span class="hljs-string">"number"</span>);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-241">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-241">&#182;</a>
              </div>
              <p>获取树的正切值</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Value.prototype.tan = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> v = Big(<span class="hljs-keyword">this</span>.value || <span class="hljs-string">"0"</span>);
        <span class="hljs-keyword">var</span> name = <span class="hljs-string">"tan"</span>;
        v = v[name]();
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.genValue(v.toString(), <span class="hljs-string">"number"</span>);
    };
    <span class="hljs-keyword">return</span> Value;
}());</pre></div></div>
            
        </li>
        
        
        <li id="section-242">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-242">&#182;</a>
              </div>
              <h2 id="-">上下文基类</h2>

            </div>
            
        </li>
        
        
        <li id="section-243">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-243">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> Context = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Context</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">this</span>.exprList = [];
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-244">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-244">&#182;</a>
              </div>
              <p>生成ExprValue对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Context.prototype.genValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value, type, entity, errorMsg, parentObj</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Value(<span class="hljs-keyword">this</span>, value, type, entity, errorMsg, parentObj);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-245">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-245">&#182;</a>
              </div>
              <p>有错误时，生成对应的ExprValue对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Context.prototype.genErrorValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">errorMsg</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.genValue(<span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, errorMsg, <span class="hljs-literal">undefined</span>);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-246">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-246">&#182;</a>
              </div>
              <p>生成ExprType对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Context.prototype.genType = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">type, info, data, entity, depends, errorMsg</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Type(<span class="hljs-keyword">this</span>, type, info, data, entity, depends, errorMsg);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-247">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-247">&#182;</a>
              </div>
              <p>有错误时，生成对应的ExprType对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Context.prototype.genErrorType = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">errorMsg</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.genType(<span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, errorMsg);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-248">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-248">&#182;</a>
              </div>
              <p>得到函数source.name(paramValue)返回值的ExprType对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Context.prototype.getFunctionType = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, source, paramType, paramData</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.doGetFunctionType(name, source, paramType, paramData);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-249">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-249">&#182;</a>
              </div>
              <p>得到函数source.name(paramValue)执行结果</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Context.prototype.getFunctionValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, source, paramValue</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.doGetFunctionValue(name, source, paramValue);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-250">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-250">&#182;</a>
              </div>
              <p>得到变量类型</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Context.prototype.getVariableType = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, source</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.doGetVariableType(name, source);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-251">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-251">&#182;</a>
              </div>
              <p>得到对象source的name属性值</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Context.prototype.getVariableValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, source</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.doGetVariableValue(name, source);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-252">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-252">&#182;</a>
              </div>
              <p>得到实体类型</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Context.prototype.getEntityType = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">source</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.doGetEntityType(source);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-253">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-253">&#182;</a>
              </div>
              <p>从实体数组source中取出第index条实体记录</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Context.prototype.getEntityValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">source, index</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.doGetEntityValue(source, index);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-254">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-254">&#182;</a>
              </div>
              <p>得到解析信息</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Context.prototype.getParserInfo = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">expr</span>) </span>{
        expr = expr.trim();
        <span class="hljs-keyword">var</span> index = <span class="hljs-number">-1</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.exprList.length; i++) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.exprList[i].text === expr) {
                index = i;
                <span class="hljs-keyword">break</span>;
            }
        }
        <span class="hljs-keyword">var</span> r;
        <span class="hljs-keyword">if</span> (index &gt;= <span class="hljs-number">0</span>) {
            r = <span class="hljs-keyword">this</span>.exprList[index].parser;
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">var</span> p = <span class="hljs-keyword">new</span> Parser();
            r = p.parser(expr);
            <span class="hljs-keyword">this</span>.exprList.push({
                <span class="hljs-attr">parser</span>: r,
                <span class="hljs-attr">text</span>: expr,
            });
        }
        <span class="hljs-keyword">return</span> r;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-255">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-255">&#182;</a>
              </div>
              <p>是否为IfNull(1,2)函数形式的”,”结点</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Context.prototype.isIfNullToken = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">token</span>) </span>{
        <span class="hljs-keyword">return</span> isFunctionToken(token, <span class="hljs-keyword">this</span>.doGetIfNullName());
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-256">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-256">&#182;</a>
              </div>
              <p>是否为IIf(true,1,2)函数形式的”,”结点</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Context.prototype.isIIfToken = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">token</span>) </span>{
        <span class="hljs-keyword">return</span> isFunctionToken(token, <span class="hljs-keyword">this</span>.doGetIIfName());
    };
    Context.prototype.doGetIfNullName = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>; };
    Context.prototype.doGetIIfName = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>; };
    Context.prototype.doGetVariableType = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, source</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-257">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-257">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>    };
    Context.prototype.doGetVariableValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, source</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-258">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-258">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>    };
    Context.prototype.doGetFunctionType = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, source, paramType, paramData</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-259">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-259">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>    };
    Context.prototype.doGetFunctionValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, source, paramValue</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-260">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-260">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>    };
    Context.prototype.doGetEntityType = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">source</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-261">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-261">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>    };
    Context.prototype.doGetEntityValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">source, index</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-262">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-262">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>    };
    <span class="hljs-keyword">return</span> Context;
}());</pre></div></div>
            
        </li>
        
        
        <li id="section-263">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-263">&#182;</a>
              </div>
              <h2 id="-">表达式计算</h2>

            </div>
            
        </li>
        
        
        <li id="section-264">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-264">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> Calc = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Calc</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">this</span>.context = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">this</span>.values = {};
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-265">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-265">&#182;</a>
              </div>
              <p>生成ExprValue对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Calc.prototype.genValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value, type, entity, errorMsg, parentObj</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Value(<span class="hljs-keyword">this</span>.context, value, type, entity, errorMsg, parentObj);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-266">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-266">&#182;</a>
              </div>
              <p>有错误时，生成对应的ExprValue对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Calc.prototype.genErrorValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">errorMsg</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.genValue(<span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, errorMsg, <span class="hljs-literal">undefined</span>);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-267">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-267">&#182;</a>
              </div>
              <p>根据token结点ID返回对应的ExprValue对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Calc.prototype.getValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">tokenId</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.values[tokenId];
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-268">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-268">&#182;</a>
              </div>
              <p>设置某token结点ID对应的ExprValue对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Calc.prototype.setValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">tokenId, v</span>) </span>{
        <span class="hljs-keyword">this</span>.values[tokenId] = v;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-269">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-269">&#182;</a>
              </div>
              <p>对表达式进行语法分析和数值计算</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Calc.prototype.calc = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">expr, context</span>) </span>{
        <span class="hljs-keyword">this</span>.context = context || <span class="hljs-keyword">new</span> Context();
        <span class="hljs-keyword">var</span> r;
        <span class="hljs-keyword">var</span> p = <span class="hljs-keyword">this</span>.context.getParserInfo(expr);
        <span class="hljs-keyword">if</span> (p.errorMsg === <span class="hljs-string">""</span>) {
            <span class="hljs-keyword">var</span> msg = <span class="hljs-keyword">this</span>.doCalc(p.rootToken);
            <span class="hljs-keyword">if</span> (msg === <span class="hljs-string">""</span>) {
                r = <span class="hljs-keyword">this</span>.getValue(p.rootToken.id);
                r.tokens = p.tokens;
                r.rootToken = p.rootToken;
            }
            <span class="hljs-keyword">else</span> {
                r = <span class="hljs-keyword">this</span>.genErrorValue(msg);
            }
        }
        <span class="hljs-keyword">else</span> {
            r = <span class="hljs-keyword">this</span>.genErrorValue(p.errorMsg);
        }
        <span class="hljs-keyword">return</span> r;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-270">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-270">&#182;</a>
              </div>
              <p>对表达式进行数值计算</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Calc.prototype.doCalc = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">rootToken</span>) </span>{
        <span class="hljs-keyword">var</span> t = rootToken;
        <span class="hljs-keyword">var</span> p = t.parent;
        <span class="hljs-keyword">var</span> msg = <span class="hljs-string">""</span>;
        <span class="hljs-keyword">var</span> l;
        <span class="hljs-keyword">var</span> r;
        <span class="hljs-keyword">var</span> tv = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">var</span> lv;
        <span class="hljs-keyword">var</span> rv;
        <span class="hljs-keyword">if</span> (t.childs) {
            <span class="hljs-keyword">var</span> isIfNull = <span class="hljs-keyword">this</span>.context.isIfNullToken(t);
            <span class="hljs-keyword">var</span> isIIf = <span class="hljs-keyword">this</span>.context.isIIfToken(t);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; t.childs.length; i++) {
                msg = <span class="hljs-keyword">this</span>.doCalc(t.childs[i]);
                <span class="hljs-keyword">if</span> (msg !== <span class="hljs-string">""</span>) {
                    <span class="hljs-keyword">break</span>;
                }
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i === <span class="hljs-number">0</span>) {
                    l = t.childs[<span class="hljs-number">0</span>];
                    lv = <span class="hljs-keyword">this</span>.getValue(l.id);
                    <span class="hljs-keyword">if</span> (isIfNull &amp;&amp; lv.toValue() !== <span class="hljs-literal">null</span>) {
                        <span class="hljs-keyword">break</span>;
                    }
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isIIf &amp;&amp; !lv.toValue()) {
                        i++;
                    }
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (t.tokenType === <span class="hljs-string">"TK_OR"</span> &amp;&amp; !!lv.toValue() === <span class="hljs-literal">true</span> ||
                        t.tokenType === <span class="hljs-string">"TK_AND"</span> &amp;&amp; !!lv.toValue() === <span class="hljs-literal">false</span>) {
                        <span class="hljs-keyword">break</span>;
                    }
                }
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i === <span class="hljs-number">1</span>) {
                    r = t.childs[<span class="hljs-number">1</span>];
                    rv = <span class="hljs-keyword">this</span>.getValue(r.id);
                    <span class="hljs-keyword">if</span> (isIIf) {
                        <span class="hljs-keyword">break</span>;
                    }
                }
            }
        }
        <span class="hljs-keyword">if</span> (msg === <span class="hljs-string">""</span>) {
            <span class="hljs-keyword">switch</span> (t.tokenType) {
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_STRING"</span>:
                    tv = <span class="hljs-keyword">this</span>.genValue(t.tokenValue, <span class="hljs-string">"string"</span>);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_NUMBER"</span>:
                    tv = <span class="hljs-keyword">this</span>.genValue(t.tokenValue, <span class="hljs-string">"number"</span>);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_BOOL"</span>:
                    tv = <span class="hljs-keyword">this</span>.genValue(t.tokenValue === <span class="hljs-string">"true"</span>, <span class="hljs-string">"boolean"</span>);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_NULL"</span>:
                    tv = <span class="hljs-keyword">this</span>.genValue(<span class="hljs-literal">null</span>, <span class="hljs-string">"null"</span>);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_IDEN"</span>:
                    tv = <span class="hljs-keyword">this</span>.genValue(t.tokenValue, <span class="hljs-string">"string"</span>);
                    <span class="hljs-keyword">if</span> (isIDENToken(t)) {
                        tv = tv.getVariableValue(<span class="hljs-literal">null</span>);
                    }
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_UNARY"</span>:
                    tv = lv.negative(t.tokenValue);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_NOT"</span>:
                    tv = lv.not();
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_MULTI"</span>:
                    tv = lv.multiply(rv);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_DIV"</span>:
                    tv = lv.divide(rv);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_MOD"</span>:
                    tv = lv.remainder(rv);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_PLUS"</span>:
                    tv = lv.add(rv);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_MINUS"</span>:
                    tv = lv.subtract(rv);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_CO"</span>:
                    tv = lv.compare(rv, t.tokenValue);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_AND"</span>:
                    tv = lv.and(rv);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_OR"</span>:
                    tv = lv.or(rv);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_COLON"</span>:
                    tv = lv.hashItem(rv);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_DOT"</span>:
                    <span class="hljs-keyword">switch</span> (r.tokenType) {
                        <span class="hljs-keyword">case</span> <span class="hljs-string">"VTK_FUNCTION"</span>:
                            tv = rv.getFunctionValue(lv);
                            <span class="hljs-keyword">break</span>;
                        <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_IDEN"</span>:
                            tv = rv.getVariableValue(lv);
                            <span class="hljs-keyword">break</span>;
                        <span class="hljs-keyword">default</span>:
                            <span class="hljs-keyword">break</span>;
                    }
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"VTK_COMMA"</span>:
                    tv = <span class="hljs-keyword">this</span>.genValue([], <span class="hljs-string">"array"</span>);
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _i = <span class="hljs-number">0</span>, _a = t.childs; _i &lt; _a.length; _i++) {
                        <span class="hljs-keyword">var</span> item = _a[_i];
                        lv = <span class="hljs-keyword">this</span>.getValue(item.id);
                        tv.arrayPush(lv);
                    }
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"VTK_PAREN"</span>:
                    tv = (t.childs.length === <span class="hljs-number">0</span>) ?
                        <span class="hljs-keyword">this</span>.genValue([], <span class="hljs-string">"array"</span>) :
                        (p &amp;&amp; p.tokenType === <span class="hljs-string">"TK_IDEN"</span> &amp;&amp; l.tokenType !== <span class="hljs-string">"VTK_COMMA"</span>) ?
                            <span class="hljs-keyword">this</span>.genValue([], <span class="hljs-string">"array"</span>).arrayPush(lv) :
                            lv;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"VTK_ARRAY"</span>:
                    tv = <span class="hljs-keyword">this</span>.genValue([], <span class="hljs-string">"array"</span>);
                    <span class="hljs-keyword">if</span> (t.childs.length &gt; <span class="hljs-number">0</span>) {
                        <span class="hljs-keyword">if</span> (l.tokenType === <span class="hljs-string">"VTK_COMMA"</span>) {
                            tv.arrayConcat(lv);
                        }
                        <span class="hljs-keyword">else</span> {
                            tv.arrayPush(lv);
                        }
                    }
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"VTK_OBJECT"</span>:
                    tv = <span class="hljs-keyword">this</span>.genValue({}, <span class="hljs-string">"object"</span>);
                    <span class="hljs-keyword">if</span> (t.childs.length &gt; <span class="hljs-number">0</span>) {
                        <span class="hljs-keyword">if</span> (l.tokenType === <span class="hljs-string">"VTK_COMMA"</span>) {
                            tv.objectSetProperties(lv);
                        }
                        <span class="hljs-keyword">else</span> {
                            tv.objectSetProperty(lv);
                        }
                    }
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"VTK_SUBSCRIPT"</span>:
                    tv = lv.subscript(rv);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"VTK_FUNCTION"</span>:
                    tv = (p &amp;&amp; p.tokenType === <span class="hljs-string">"TK_DOT"</span> &amp;&amp; p.childs[<span class="hljs-number">0</span>] !== t) ?
                        lv.hashItem(rv) :
                        lv.hashItem(rv).getFunctionValue(<span class="hljs-literal">null</span>);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">default</span>:
                    <span class="hljs-keyword">break</span>;
            }
            msg = tv.errorMsg;
            <span class="hljs-keyword">if</span> (msg === <span class="hljs-string">""</span>) {
                <span class="hljs-keyword">this</span>.setValue(t.id, tv);
            }
        }
        <span class="hljs-keyword">return</span> msg;
    };
    <span class="hljs-keyword">return</span> Calc;
}());</pre></div></div>
            
        </li>
        
        
        <li id="section-271">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-271">&#182;</a>
              </div>
              <h2 id="-">表达式检查</h2>

            </div>
            
        </li>
        
        
        <li id="section-272">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-272">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> Check = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Check</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">this</span>.context = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">this</span>.types = {};
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-273">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-273">&#182;</a>
              </div>
              <p>生成ExprType对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Check.prototype.genType = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">type, info, data, entity, depends, errorMsg</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Type(<span class="hljs-keyword">this</span>.context, type, info, data, entity, depends, errorMsg);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-274">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-274">&#182;</a>
              </div>
              <p>有错误时，生成对应的ExprType对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Check.prototype.genErrorType = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">errorMsg</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.genType(<span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, errorMsg);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-275">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-275">&#182;</a>
              </div>
              <p>根据token结点ID返回对应ExprType对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Check.prototype.getType = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">tokenId</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.types[tokenId];
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-276">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-276">&#182;</a>
              </div>
              <p>设置某token结点ID对应的ExprType对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Check.prototype.setType = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">tokenId, t</span>) </span>{
        <span class="hljs-keyword">this</span>.types[tokenId] = t;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-277">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-277">&#182;</a>
              </div>
              <p>对表达式进行语法分析和依赖关系计算</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Check.prototype.check = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">expr, context</span>) </span>{
        <span class="hljs-keyword">var</span> _this = <span class="hljs-keyword">this</span>;
        <span class="hljs-keyword">this</span>.context = context || <span class="hljs-keyword">new</span> Context();
        <span class="hljs-keyword">var</span> r;
        <span class="hljs-keyword">var</span> p = <span class="hljs-keyword">this</span>.context.getParserInfo(expr);
        <span class="hljs-keyword">if</span> (p.errorMsg === <span class="hljs-string">""</span>) {
            <span class="hljs-keyword">var</span> msg = <span class="hljs-keyword">this</span>.doCheck(p.rootToken);
            <span class="hljs-keyword">if</span> (msg === <span class="hljs-string">""</span>) {
                r = <span class="hljs-keyword">this</span>.getType(p.rootToken.id);
                r.tokens = p.tokens;
                r.rootToken = p.rootToken;
                <span class="hljs-keyword">var</span> ds_1 = [];
                <span class="hljs-keyword">var</span> pushDepends_1 = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) </span>{
                    <span class="hljs-keyword">if</span> (getValueType(d) === <span class="hljs-string">"array"</span>) {
                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _i = <span class="hljs-number">0</span>, d_1 = d; _i &lt; d_1.length; _i++) {
                            <span class="hljs-keyword">var</span> item = d_1[_i];
                            pushDepends_1(item);
                        }
                    }
                    <span class="hljs-keyword">else</span> {
                        <span class="hljs-keyword">var</span> f = <span class="hljs-literal">false</span>;
                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _a = <span class="hljs-number">0</span>, ds_2 = ds_1; _a &lt; ds_2.length; _a++) {
                            <span class="hljs-keyword">var</span> item = ds_2[_a];
                            f = item === d;
                            <span class="hljs-keyword">if</span> (f) {
                                <span class="hljs-keyword">break</span>;
                            }
                        }
                        <span class="hljs-keyword">if</span> (!f) {
                            ds_1.push(d);
                        }
                    }
                };
                eachToken(r.rootToken, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">token</span>) </span>{
                    <span class="hljs-keyword">var</span> tt = _this.getType(token.id);
                    <span class="hljs-keyword">if</span> (tt) {
                        <span class="hljs-keyword">if</span> (tt.depends) {
                            pushDepends_1(tt.depends);
                        }
                        <span class="hljs-keyword">var</span> e = tt.entity;
                        <span class="hljs-keyword">if</span> (e) {
                            <span class="hljs-keyword">var</span> pp = token.parent;
                            <span class="hljs-keyword">var</span> pt = pp ? _this.getType(pp.id) : <span class="hljs-literal">null</span>;
                            <span class="hljs-keyword">if</span> (!pt || !pt.entity) {
                                pushDepends_1(e.fullName);
                            }
                        }
                    }
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }, <span class="hljs-keyword">this</span>);
                r.dependencies = ds_1;
            }
            <span class="hljs-keyword">else</span> {
                r = <span class="hljs-keyword">this</span>.genErrorType(msg);
            }
        }
        <span class="hljs-keyword">else</span> {
            r = <span class="hljs-keyword">this</span>.genErrorType(p.errorMsg);
        }
        <span class="hljs-keyword">return</span> r;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-278">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-278">&#182;</a>
              </div>
              <p>检查表达式运算关系正确性</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Check.prototype.doCheck = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">rootToken</span>) </span>{
        <span class="hljs-keyword">var</span> t = rootToken;
        <span class="hljs-keyword">var</span> p = t.parent;
        <span class="hljs-keyword">var</span> msg = <span class="hljs-string">""</span>;
        <span class="hljs-keyword">var</span> l;
        <span class="hljs-keyword">var</span> r;
        <span class="hljs-keyword">var</span> tt = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">var</span> lt;
        <span class="hljs-keyword">var</span> rt;
        <span class="hljs-keyword">if</span> (t.childs) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; t.childs.length; i++) {
                msg = <span class="hljs-keyword">this</span>.doCheck(t.childs[i]);
                <span class="hljs-keyword">if</span> (msg !== <span class="hljs-string">""</span>) {
                    <span class="hljs-keyword">break</span>;
                }
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i === <span class="hljs-number">0</span>) {
                    l = t.childs[<span class="hljs-number">0</span>];
                    lt = <span class="hljs-keyword">this</span>.getType(l.id);
                }
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i === <span class="hljs-number">1</span>) {
                    r = t.childs[<span class="hljs-number">1</span>];
                    rt = <span class="hljs-keyword">this</span>.getType(r.id);
                }
            }
        }
        <span class="hljs-keyword">if</span> (msg === <span class="hljs-string">""</span>) {
            <span class="hljs-keyword">switch</span> (t.tokenType) {
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_STRING"</span>:
                    tt = <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"string"</span>, <span class="hljs-string">"string"</span>, t.tokenValue);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_NUMBER"</span>:
                    tt = <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"number"</span>, <span class="hljs-string">"number"</span>, t.tokenValue);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_BOOL"</span>:
                    tt = <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"boolean"</span>, <span class="hljs-string">"boolean"</span>, t.tokenValue);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_NULL"</span>:
                    tt = <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"null"</span>, <span class="hljs-string">"null"</span>, t.tokenValue);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_IDEN"</span>:
                    tt = <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"string"</span>, <span class="hljs-string">"string"</span>, t.tokenValue);
                    <span class="hljs-keyword">if</span> (isIDENToken(t)) {
                        tt = tt.getVariableType(<span class="hljs-literal">null</span>);
                    }
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_UNARY"</span>:
                    tt = lt.negative(t.tokenValue);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_NOT"</span>:
                    tt = lt.not();
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_MULTI"</span>:
                    tt = lt.multiply(rt);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_DIV"</span>:
                    tt = lt.divide(rt);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_MOD"</span>:
                    tt = lt.remainder(rt);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_PLUS"</span>:
                    tt = lt.add(rt);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_MINUS"</span>:
                    tt = lt.subtract(rt);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_CO"</span>:
                    tt = lt.compare(rt, t.tokenValue);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_AND"</span>:
                    tt = lt.and(rt);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_OR"</span>:
                    tt = lt.or(rt);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_COLON"</span>:
                    tt = lt.hashItem(rt);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_DOT"</span>:
                    <span class="hljs-keyword">switch</span> (r.tokenType) {
                        <span class="hljs-keyword">case</span> <span class="hljs-string">"VTK_FUNCTION"</span>:
                            tt = rt.getFunctionType(lt);
                            <span class="hljs-keyword">break</span>;
                        <span class="hljs-keyword">case</span> <span class="hljs-string">"TK_IDEN"</span>:
                            tt = rt.getVariableType(lt);
                            <span class="hljs-keyword">break</span>;
                        <span class="hljs-keyword">default</span>:
                            <span class="hljs-keyword">break</span>;
                    }
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"VTK_COMMA"</span>:
                    tt = <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"array"</span>, [], []);
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _i = <span class="hljs-number">0</span>, _a = t.childs; _i &lt; _a.length; _i++) {
                        <span class="hljs-keyword">var</span> item = _a[_i];
                        lt = <span class="hljs-keyword">this</span>.getType(item.id);
                        tt.arrayPush(lt);
                    }
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"VTK_PAREN"</span>:
                    <span class="hljs-keyword">if</span> (t.childs.length === <span class="hljs-number">0</span>) {
                        tt = (p &amp;&amp; p.tokenType === <span class="hljs-string">"TK_IDEN"</span>) ?
                            <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"array"</span>, [], []) :
                            <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"undefined"</span>);
                    }
                    <span class="hljs-keyword">else</span> {
                        tt = (p &amp;&amp; p.tokenType === <span class="hljs-string">"TK_IDEN"</span> &amp;&amp; l.tokenType !== <span class="hljs-string">"VTK_COMMA"</span>) ?
                            <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"array"</span>, [], []).arrayPush(lt) :
                            lt;
                    }
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"VTK_ARRAY"</span>:
                    tt = <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"array"</span>, [], []);
                    <span class="hljs-keyword">if</span> (t.childs.length &gt; <span class="hljs-number">0</span>) {
                        <span class="hljs-keyword">if</span> (l.tokenType === <span class="hljs-string">"VTK_COMMA"</span>) {
                            tt.arrayConcat(lt);
                        }
                        <span class="hljs-keyword">else</span> {
                            tt.arrayPush(lt);
                        }
                    }
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"VTK_OBJECT"</span>:
                    tt = <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"object"</span>, {}, {});
                    <span class="hljs-keyword">if</span> (t.childs.length &gt; <span class="hljs-number">0</span>) {
                        <span class="hljs-keyword">if</span> (l.tokenType === <span class="hljs-string">"VTK_COMMA"</span>) {
                            tt.objectSetProperties(lt);
                        }
                        <span class="hljs-keyword">else</span> {
                            tt.objectSetProperty(lt);
                        }
                    }
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"VTK_SUBSCRIPT"</span>:
                    tt = lt.subscript(rt);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"VTK_FUNCTION"</span>:
                    tt = (p &amp;&amp; p.tokenType === <span class="hljs-string">"TK_DOT"</span> &amp;&amp; p.childs[<span class="hljs-number">0</span>] !== t) ?
                        lt.hashItem(rt) :
                        lt.hashItem(rt).getFunctionType(<span class="hljs-literal">null</span>);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">default</span>:
                    <span class="hljs-keyword">break</span>;
            }
            msg = tt.errorMsg;
            <span class="hljs-keyword">if</span> (msg === <span class="hljs-string">""</span>) {
                <span class="hljs-keyword">this</span>.setType(t.id, tt);
            }
        }
        <span class="hljs-keyword">return</span> msg;
    };
    <span class="hljs-keyword">return</span> Check;
}());</pre></div></div>
            
        </li>
        
        
        <li id="section-279">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-279">&#182;</a>
              </div>
              <h2 id="-">表达式游标</h2>

            </div>
            
        </li>
        
        
        <li id="section-280">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-280">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> ExprCurrent = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ExprCurrent</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">this</span>.curr = [];
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-281">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-281">&#182;</a>
              </div>
              <p>设置数据游标</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprCurrent.prototype.setDataCursor = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">cursor</span>) </span>{
        <span class="hljs-keyword">this</span>.dataCursor = cursor;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-282">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-282">&#182;</a>
              </div>
              <p>向栈顶添加新的计算环境</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprCurrent.prototype.push = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">c</span>) </span>{
        <span class="hljs-keyword">this</span>.curr.unshift({ <span class="hljs-attr">pIndex</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">params</span>: c });
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-283">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-283">&#182;</a>
              </div>
              <p>删除栈顶的计算环境</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprCurrent.prototype.pop = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">this</span>.curr.shift();
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-284">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-284">&#182;</a>
              </div>
              <p>栈顶计算环境的params属性是否存在第index条记录</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprCurrent.prototype.isValid = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">index</span>) </span>{
        <span class="hljs-keyword">return</span> index &gt;= <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-keyword">this</span>.curr.length &gt; <span class="hljs-number">0</span> &amp;&amp; index &lt; <span class="hljs-keyword">this</span>.curr[<span class="hljs-number">0</span>].params.length;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-285">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-285">&#182;</a>
              </div>
              <p>栈顶计算环境的params属性的第index条记录是否为实体数据</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprCurrent.prototype.isEntityData = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">index</span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.curr.length &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">var</span> c = <span class="hljs-keyword">this</span>.curr[<span class="hljs-number">0</span>];
            c.pIndex = index || <span class="hljs-number">0</span>;
            <span class="hljs-keyword">return</span> c.params[c.pIndex].isEntityData;
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-286">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-286">&#182;</a>
              </div>
              <p>得到栈顶计算环境的params属性的第index条记录存储的实体名</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprCurrent.prototype.getEntityName = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">index</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getData(index) || <span class="hljs-string">""</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-287">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-287">&#182;</a>
              </div>
              <p>得到实体全名称entityName的访问游标</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprCurrent.prototype.getEntityDataCursor = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entityName, index</span>) </span>{
        <span class="hljs-keyword">var</span> r = entityName ? <span class="hljs-keyword">this</span>.dataCursor[entityName] : <span class="hljs-number">0</span>;
       
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.curr.length; i++) {
            <span class="hljs-keyword">var</span> c = <span class="hljs-keyword">this</span>.curr[i];
            <span class="hljs-keyword">if</span> (i === <span class="hljs-number">0</span>) {
                c.pIndex = index || <span class="hljs-number">0</span>;
            }
            <span class="hljs-keyword">var</span> cc = c.params[c.pIndex];
            <span class="hljs-keyword">if</span> (cc.isEntityData &amp;&amp; cc.current === entityName) {
                r = cc.cursor;
                <span class="hljs-keyword">break</span>;
            }
        }
        <span class="hljs-keyword">return</span> r;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-288">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-288">&#182;</a>
              </div>
              <p>得到栈顶计算环境的params属性的第index条记录存储的数据</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprCurrent.prototype.getData = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">index</span>) </span>{
        <span class="hljs-keyword">var</span> r;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.curr.length &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">var</span> c = <span class="hljs-keyword">this</span>.curr[<span class="hljs-number">0</span>];
            c.pIndex = index || <span class="hljs-number">0</span>;
            r = c.params[c.pIndex].current;
        }
        <span class="hljs-keyword">return</span> r;
    };
    <span class="hljs-keyword">return</span> ExprCurrent;
}());</pre></div></div>
            
        </li>
        
        
        <li id="section-289">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-289">&#182;</a>
              </div>
              <h2 id="-">表达式上下文</h2>

            </div>
            
        </li>
        
        
        <li id="section-290">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-290">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> ExprContext = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">_super</span>) </span>{
    __extends(ExprContext, _super);
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ExprContext</span>(<span class="hljs-params"></span>) </span>{
        _super.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
        <span class="hljs-keyword">this</span>.exprContext = <span class="hljs-keyword">new</span> ExprCurrent();
        <span class="hljs-keyword">this</span>.pageContext = { <span class="hljs-attr">$C</span>: {} };
        <span class="hljs-keyword">this</span>.contextVariables = [];
        <span class="hljs-keyword">this</span>.functions = {};
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-291">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-291">&#182;</a>
              </div>
              <p>设置数据游标</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.setDataCursor = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">cursor</span>) </span>{
        <span class="hljs-keyword">this</span>.exprContext.setDataCursor(cursor);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-292">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-292">&#182;</a>
              </div>
              <p>设置页面上下文</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.setPageContext = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ctx</span>) </span>{
        <span class="hljs-keyword">this</span>.pageContext.$C = ctx;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-293">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-293">&#182;</a>
              </div>
              <p>设置数据上下文</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.setDataContext = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ctx</span>) </span>{
        <span class="hljs-keyword">this</span>.dataContext = ctx;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-294">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-294">&#182;</a>
              </div>
              <p>设置数据</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.setData = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) </span>{
        <span class="hljs-keyword">this</span>.data = d;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-295">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-295">&#182;</a>
              </div>
              <p>添加函数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.addFunction = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">func</span>) </span>{
        <span class="hljs-keyword">var</span> gs;
        gs = {};
        gs[<span class="hljs-string">""</span>] = func._ || {};
        gs.array = func.array || {};
        gs.boolean = func.boolean || {};
        gs.date = func.date || {};
        gs.number = func.number || {};
        gs.object = func.object || {};
        gs.string = func.string || {};
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> g <span class="hljs-keyword">in</span> gs) {
            <span class="hljs-keyword">if</span> (gs.hasOwnProperty(g)) {
                <span class="hljs-keyword">var</span> group = gs[g];
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> n <span class="hljs-keyword">in</span> group) {
                    <span class="hljs-keyword">if</span> (group.hasOwnProperty(n)) {
                        <span class="hljs-keyword">var</span> fullName = g ? g + <span class="hljs-string">"."</span> + n : n;
                        group[n].getLocale = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key</span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> locale.getFunction()[key]; }; })(fullName);
                    }
                }
            }
        }
        <span class="hljs-keyword">return</span> merger(<span class="hljs-keyword">this</span>.functions, gs);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-296">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-296">&#182;</a>
              </div>
              <p>获取函数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.getFunction = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.functions;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-297">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-297">&#182;</a>
              </div>
              <p>获取IfNull函数名</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.doGetIfNullName = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"IfNull"</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-298">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-298">&#182;</a>
              </div>
              <p>获取IIf函数名</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.doGetIIfName = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"IIf"</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-299">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-299">&#182;</a>
              </div>
              <p>获取函数返回结果类型对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.doGetFunctionType = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, source, paramType, paramData</span>) </span>{
        <span class="hljs-keyword">var</span> r;
        <span class="hljs-keyword">var</span> t = (source !== <span class="hljs-literal">null</span>) ?
            (source.entity ? source.entity.type : source.type) :
            <span class="hljs-string">""</span>;
        <span class="hljs-keyword">var</span> ft = <span class="hljs-keyword">this</span>.getFuncType(t, name, paramType);
        <span class="hljs-keyword">if</span> (ft === <span class="hljs-literal">null</span>) {
            r = <span class="hljs-keyword">this</span>.genErrorType(format(locale.getLocale().MSG_EC_FUNC_T, t, name));
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">var</span> depends = [];
            <span class="hljs-keyword">if</span> (ft.p) {
                <span class="hljs-keyword">var</span> pd = paramData;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; ft.p.length; i++) {
                    <span class="hljs-keyword">if</span> (ft.p[i] === <span class="hljs-string">"expr"</span> &amp;&amp; paramType[i] === <span class="hljs-string">"string"</span> &amp;&amp; getValueType(pd[i]) === <span class="hljs-string">"string"</span>) {
                        <span class="hljs-keyword">var</span> dr = (source &amp;&amp; source.entity) ?
                            <span class="hljs-keyword">this</span>.calcEntityDependencies(pd[i], source.entity.fullName) :
                            <span class="hljs-keyword">this</span>.calcEntityDependencies(pd[i]);
                        <span class="hljs-keyword">if</span> (dr.errorMsg === <span class="hljs-string">""</span>) {
                            depends = depends.concat(dr.dependencies);
                        }
                        <span class="hljs-keyword">else</span> {
                            r = <span class="hljs-keyword">this</span>.genErrorType(dr.errorMsg);
                            <span class="hljs-keyword">break</span>;
                        }
                    }
                }
            }
            <span class="hljs-keyword">if</span> (!r) {
                <span class="hljs-keyword">var</span> entity = <span class="hljs-literal">null</span>;
                <span class="hljs-keyword">var</span> type = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
                <span class="hljs-keyword">switch</span> (ft.e) {
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"root"</span>:
                        entity = <span class="hljs-string">""</span>;
                        type = <span class="hljs-string">"object"</span>;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"parent"</span>:
                        <span class="hljs-keyword">if</span> (source === <span class="hljs-literal">null</span>) {
                            entity = <span class="hljs-keyword">this</span>.getParentName(<span class="hljs-keyword">this</span>.exprContext.getEntityName());
                            type = <span class="hljs-string">"object"</span>;
                        }
                        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (source.entity) {
                            entity = <span class="hljs-keyword">this</span>.getParentName(source.entity.fullName);
                            type = <span class="hljs-string">"object"</span>;
                        }
                        <span class="hljs-keyword">else</span> {
                            r = <span class="hljs-keyword">this</span>.genErrorType(format(locale.getLocale().MSG_EC_FUNC_E, <span class="hljs-string">"Parent"</span>));
                        }
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"data"</span>:
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"value"</span>:
                        <span class="hljs-keyword">var</span> n = <span class="hljs-literal">null</span>;
                        <span class="hljs-keyword">if</span> (source === <span class="hljs-literal">null</span>) {
                            n = <span class="hljs-keyword">this</span>.exprContext.getEntityName();
                        }
                        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (source.entity) {
                            n = source.entity.fullName;
                        }
                        <span class="hljs-keyword">if</span> (n !== <span class="hljs-literal">null</span>) {
                            <span class="hljs-keyword">if</span> (ft.e === <span class="hljs-string">"data"</span>) {
                                entity = n;
                            }
                            depends.push(n);
                        }
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">default</span>:
                        <span class="hljs-keyword">break</span>;
                }
                <span class="hljs-keyword">if</span> (!r) {
                    <span class="hljs-keyword">if</span> (entity !== <span class="hljs-literal">null</span>) {
                        entity = <span class="hljs-keyword">this</span>.genEntityInfo(entity, type);
                    }
                    <span class="hljs-keyword">if</span> (depends.length === <span class="hljs-number">0</span>) {
                        depends = <span class="hljs-literal">null</span>;
                    }
                    r = <span class="hljs-keyword">this</span>.genType(ft.r, ft.r, <span class="hljs-literal">undefined</span>, entity, depends);
                }
            }
        }
        <span class="hljs-keyword">return</span> r;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-300">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-300">&#182;</a>
              </div>
              <p>获取函数返回值</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.doGetFunctionValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, source, paramValue</span>) </span>{
        <span class="hljs-keyword">var</span> t = (source !== <span class="hljs-literal">null</span>) ?
            (source.entity ? source.entity.type : source.type) :
            <span class="hljs-string">""</span>;
        <span class="hljs-keyword">var</span> p = [source].concat(paramValue);
        <span class="hljs-keyword">var</span> pt = [];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _i = <span class="hljs-number">0</span>, paramValue_1 = paramValue; _i &lt; paramValue_1.length; _i++) {
            <span class="hljs-keyword">var</span> item = paramValue_1[_i];
            pt.push(getValueType(item));
        }
        <span class="hljs-keyword">var</span> f = <span class="hljs-keyword">this</span>.getFunc(t, name, pt);
        <span class="hljs-keyword">var</span> r = f ?
            f.fn.apply(<span class="hljs-keyword">this</span>, [<span class="hljs-keyword">this</span>].concat(p)) :
            <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EC_FUNC_P, t, name));
        <span class="hljs-keyword">return</span> r;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-301">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-301">&#182;</a>
              </div>
              <p>获取变量类型对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.doGetVariableType = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, source</span>) </span>{
        <span class="hljs-keyword">var</span> r;
        <span class="hljs-keyword">var</span> pIndex;
        pIndex = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span> (source === <span class="hljs-literal">null</span> &amp;&amp; name.split(<span class="hljs-string">""</span>)[<span class="hljs-number">0</span>] === <span class="hljs-string">"$"</span>) {
            pIndex = name.substr(<span class="hljs-number">1</span>);
            <span class="hljs-keyword">if</span> (pIndex === <span class="hljs-string">"C"</span>) {
                r = <span class="hljs-keyword">this</span>.genType(getValueType(<span class="hljs-keyword">this</span>.pageContext.$C));
            }
            <span class="hljs-keyword">else</span> {
                pIndex = <span class="hljs-built_in">Number</span>(pIndex);
                <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">isNaN</span>(pIndex)) {
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.exprContext.isValid(pIndex)) {
                        name = <span class="hljs-string">""</span>;
                    }
                    <span class="hljs-keyword">else</span> {
                        r = <span class="hljs-keyword">this</span>.genErrorType(format(locale.getLocale().MSG_EC_VARI_N, name));
                    }
                }
                <span class="hljs-keyword">else</span> {
                    r = <span class="hljs-keyword">this</span>.genErrorType(format(locale.getLocale().MSG_EC_VARI_I, name));
                }
            }
        }
        <span class="hljs-keyword">if</span> (!r) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.exprContext.isEntityData(pIndex)) {
                <span class="hljs-keyword">var</span> entity = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
                <span class="hljs-keyword">var</span> type = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
                <span class="hljs-keyword">if</span> (source === <span class="hljs-literal">null</span>) {
                    entity = <span class="hljs-keyword">this</span>.genEntityInfo(<span class="hljs-keyword">this</span>.getPropertyName(<span class="hljs-keyword">this</span>.exprContext.getEntityName(pIndex), name));
                    <span class="hljs-keyword">if</span> (entity) {
                        type = entity.type;
                    }
                    <span class="hljs-keyword">else</span> {
                        r = <span class="hljs-keyword">this</span>.genErrorType(format(locale.getLocale().MSG_EC_PROP_N, name));
                    }
                }
                <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">if</span> (source.entity) {
                        entity = <span class="hljs-keyword">this</span>.genEntityInfo(<span class="hljs-keyword">this</span>.getPropertyName(source.entity.fullName, name));
                        <span class="hljs-keyword">if</span> (entity) {
                            type = entity.type;
                        }
                        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (source.entity.type === <span class="hljs-string">"object"</span> &amp;&amp; source.entity.field !== <span class="hljs-string">""</span>) {
                            type = <span class="hljs-string">"undefined"</span>;
                        }
                        <span class="hljs-keyword">else</span> {
                            r = <span class="hljs-keyword">this</span>.genErrorType(format(locale.getLocale().MSG_EC_PROP_N, name));
                        }
                    }
                    <span class="hljs-keyword">else</span> {
                        entity = <span class="hljs-literal">null</span>;
                        type = <span class="hljs-string">"undefined"</span>;
                    }
                }
                <span class="hljs-keyword">if</span> (!r) {
                    r = <span class="hljs-keyword">this</span>.genType(type, type, name, entity);
                }
            }
            <span class="hljs-keyword">else</span> {
                r = <span class="hljs-keyword">this</span>.genType();
            }
        }
        <span class="hljs-keyword">return</span> r;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-302">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-302">&#182;</a>
              </div>
              <p>获取变量值</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.doGetVariableValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, source</span>) </span>{
        <span class="hljs-keyword">var</span> r;
        <span class="hljs-keyword">var</span> pIndex;
        pIndex = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span> (source === <span class="hljs-literal">null</span> &amp;&amp; name.split(<span class="hljs-string">""</span>)[<span class="hljs-number">0</span>] === <span class="hljs-string">"$"</span>) {
            pIndex = name.substr(<span class="hljs-number">1</span>);
            <span class="hljs-keyword">if</span> (pIndex === <span class="hljs-string">"C"</span>) {
                r = <span class="hljs-keyword">this</span>.genValue(<span class="hljs-keyword">this</span>.pageContext.$C);
            }
            <span class="hljs-keyword">else</span> {
                pIndex = <span class="hljs-built_in">Number</span>(pIndex);
                <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">isNaN</span>(pIndex)) {
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.exprContext.isValid(pIndex)) {
                        name = <span class="hljs-string">""</span>;
                    }
                    <span class="hljs-keyword">else</span> {
                        r = <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EC_VARI_N, name));
                    }
                }
                <span class="hljs-keyword">else</span> {
                    r = <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EC_VARI_I, name));
                }
            }
        }
        <span class="hljs-keyword">if</span> (!r) {
            <span class="hljs-keyword">var</span> value = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.exprContext.isEntityData(pIndex)) {
                <span class="hljs-keyword">var</span> entity = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
                <span class="hljs-keyword">var</span> parentObj = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
                <span class="hljs-keyword">if</span> (source === <span class="hljs-literal">null</span>) {
                    entity = <span class="hljs-keyword">this</span>.genEntityInfo(<span class="hljs-keyword">this</span>.getPropertyName(<span class="hljs-keyword">this</span>.exprContext.getEntityName(pIndex), name));
                    <span class="hljs-keyword">if</span> (!entity) {
                        r = <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EC_PROP_N, name));
                    }
                    <span class="hljs-keyword">else</span> {
                        value = (entity.field !== <span class="hljs-string">""</span> || name === <span class="hljs-string">""</span>) ?
                            <span class="hljs-keyword">this</span>.getEntityData(entity.name, pIndex) :
                            <span class="hljs-keyword">this</span>.getEntityData(<span class="hljs-keyword">this</span>.getParentName(entity.name), pIndex);
                    }
                    parentObj = <span class="hljs-literal">null</span>;
                }
                <span class="hljs-keyword">else</span> {
                    value = source.toValue();
                    <span class="hljs-keyword">if</span> (source.entity &amp;&amp;
                        !(source.entity.type === <span class="hljs-string">"object"</span> &amp;&amp; source.entity.field !== <span class="hljs-string">""</span>)) {
                        entity = <span class="hljs-keyword">this</span>.genEntityInfo(<span class="hljs-keyword">this</span>.getPropertyName(source.entity.fullName, name));
                        <span class="hljs-keyword">if</span> (!entity) {
                            r = <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EC_PROP_N, name));
                        }
                        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (entity.field === <span class="hljs-string">""</span>) {
                            parentObj = source;
                        }
                    }
                    <span class="hljs-keyword">else</span> {
                        entity = <span class="hljs-literal">null</span>;
                    }
                }
                <span class="hljs-keyword">if</span> (!r) {
                    <span class="hljs-keyword">if</span> (value) {
                       
                        <span class="hljs-keyword">if</span> (!(source === <span class="hljs-literal">null</span> &amp;&amp; name === <span class="hljs-string">""</span>)) {
                            value = value[name];
                        }
                        <span class="hljs-keyword">if</span> (value === <span class="hljs-literal">undefined</span>) {
                            value = <span class="hljs-literal">null</span>;
                            <span class="hljs-keyword">if</span> (entity) {
                                <span class="hljs-keyword">if</span> (entity.type === <span class="hljs-string">"object"</span>) {
                                    value = {};
                                }
                                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (entity.type === <span class="hljs-string">"array"</span>) {
                                    value = [];
                                }
                            }
                        }
                        r = <span class="hljs-keyword">this</span>.genValue(value, <span class="hljs-literal">null</span>, entity, <span class="hljs-string">""</span>, parentObj);
                        <span class="hljs-keyword">if</span> (r &amp;&amp; r.type === <span class="hljs-string">"array"</span> &amp;&amp; r.entity) {
                            r.entity.map = [];
                            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; value.length; i++) {
                                r.entity.map.push(i);
                            }
                        }
                    }
                    <span class="hljs-keyword">else</span> {
                        r = <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EC_PROP_E, value, name));
                    }
                }
            }
            <span class="hljs-keyword">else</span> {
                value = (source === <span class="hljs-literal">null</span>) ?
                    <span class="hljs-keyword">this</span>.getData(pIndex) :
                    value = source.toValue();
                <span class="hljs-keyword">if</span> (!(source === <span class="hljs-literal">null</span> &amp;&amp; name === <span class="hljs-string">""</span>)) {
                    <span class="hljs-keyword">switch</span> (getValueType(value)) {
                        <span class="hljs-keyword">case</span> <span class="hljs-string">"object"</span>:
                        <span class="hljs-keyword">case</span> <span class="hljs-string">"array"</span>:
                        <span class="hljs-keyword">case</span> <span class="hljs-string">"string"</span>:
                            value = value[name];
                            <span class="hljs-keyword">break</span>;
                        <span class="hljs-keyword">default</span>:
                            r = <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EC_PROP_E, value, name));
                    }
                }
                <span class="hljs-keyword">if</span> (!r) {
                    r = <span class="hljs-keyword">this</span>.genValue(value);
                }
            }
        }
        <span class="hljs-keyword">return</span> r;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-303">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-303">&#182;</a>
              </div>
              <p>获取实体类型对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.doGetEntityType = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">source</span>) </span>{
        <span class="hljs-keyword">var</span> e = <span class="hljs-keyword">this</span>.genEntityInfo(source.entity, <span class="hljs-string">"object"</span>);
        <span class="hljs-keyword">var</span> t = <span class="hljs-keyword">this</span>.genType(<span class="hljs-string">"object"</span>, <span class="hljs-string">"object"</span>, <span class="hljs-literal">undefined</span>, e, [e.fullName]);
        <span class="hljs-keyword">return</span> t;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-304">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-304">&#182;</a>
              </div>
              <p>获取实体值，根据游标索引</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.doGetEntityValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">source, index</span>) </span>{
        <span class="hljs-keyword">var</span> v = source.toValue()[index];
        <span class="hljs-keyword">var</span> e = <span class="hljs-keyword">this</span>.genEntityInfo(source.entity, <span class="hljs-string">"object"</span>);
        e.recNo = source.entity.map[index];
        <span class="hljs-keyword">var</span> parentObj = source.parentObj;
        <span class="hljs-keyword">var</span> r = <span class="hljs-keyword">this</span>.genValue(v, getValueType(v), e, <span class="hljs-string">""</span>, parentObj);
        <span class="hljs-keyword">return</span> r;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-305">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-305">&#182;</a>
              </div>
              <p>获取实体信息</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.genEntityInfo = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fullName, type</span>) </span>{
        <span class="hljs-keyword">if</span> (getValueType(fullName) === <span class="hljs-string">"object"</span>) {
            fullName = fullName.fullName;
        }
        <span class="hljs-keyword">var</span> name = [];
        <span class="hljs-keyword">var</span> field = [];
        <span class="hljs-keyword">var</span> dataType;
        <span class="hljs-keyword">if</span> (fullName !== <span class="hljs-string">""</span>) {
            <span class="hljs-keyword">var</span> p = fullName.split(<span class="hljs-string">"."</span>);
            <span class="hljs-keyword">var</span> x = p[<span class="hljs-number">0</span>];
            <span class="hljs-keyword">var</span> c = <span class="hljs-keyword">this</span>.dataContext;
            <span class="hljs-keyword">var</span> t = c[x];
            <span class="hljs-keyword">if</span> (t) {
                name.push(x);
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>; i &lt; p.length; i++) {
                    x = p[i];
                    <span class="hljs-keyword">if</span> (t.childs &amp;&amp; t.childs[x] &amp;&amp; field.length === <span class="hljs-number">0</span>) {
                        name.push(x);
                        t = t.childs[x];
                    }
                    <span class="hljs-keyword">else</span> {
                        <span class="hljs-keyword">var</span> f = field.join(<span class="hljs-string">"."</span>);
                        <span class="hljs-keyword">if</span> (f !== <span class="hljs-string">""</span>) {
                            f += <span class="hljs-string">"."</span>;
                        }
                        f += x;
                        <span class="hljs-keyword">if</span> (t.fields &amp;&amp; t.fields[f]) {
                            field.push(x);
                            dataType = t.fields[f].type;
                        }
                        <span class="hljs-keyword">else</span> {
                            <span class="hljs-keyword">break</span>;
                        }
                    }
                }
            }
        }
        <span class="hljs-keyword">var</span> r = {
            <span class="hljs-attr">field</span>: field.join(<span class="hljs-string">"."</span>),
            <span class="hljs-attr">fullName</span>: (fullName),
            <span class="hljs-attr">name</span>: name.join(<span class="hljs-string">"."</span>),
            <span class="hljs-attr">recNo</span>: <span class="hljs-number">-1</span>,
            <span class="hljs-attr">type</span>: dataType,
        };
        <span class="hljs-keyword">if</span> (r.name === r.fullName) {
            r.type = <span class="hljs-string">"array"</span>;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (r.name + <span class="hljs-string">"."</span> + r.field !== r.fullName) {
            r = <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">if</span> (r &amp;&amp; type) {
            r.type = type;
        }
        <span class="hljs-keyword">return</span> r;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-306">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-306">&#182;</a>
              </div>
              <p>获取根数据值</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.getRootValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> entity = <span class="hljs-keyword">this</span>.genEntityInfo(<span class="hljs-string">""</span>, <span class="hljs-string">"object"</span>);
        entity.recNo = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.genValue(<span class="hljs-keyword">this</span>.data, <span class="hljs-string">"object"</span>, entity, <span class="hljs-string">""</span>);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-307">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-307">&#182;</a>
              </div>
              <p>获取父实体值</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.getParentValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">source</span>) </span>{
        <span class="hljs-keyword">var</span> r;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.exprContext.isEntityData()) {
            <span class="hljs-keyword">var</span> entity = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
            <span class="hljs-keyword">if</span> (source === <span class="hljs-literal">null</span>) {
                entity = <span class="hljs-keyword">this</span>.exprContext.getEntityName();
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (source.entity &amp;&amp; source.entity.field === <span class="hljs-string">""</span>) {
                <span class="hljs-keyword">if</span> (source.parentObj) {
                    r = source.parentObj;
                }
                <span class="hljs-keyword">else</span> {
                    entity = source.entity.fullName;
                }
            }
            <span class="hljs-keyword">else</span> {
                r = <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EC_FUNC_E, <span class="hljs-string">"Parent"</span>));
            }
            <span class="hljs-keyword">if</span> (!r) {
                entity = <span class="hljs-keyword">this</span>.genEntityInfo(<span class="hljs-keyword">this</span>.getParentName(entity), <span class="hljs-string">"object"</span>);
                entity.recNo = <span class="hljs-keyword">this</span>.exprContext.getEntityDataCursor(entity.name);
                <span class="hljs-keyword">var</span> value = <span class="hljs-keyword">this</span>.getEntityData(entity.name);
                r = <span class="hljs-keyword">this</span>.genValue(value, <span class="hljs-string">""</span>, entity);
            }
        }
        <span class="hljs-keyword">else</span> {
            r = <span class="hljs-keyword">this</span>.genValue(<span class="hljs-literal">null</span>);
        }
        <span class="hljs-keyword">return</span> r;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-308">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-308">&#182;</a>
              </div>
              <p>获取实体数据，根据游标索引</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.getEntityData = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entityName, index</span>) </span>{
        <span class="hljs-keyword">var</span> d = <span class="hljs-keyword">this</span>.data;
        <span class="hljs-keyword">if</span> (entityName !== <span class="hljs-string">""</span>) {
            <span class="hljs-keyword">var</span> p = entityName.split(<span class="hljs-string">"."</span>);
            <span class="hljs-keyword">var</span> cp = [];
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _i = <span class="hljs-number">0</span>, p_1 = p; _i &lt; p_1.length; _i++) {
                <span class="hljs-keyword">var</span> prop = p_1[_i];
                cp.push(prop);
                d = d[prop];
                <span class="hljs-keyword">var</span> cursor = <span class="hljs-keyword">this</span>.exprContext.getEntityDataCursor(cp.join(<span class="hljs-string">"."</span>), index);
                d = d[cursor];
                <span class="hljs-keyword">if</span> (d === <span class="hljs-literal">undefined</span>) {
                    <span class="hljs-keyword">break</span>;
                }
            }
        }
        <span class="hljs-keyword">return</span> d;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-309">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-309">&#182;</a>
              </div>
              <p>根据索引获取数据</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.getData = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">index</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.exprContext.getData(index);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-310">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-310">&#182;</a>
              </div>
              <p>获取父名称</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.getParentName = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name</span>) </span>{
        <span class="hljs-keyword">var</span> p = name.split(<span class="hljs-string">"."</span>);
        <span class="hljs-keyword">var</span> r;
        <span class="hljs-keyword">if</span> (p.length &gt; <span class="hljs-number">0</span>) {
            p.pop();
            r = p.join(<span class="hljs-string">"."</span>);
        }
        <span class="hljs-keyword">else</span> {
            r = <span class="hljs-string">""</span>;
        }
        <span class="hljs-keyword">return</span> r;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-311">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-311">&#182;</a>
              </div>
              <p>获取实体属性全名称</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.getPropertyName = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, prop</span>) </span>{
        <span class="hljs-keyword">return</span> (name &amp;&amp; prop) ?
            (name + <span class="hljs-string">"."</span> + prop) :
            (name ? name : prop);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-312">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-312">&#182;</a>
              </div>
              <p>获取当前实体的索引号，没有实体返回-1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.getRecNo = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">source</span>) </span>{
        <span class="hljs-keyword">var</span> r;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.exprContext.isEntityData()) {
            <span class="hljs-keyword">var</span> entity = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
            <span class="hljs-keyword">if</span> (source === <span class="hljs-literal">null</span>) {
                entity = <span class="hljs-keyword">this</span>.exprContext.getEntityName();
                <span class="hljs-keyword">var</span> value = <span class="hljs-keyword">this</span>.exprContext.getEntityDataCursor(entity);
                r = <span class="hljs-keyword">this</span>.genValue(value);
            }
            <span class="hljs-keyword">else</span> {
                r = (source.entity &amp;&amp; source.entity.field === <span class="hljs-string">""</span>) ?
                    <span class="hljs-keyword">this</span>.genValue(source.entity.recNo) :
                    <span class="hljs-keyword">this</span>.genErrorValue(format(locale.getLocale().MSG_EC_FUNC_E, <span class="hljs-string">"RecNo"</span>));
            }
        }
        <span class="hljs-keyword">else</span> {
            r = <span class="hljs-keyword">this</span>.genValue(<span class="hljs-number">-1</span>);
        }
        <span class="hljs-keyword">return</span> r;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-313">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-313">&#182;</a>
              </div>
              <p>设置字段名</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.setFieldName = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) </span>{ <span class="hljs-keyword">this</span>.fieldName = value; };</pre></div></div>
            
        </li>
        
        
        <li id="section-314">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-314">&#182;</a>
              </div>
              <p>获取字段名</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.getFieldName = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.fieldName || <span class="hljs-string">""</span>; };</pre></div></div>
            
        </li>
        
        
        <li id="section-315">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-315">&#182;</a>
              </div>
              <p>设置字段显示名称</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.setFieldDisplayName = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) </span>{ <span class="hljs-keyword">this</span>.fieldDisplayName = value; };</pre></div></div>
            
        </li>
        
        
        <li id="section-316">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-316">&#182;</a>
              </div>
              <p>获取字段显示名称</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.getFieldDisplayName = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.fieldDisplayName || <span class="hljs-string">""</span>; };</pre></div></div>
            
        </li>
        
        
        <li id="section-317">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-317">&#182;</a>
              </div>
              <p>设置字段值</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.setFieldValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) </span>{ <span class="hljs-keyword">this</span>.fieldValue = value; };</pre></div></div>
            
        </li>
        
        
        <li id="section-318">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-318">&#182;</a>
              </div>
              <p>获取字段值</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.getFieldValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.fieldValue || <span class="hljs-literal">null</span>; };</pre></div></div>
            
        </li>
        
        
        <li id="section-319">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-319">&#182;</a>
              </div>
              <p>检测参数类型数组是否匹配</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.findParams = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ps, p</span>) </span>{
        <span class="hljs-keyword">var</span> r = [];
        <span class="hljs-keyword">var</span> pt = [];
        <span class="hljs-keyword">var</span> pl = ps.length;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; ps.length; i++) {
            <span class="hljs-keyword">var</span> x = ps[i];
            <span class="hljs-keyword">if</span> (x.indexOf(<span class="hljs-string">"?"</span>) === x.length - <span class="hljs-number">1</span>) {
                x = x.replace(<span class="hljs-string">"?"</span>, <span class="hljs-string">""</span>);
                pl--;
            }
            pt.push(x);
            <span class="hljs-keyword">if</span> (i &lt; p.length) {
                r.push(x);
            }
        }
        <span class="hljs-keyword">var</span> b = p.length &gt;= pl &amp;&amp; p.length &lt;= pt.length;
        <span class="hljs-keyword">if</span> (b) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; r.length; j++) {
                b = r[j] === <span class="hljs-string">"undefined"</span> || p[j] === <span class="hljs-string">"undefined"</span> || p[j] === <span class="hljs-string">"null"</span> ||
                    r[j] === p[j] || r[j] === <span class="hljs-string">"expr"</span> &amp;&amp; p[j] === <span class="hljs-string">"string"</span> || r[j] === <span class="hljs-string">"array"</span> &amp;&amp;
                    r[j] === getValueType(p[j]) || r[j] === <span class="hljs-string">"object"</span> &amp;&amp; r[j] === getValueType(p[j]);
                <span class="hljs-keyword">if</span> (!b) {
                    <span class="hljs-keyword">break</span>;
                }
            }
        }
        <span class="hljs-keyword">if</span> (!b) {
            r = <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">return</span> r;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-320">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-320">&#182;</a>
              </div>
              <p>获取参数个数和类型都匹配的函数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.getFunc = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">type, name, params</span>) </span>{
        <span class="hljs-keyword">var</span> r;
        <span class="hljs-keyword">if</span> (type === <span class="hljs-string">"undefined"</span>) {
            <span class="hljs-keyword">var</span> f = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
            <span class="hljs-keyword">var</span> fList = [];
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>.functions) {
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.functions.hasOwnProperty(i)) {
                    f = <span class="hljs-keyword">this</span>.functions[i][name];
                    <span class="hljs-keyword">if</span> (f &amp;&amp; <span class="hljs-keyword">this</span>.findParams(f.p, params) !== <span class="hljs-literal">null</span>) {
                        fList.push(f);
                    }
                }
            }
            r = (fList.length &gt; <span class="hljs-number">1</span>) ? fList :
                ((fList.length === <span class="hljs-number">1</span>) ? fList[<span class="hljs-number">0</span>] : <span class="hljs-literal">null</span>);
        }
        <span class="hljs-keyword">else</span> {
            r = <span class="hljs-keyword">this</span>.functions[type][name];
            <span class="hljs-keyword">if</span> (!r || !r.fn || <span class="hljs-keyword">this</span>.findParams(r.p, params) === <span class="hljs-literal">null</span>) {
                r = <span class="hljs-literal">null</span>;
            }
        }
        <span class="hljs-keyword">return</span> r;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-321">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-321">&#182;</a>
              </div>
              <p>获取参数个数和类型都匹配的函数的返回值类型</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.getFuncType = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">type, name, params</span>) </span>{
        <span class="hljs-keyword">var</span> r = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">var</span> fn = <span class="hljs-keyword">this</span>.getFunc(type, name, params);
        <span class="hljs-keyword">if</span> (getValueType(fn) === <span class="hljs-string">"array"</span>) {
            <span class="hljs-keyword">var</span> t = <span class="hljs-string">""</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _i = <span class="hljs-number">0</span>, fn_1 = fn; _i &lt; fn_1.length; _i++) {
                <span class="hljs-keyword">var</span> item = fn_1[_i];
                <span class="hljs-keyword">if</span> (r === <span class="hljs-literal">null</span>) {
                    t = item.r;
                }
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.r !== type) {
                    t = <span class="hljs-string">"undefined"</span>;
                    <span class="hljs-keyword">break</span>;
                }
            }
            <span class="hljs-keyword">if</span> (t !== <span class="hljs-string">""</span>) {
                r = {
                    <span class="hljs-attr">r</span>: t,
                };
            }
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (fn !== <span class="hljs-literal">null</span>) {
            r = {
                <span class="hljs-attr">e</span>: fn.e,
                <span class="hljs-attr">p</span>: <span class="hljs-keyword">this</span>.findParams(fn.p, params),
                <span class="hljs-attr">r</span>: fn.r,
            };
        }
        <span class="hljs-keyword">return</span> r;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-322">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-322">&#182;</a>
              </div>
              <p>获取上下文变量值</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.getContextVariableValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key</span>) </span>{
        <span class="hljs-keyword">var</span> r;
        <span class="hljs-keyword">var</span> v = <span class="hljs-keyword">this</span>.contextVariables;
        <span class="hljs-keyword">if</span> (v.length &gt; <span class="hljs-number">0</span>) {
            r = v[v.length - <span class="hljs-number">1</span>][key];
        }
        <span class="hljs-keyword">if</span> (r === <span class="hljs-literal">undefined</span>) {
            r = <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.genValue(r);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-323">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-323">&#182;</a>
              </div>
              <p>上下文变量压栈</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.pushContextVariables = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">v</span>) </span>{
        <span class="hljs-keyword">this</span>.contextVariables.push(v);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-324">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-324">&#182;</a>
              </div>
              <p>上下文变量出栈</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.popContextVariables = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">this</span>.contextVariables.pop();
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-325">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-325">&#182;</a>
              </div>
              <p>计算表达式</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype._calcExpr = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">expr, curr</span>) </span>{
        <span class="hljs-keyword">if</span> (curr.length &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">this</span>.exprContext.push(curr);
        }
        <span class="hljs-keyword">var</span> e = <span class="hljs-keyword">new</span> Calc();
        <span class="hljs-keyword">var</span> r = e.calc(expr, <span class="hljs-keyword">this</span>);
        <span class="hljs-keyword">if</span> (curr.length &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">this</span>.exprContext.pop();
        }
        <span class="hljs-keyword">return</span> r;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-326">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-326">&#182;</a>
              </div>
              <p>在实体计算环境下计算表达式的值</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.calcEntityExpr = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">expr, entityName, cursor</span>) </span>{
        <span class="hljs-keyword">var</span> c = [];
        <span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">while</span> (i &lt; <span class="hljs-built_in">arguments</span>.length) {
            c.push({
                <span class="hljs-attr">current</span>: <span class="hljs-built_in">arguments</span>[i],
                <span class="hljs-attr">cursor</span>: <span class="hljs-built_in">arguments</span>[i + <span class="hljs-number">1</span>],
                <span class="hljs-attr">isEntityData</span>: <span class="hljs-literal">true</span>,
            });
            i += <span class="hljs-number">2</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._calcExpr(expr, c);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-327">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-327">&#182;</a>
              </div>
              <p>在数据计算环境下计算表达式的值</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.calcDataExpr = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">expr, data</span>) </span>{
        <span class="hljs-keyword">var</span> c = [];
        <span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">while</span> (i &lt; <span class="hljs-built_in">arguments</span>.length) {
            c.push({
                <span class="hljs-attr">current</span>: <span class="hljs-built_in">arguments</span>[i],
                <span class="hljs-attr">isEntityData</span>: <span class="hljs-literal">false</span>,
            });
            i++;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._calcExpr(expr, c);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-328">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-328">&#182;</a>
              </div>
              <p>计算表达式的依赖关系</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.calcDependencies = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">expr, curr</span>) </span>{
        <span class="hljs-keyword">if</span> (curr.length &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">this</span>.exprContext.push(curr);
        }
        <span class="hljs-keyword">var</span> p = <span class="hljs-keyword">new</span> Check();
        <span class="hljs-keyword">var</span> r = p.check(expr, <span class="hljs-keyword">this</span>);
        <span class="hljs-keyword">if</span> (curr.length &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">this</span>.exprContext.pop();
        }
        <span class="hljs-keyword">return</span> r;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-329">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-329">&#182;</a>
              </div>
              <p>在实体计算环境下计算表达式的依赖关系</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.calcEntityDependencies = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">expr, entityName</span>) </span>{
        <span class="hljs-keyword">var</span> c = [];
        <span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">while</span> (i &lt; <span class="hljs-built_in">arguments</span>.length) {
            c.push({
                <span class="hljs-attr">current</span>: <span class="hljs-built_in">arguments</span>[i],
                <span class="hljs-attr">isEntityData</span>: <span class="hljs-literal">true</span>,
            });
            i++;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.calcDependencies(expr, c);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-330">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-330">&#182;</a>
              </div>
              <p>在数据计算环境下计算表达式的依赖关系</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.calcDataDependencies = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">expr</span>) </span>{
        <span class="hljs-keyword">var</span> c = [];
        <span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">while</span> (i &lt; <span class="hljs-built_in">arguments</span>.length) {
            c.push({
                <span class="hljs-attr">isEntityData</span>: <span class="hljs-literal">false</span>,
            });
            i++;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.calcDependencies(expr, c);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-331">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-331">&#182;</a>
              </div>
              <p>向栈顶添加新的计算环境</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.pushEntityCurrent = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entityName, cursor</span>) </span>{
        <span class="hljs-keyword">this</span>.exprContext.push([{
                <span class="hljs-attr">current</span>: entityName,
                <span class="hljs-attr">cursor</span>: (cursor),
                <span class="hljs-attr">isEntityData</span>: <span class="hljs-literal">true</span>,
            }]);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-332">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-332">&#182;</a>
              </div>
              <p>删除栈顶的计算环境</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprContext.prototype.popEntityCurrent = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">this</span>.exprContext.pop();
    };
    <span class="hljs-keyword">return</span> ExprContext;
}(Context));</pre></div></div>
            
        </li>
        
        
        <li id="section-333">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-333">&#182;</a>
              </div>
              <h2 id="-">表达式列表</h2>

            </div>
            
        </li>
        
        
        <li id="section-334">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-334">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> ExprList = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ExprList</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">this</span>.list = [];
        <span class="hljs-keyword">this</span>.cache = {};
        <span class="hljs-keyword">this</span>.sorted = <span class="hljs-literal">false</span>;
    }
    ExprList.prototype._getExprs = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entity, property, type</span>) </span>{
        <span class="hljs-keyword">var</span> name = property ? entity + <span class="hljs-string">"."</span> + property : entity;
        <span class="hljs-keyword">var</span> isLoadOrAdd = type === <span class="hljs-string">"L"</span> || type === <span class="hljs-string">"A"</span>;
        <span class="hljs-keyword">var</span> key = name + <span class="hljs-string">"|"</span> + type;
        <span class="hljs-keyword">var</span> r = <span class="hljs-keyword">this</span>.sorted ? <span class="hljs-keyword">this</span>.cache[key] : [];
        <span class="hljs-keyword">if</span> (!r) {
            r = [];
            <span class="hljs-keyword">var</span> s_1 = {};
            <span class="hljs-keyword">var</span> l_1 = {};
            <span class="hljs-keyword">var</span> list_1 = [];
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _i = <span class="hljs-number">0</span>, _a = <span class="hljs-keyword">this</span>.list; _i &lt; _a.length; _i++) {
                <span class="hljs-keyword">var</span> item = _a[_i];
                <span class="hljs-keyword">if</span> (item.types) {
                    <span class="hljs-keyword">if</span> (item.types.indexOf(type) &gt;= <span class="hljs-number">0</span>) {
                        list_1.push(item);
                    }
                }
                <span class="hljs-keyword">else</span> {
                    list_1.push(item);
                }
            }
            <span class="hljs-keyword">var</span> fn_1 = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fullName, entityName</span>) </span>{
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; list_1.length; i++) {
                    <span class="hljs-keyword">if</span> (l_1[i] !== <span class="hljs-literal">true</span>) {
                        l_1[i] = <span class="hljs-literal">true</span>;
                        <span class="hljs-keyword">var</span> x = list_1[i];
                        <span class="hljs-keyword">var</span> f = isLoadOrAdd &amp;&amp; (x.entityName === entityName &amp;&amp; x.entityName !== <span class="hljs-string">""</span>);
                        <span class="hljs-keyword">if</span> (!f &amp;&amp; x.dependencies) {
                            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _i = <span class="hljs-number">0</span>, _a = x.dependencies; _i &lt; _a.length; _i++) {
                                <span class="hljs-keyword">var</span> dependency = _a[_i];
                                f = dependency === fullName;
                                <span class="hljs-keyword">if</span> (f) {
                                    <span class="hljs-keyword">break</span>;
                                }
                            }
                        }
                        <span class="hljs-keyword">if</span> (f &amp;&amp; !s_1[i]) {
                            s_1[i] = <span class="hljs-literal">true</span>;
                            fn_1(x.fullName, entityName);
                        }
                        l_1[i] = <span class="hljs-literal">false</span>;
                    }
                }
            };
            fn_1(name, name);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k = <span class="hljs-number">0</span>; k &lt; list_1.length; k++) {
                <span class="hljs-keyword">if</span> (s_1[k]) {
                    <span class="hljs-keyword">var</span> o = {};
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> p <span class="hljs-keyword">in</span> list_1[k]) {
                        <span class="hljs-keyword">if</span> (list_1[k].hasOwnProperty(p)) {
                            o[p] = list_1[k][p];
                        }
                    }
                    r.push(o);
                }
            }
            <span class="hljs-keyword">this</span>._doUpdateMode(r, type, name, entity, property);
            <span class="hljs-keyword">this</span>.cache[key] = r;
        }
        <span class="hljs-keyword">return</span> r;
    };
    ExprList.prototype._doUpdateMode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">r, t, name, entity, property</span>) </span>{
        <span class="hljs-keyword">var</span> updateList = [{
                <span class="hljs-attr">entityName</span>: entity,
                <span class="hljs-attr">fullName</span>: name,
                <span class="hljs-attr">propertyName</span>: property,
                <span class="hljs-attr">type</span>: t,
                <span class="hljs-attr">updateMode</span>: <span class="hljs-string">"Single"</span>,
                <span class="hljs-attr">updateTarget</span>: <span class="hljs-string">""</span>,
            }];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _i = <span class="hljs-number">0</span>, r_1 = r; _i &lt; r_1.length; _i++) {
            <span class="hljs-keyword">var</span> item = r_1[_i];
            <span class="hljs-keyword">this</span>._doGetMode(updateList, item);
            updateList.push({
                <span class="hljs-attr">entityName</span>: item.entityName,
                <span class="hljs-attr">fullName</span>: item.fullName,
                <span class="hljs-attr">propertyName</span>: item.propertyName,
                <span class="hljs-attr">type</span>: <span class="hljs-string">"U"</span>,
                <span class="hljs-attr">updateMode</span>: item.updateMode,
                <span class="hljs-attr">updateTarget</span>: item.updateTarget,
            });
        }
    };
    ExprList.prototype._doGetMode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">updateList, l</span>) </span>{
        <span class="hljs-keyword">var</span> modeList = [];
       
        <span class="hljs-keyword">if</span> (updateList &amp;&amp; l &amp;&amp; l.dependencies) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _i = <span class="hljs-number">0</span>, _a = updateList.length; _i &lt; _a.length; _i++) {
                <span class="hljs-keyword">var</span> updateItem = _a[_i];
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _b = <span class="hljs-number">0</span>, _c = l.dependencies; _b &lt; _c.length; _b++) {
                    <span class="hljs-keyword">var</span> dependency = _c[_b];
                    <span class="hljs-keyword">if</span> (updateItem.fullName === dependency) {
                        <span class="hljs-keyword">var</span> commonAncestry = <span class="hljs-literal">true</span>;
                        <span class="hljs-keyword">var</span> isSubChange = <span class="hljs-literal">false</span>;
                       
                        <span class="hljs-keyword">if</span> (updateItem.type === <span class="hljs-string">"U"</span>) {
                           
                            <span class="hljs-keyword">var</span> isDependEntity = <span class="hljs-literal">false</span>;
                            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _d = <span class="hljs-number">0</span>, _e = l.dependencies; _d &lt; _e.length; _d++) {
                                <span class="hljs-keyword">var</span> depend = _e[_d];
                                isDependEntity = (updateItem.fullName.indexOf(depend + <span class="hljs-string">"."</span>) === <span class="hljs-number">0</span>);
                                <span class="hljs-keyword">if</span> (isDependEntity) {
                                    <span class="hljs-keyword">break</span>;
                                }
                            }
                            <span class="hljs-keyword">if</span> (updateItem.entityName === l.entityName) {
                               
                                <span class="hljs-keyword">if</span> (isDependEntity) {
                                    modeList.push({ <span class="hljs-attr">updateMode</span>: <span class="hljs-string">"All"</span> });
                                }
                                <span class="hljs-keyword">else</span> {
                                    modeList.push({ <span class="hljs-attr">updateMode</span>: <span class="hljs-string">"Single"</span> });
                                }
                            }
                            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (l.entityName.indexOf(updateItem.entityName + <span class="hljs-string">"."</span>) === <span class="hljs-number">0</span>) {
                               
                                <span class="hljs-keyword">if</span> (isDependEntity) {
                                    modeList.push({ <span class="hljs-attr">updateMode</span>: <span class="hljs-string">"All"</span> });
                                }
                                <span class="hljs-keyword">else</span> {
                                    modeList.push({
                                        <span class="hljs-attr">updateMode</span>: <span class="hljs-string">"BranchUpdate"</span>,
                                        <span class="hljs-attr">updateTarget</span>: <span class="hljs-keyword">this</span>._doGetUpdateTarget(updateItem.entityName, l.entityName),
                                    });
                                }
                            }
                            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (updateItem.entityName.indexOf(l.entityName + <span class="hljs-string">"."</span>) === <span class="hljs-number">0</span>) {
                               
                                modeList.push({ <span class="hljs-attr">updateMode</span>: <span class="hljs-string">"Single"</span> });
                                isSubChange = <span class="hljs-literal">true</span>;
                            }
                            <span class="hljs-keyword">else</span> {
                               
                                modeList.push({ <span class="hljs-attr">updateMode</span>: <span class="hljs-string">"All"</span> });
                                commonAncestry = <span class="hljs-literal">false</span>;
                            }
                        }
                        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (updateItem.type === <span class="hljs-string">"R"</span>) {
                           
                            <span class="hljs-keyword">if</span> (updateItem.entityName === l.entityName) {
                               
                                modeList.push({ <span class="hljs-attr">updateMode</span>: <span class="hljs-string">"All"</span> });
                            }
                            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (l.entityName.indexOf(updateItem.entityName + <span class="hljs-string">"."</span>) === <span class="hljs-number">0</span>) {
                               
                                modeList.push({
                                    <span class="hljs-attr">updateMode</span>: <span class="hljs-string">"BranchDelete"</span>,
                                    <span class="hljs-attr">updateTarget</span>: <span class="hljs-keyword">this</span>._doGetUpdateTarget(updateItem.entityName, l.entityName),
                                });
                            }
                            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (updateItem.entityName.indexOf(l.entityName + <span class="hljs-string">"."</span>) === <span class="hljs-number">0</span>) {
                               
                                modeList.push({ <span class="hljs-attr">updateMode</span>: <span class="hljs-string">"Single"</span> });
                                isSubChange = <span class="hljs-literal">true</span>;
                            }
                            <span class="hljs-keyword">else</span> {
                               
                                modeList.push({ <span class="hljs-attr">updateMode</span>: <span class="hljs-string">"All"</span> });
                                commonAncestry = <span class="hljs-literal">false</span>;
                            }
                        }
                        <span class="hljs-keyword">else</span> {
                           
                            <span class="hljs-keyword">if</span> (updateItem.entityName === l.entityName) {
                               
                                modeList.push({ <span class="hljs-attr">updateMode</span>: <span class="hljs-string">"All"</span> });
                            }
                            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (l.entityName.indexOf(updateItem.entityName + <span class="hljs-string">"."</span>) === <span class="hljs-number">0</span>) {
                               
                                modeList.push({ <span class="hljs-attr">updateMode</span>: <span class="hljs-string">"All"</span> });
                            }
                            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (updateItem.entityName.indexOf(l.entityName + <span class="hljs-string">"."</span>) === <span class="hljs-number">0</span>) {
                               
                                modeList.push({ <span class="hljs-attr">updateMode</span>: <span class="hljs-string">"Single"</span> });
                                isSubChange = <span class="hljs-literal">true</span>;
                            }
                            <span class="hljs-keyword">else</span> {
                               
                                modeList.push({ <span class="hljs-attr">updateMode</span>: <span class="hljs-string">"All"</span> });
                                commonAncestry = <span class="hljs-literal">false</span>;
                            }
                        }
                        <span class="hljs-keyword">if</span> (commonAncestry &amp;&amp; !isSubChange) {
                            modeList.push({ <span class="hljs-attr">updateMode</span>: updateItem.updateMode, <span class="hljs-attr">updateTarget</span>: updateItem.updateTarget });
                        }
                    }
                }
            }
        }
       
        <span class="hljs-keyword">var</span> a = <span class="hljs-string">"Single"</span>;
        <span class="hljs-keyword">var</span> at = <span class="hljs-string">""</span>;
        <span class="hljs-keyword">var</span> b;
        <span class="hljs-keyword">var</span> bt;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _f = <span class="hljs-number">0</span>, modeList_1 = modeList; _f &lt; modeList_1.length; _f++) {
            <span class="hljs-keyword">var</span> item = modeList_1[_f];
            b = item.updateMode;
            bt = item.updateTarget || <span class="hljs-string">""</span>;
            <span class="hljs-keyword">if</span> (a === b &amp;&amp; (a === <span class="hljs-string">"BranchDelete"</span> || a === <span class="hljs-string">"BranchUpdate"</span>)) {
                <span class="hljs-keyword">if</span> (at.length &gt; bt.length) {
                    at = bt;
                }
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (b === <span class="hljs-string">"BranchDelete"</span> || a === <span class="hljs-string">"Single"</span>) {
                a = b;
                at = bt;
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (a === <span class="hljs-string">"BranchDelete"</span> || b === <span class="hljs-string">"Single"</span>) {
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (b === <span class="hljs-string">"All"</span>) {
                a = b;
                at = bt;
            }
        }
        l.updateMode = a;
        l.updateTarget = at;
    };
    ExprList.prototype._doGetUpdateTarget = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">parent, me</span>) </span>{
        <span class="hljs-keyword">var</span> p = parent.split(<span class="hljs-string">"."</span>);
        <span class="hljs-keyword">var</span> m = me.split(<span class="hljs-string">"."</span>);
        p.push(m[p.length]);
        <span class="hljs-keyword">return</span> p.join(<span class="hljs-string">"."</span>);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-335">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-335">&#182;</a>
              </div>
              <p>重置表达式列表对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprList.prototype.reset = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">this</span>.list = [];
        <span class="hljs-keyword">this</span>.cache = {};
        <span class="hljs-keyword">this</span>.sorted = <span class="hljs-literal">false</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-336">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-336">&#182;</a>
              </div>
              <p>添加表达式</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprList.prototype.add = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">expr, entityName, propertyName, types, callback, scope</span>) </span>{
        <span class="hljs-keyword">this</span>.cache = {};
        <span class="hljs-keyword">this</span>.sorted = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">var</span> index = <span class="hljs-number">-1</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.list.length; i++) {
            <span class="hljs-keyword">var</span> item = <span class="hljs-keyword">this</span>.list[i];
            <span class="hljs-keyword">if</span> (item.expr === expr &amp;&amp; item.entityName === entityName &amp;&amp; item.propertyName === propertyName &amp;&amp;
                item.types === types &amp;&amp; item.callback === callback &amp;&amp; item.scope === scope) {
                index = i;
                <span class="hljs-keyword">break</span>;
            }
        }
        <span class="hljs-keyword">if</span> (index === <span class="hljs-number">-1</span>) {
            <span class="hljs-keyword">this</span>.list.push({
                <span class="hljs-attr">callback</span>: (callback),
                <span class="hljs-attr">entityName</span>: entityName || <span class="hljs-string">""</span>,
                <span class="hljs-attr">expr</span>: expr || <span class="hljs-string">""</span>,
                <span class="hljs-attr">fullName</span>: propertyName ? entityName + <span class="hljs-string">"."</span> + propertyName : entityName || <span class="hljs-string">""</span>,
                <span class="hljs-attr">propertyName</span>: propertyName || <span class="hljs-string">""</span>,
                <span class="hljs-attr">scope</span>: (scope),
                <span class="hljs-attr">types</span>: (types),
            });
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-337">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-337">&#182;</a>
              </div>
              <p>删除表达式</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprList.prototype.remove = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">expr, entityName, propertyName, types, callback, scope</span>) </span>{
        <span class="hljs-keyword">this</span>.cache = {};
        <span class="hljs-keyword">this</span>.sorted = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.list.length; i++) {
            <span class="hljs-keyword">var</span> item = <span class="hljs-keyword">this</span>.list[i];
            <span class="hljs-keyword">if</span> (item.expr === expr &amp;&amp; item.entityName === entityName &amp;&amp; item.propertyName === propertyName &amp;&amp;
                item.types === types &amp;&amp; item.callback === callback &amp;&amp; item.scope === scope) {
                <span class="hljs-keyword">this</span>.list.splice(i, <span class="hljs-number">1</span>);
                <span class="hljs-keyword">break</span>;
            }
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-338">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-338">&#182;</a>
              </div>
              <p>检查和排序表达式列表</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprList.prototype.checkAndSort = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">dependCallback</span>) </span>{
        <span class="hljs-keyword">this</span>.cache = {};
        <span class="hljs-keyword">this</span>.sorted = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">var</span> msg = <span class="hljs-string">""</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _i = <span class="hljs-number">0</span>, _a = <span class="hljs-keyword">this</span>.list; _i &lt; _a.length; _i++) {
            <span class="hljs-keyword">var</span> item = _a[_i];
            <span class="hljs-keyword">if</span> (!item.dependencies &amp;&amp; dependCallback) {
                <span class="hljs-keyword">var</span> d = dependCallback(item.expr, item.entityName);
                msg = d.errorMsg;
                <span class="hljs-keyword">if</span> (msg === <span class="hljs-string">""</span>) {
                    item.dependencies = d.dependencies;
                }
                <span class="hljs-keyword">else</span> {
                    msg = format(locale.getLocale().MSG_ES_PARSER, item.entityName, item.expr, msg);
                    <span class="hljs-keyword">break</span>;
                }
            }
        }
        <span class="hljs-keyword">if</span> (msg === <span class="hljs-string">""</span>) {
           
            <span class="hljs-keyword">var</span> fillList_1 = [];
            <span class="hljs-keyword">var</span> newList_1 = [];
            <span class="hljs-keyword">var</span> findItem_1 = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">list, item</span>) </span>{
                <span class="hljs-keyword">var</span> r = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _i = <span class="hljs-number">0</span>, list_2 = list; _i &lt; list_2.length; _i++) {
                    <span class="hljs-keyword">var</span> listItem = list_2[_i];
                    <span class="hljs-keyword">if</span> (listItem === item) {
                        r = <span class="hljs-literal">true</span>;
                    }
                }
                <span class="hljs-keyword">return</span> r;
            };
            <span class="hljs-keyword">var</span> depends_1 = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item, stack</span>) </span>{
                <span class="hljs-keyword">if</span> (!findItem_1(stack, item)) {
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _i = <span class="hljs-number">0</span>, fillList_2 = fillList_1; _i &lt; fillList_2.length; _i++) {
                        <span class="hljs-keyword">var</span> fillItem = fillList_2[_i];
                        <span class="hljs-keyword">var</span> f = <span class="hljs-literal">false</span>;
                        <span class="hljs-keyword">if</span> (item &amp;&amp; item.dependencies) {
                            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _a = <span class="hljs-number">0</span>, _b = item.dependencies; _a &lt; _b.length; _a++) {
                                <span class="hljs-keyword">var</span> dependency = _b[_a];
                                f = fillItem.fullName === dependency;
                                <span class="hljs-keyword">if</span> (f) {
                                    <span class="hljs-keyword">break</span>;
                                }
                            }
                        }
                        <span class="hljs-keyword">if</span> (f) {
                            stack.push(item);
                            depends_1(fillItem, stack);
                        }
                    }
                    <span class="hljs-keyword">if</span> (!findItem_1(newList_1, item)) {
                        newList_1.push(item);
                    }
                }
            };
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _b = <span class="hljs-number">0</span>, _c = <span class="hljs-keyword">this</span>.list; _b &lt; _c.length; _b++) {
                <span class="hljs-keyword">var</span> item = _c[_b];
                <span class="hljs-keyword">if</span> (item.fullName !== <span class="hljs-string">""</span>) {
                    fillList_1.push(item);
                }
            }
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _d = <span class="hljs-number">0</span>, fillList_3 = fillList_1; _d &lt; fillList_3.length; _d++) {
                <span class="hljs-keyword">var</span> fillItem = fillList_3[_d];
                depends_1(fillItem, []);
            }
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _e = <span class="hljs-number">0</span>, _f = <span class="hljs-keyword">this</span>.list; _e &lt; _f.length; _e++) {
                <span class="hljs-keyword">var</span> item = _f[_e];
                <span class="hljs-keyword">if</span> (item.fullName === <span class="hljs-string">""</span>) {
                    newList_1.push(item);
                }
            }
            <span class="hljs-keyword">this</span>.list = newList_1;
        }
        <span class="hljs-keyword">return</span> msg;
    };
    ExprList.prototype.getExprsByUpdate = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entityName, propertyName</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._getExprs(entityName, propertyName, <span class="hljs-string">"U"</span>);
    };
    ExprList.prototype.getExprsByLoad = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entityName</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._getExprs(entityName, <span class="hljs-string">""</span>, <span class="hljs-string">"L"</span>);
    };
    ExprList.prototype.getExprsByAdd = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entityName</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._getExprs(entityName, <span class="hljs-string">""</span>, <span class="hljs-string">"A"</span>);
    };
    ExprList.prototype.getExprsByRemove = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entityName</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._getExprs(entityName, <span class="hljs-string">""</span>, <span class="hljs-string">"R"</span>);
    };
    <span class="hljs-keyword">return</span> ExprList;
}());</pre></div></div>
            
        </li>
        
        
        <li id="section-339">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-339">&#182;</a>
              </div>
              <h2 id="-">多语言 - 中文</h2>

            </div>
            
        </li>
        
        
        <li id="section-340">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-340">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>locale.defineLocale(<span class="hljs-string">"zh-cn"</span>, {</pre></div></div>
            
        </li>
        
        
        <li id="section-341">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-341">&#182;</a>
              </div>
              <p>context</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    MSG_EC_FUNC_E: <span class="hljs-string">"只有实体对象才可以调用 {0} 方法"</span>,
    <span class="hljs-attr">MSG_EC_FUNC_P</span>: <span class="hljs-string">"{0} 没有名称为 {1} 的方法或参数不匹配"</span>,
    <span class="hljs-attr">MSG_EC_FUNC_T</span>: <span class="hljs-string">"{0} 没有与名称为 {1} 的相匹配的方法"</span>,
    <span class="hljs-attr">MSG_EC_PROP_E</span>: <span class="hljs-string">"{0} 无法获取属性: {1}"</span>,
    <span class="hljs-attr">MSG_EC_PROP_N</span>: <span class="hljs-string">"属性不存在: {0}"</span>,
    <span class="hljs-attr">MSG_EC_VARI_I</span>: <span class="hljs-string">"参数索引不存在: {0}"</span>,
    <span class="hljs-attr">MSG_EC_VARI_N</span>: <span class="hljs-string">"参数不存在: {0}"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-342">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-342">&#182;</a>
              </div>
              <p>funtion</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    MSG_EF_MODEL: <span class="hljs-string">"\"{0}\" 不是合法的匹配模式"</span>,
    <span class="hljs-attr">MSG_EF_STR_TO_DATE</span>: <span class="hljs-string">"\"{0}\" 无法被 \"{1}\" 格式化为日期时间"</span>,
    <span class="hljs-attr">MSG_EF_STR_TO_NUM</span>: <span class="hljs-string">"\"{0}\" 无法被转换为数字"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-343">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-343">&#182;</a>
              </div>
              <p>lexer</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    MSG_EL_SYNTAX_ON: <span class="hljs-string">"{0} 不是合法的八进制数"</span>,
    <span class="hljs-attr">MSG_EL_SYNTAX_S</span>: <span class="hljs-string">"{0} 引号不匹配"</span>,
    <span class="hljs-attr">MSG_EL_SYNTAX_UC</span>: <span class="hljs-string">"{0} 不是合法的unicode字符"</span>,
    <span class="hljs-attr">MSG_EL_SYNTAX_XN</span>: <span class="hljs-string">"{0} 不是合法的十六进制数"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-344">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-344">&#182;</a>
              </div>
              <p>parser</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    MSG_EP_EMPTY: <span class="hljs-string">"表达式不能为空"</span>,
    <span class="hljs-attr">MSG_EP_LEXICAL_B</span>: <span class="hljs-string">"{0} 无法作为表达式的开头"</span>,
    <span class="hljs-attr">MSG_EP_LEXICAL_E</span>: <span class="hljs-string">"{0} 无法作为表达式的结尾"</span>,
    <span class="hljs-attr">MSG_EP_LEXICAL_L</span>: <span class="hljs-string">"{0} 后不允许出现 {1}"</span>,
    <span class="hljs-attr">MSG_EP_MATCH</span>: <span class="hljs-string">"{0} 不匹配"</span>,
    <span class="hljs-attr">MSG_EP_SYNTAX_A</span>: <span class="hljs-string">"数组中不允许使用 {0} 操作符"</span>,
    <span class="hljs-attr">MSG_EP_SYNTAX_C</span>: <span class="hljs-string">"{0} 操作符必须存在于{}、[]、()中"</span>,
    <span class="hljs-attr">MSG_EP_SYNTAX_D</span>: <span class="hljs-string">"{0} 无法做属性访问操作"</span>,
    <span class="hljs-attr">MSG_EP_SYNTAX_E</span>: <span class="hljs-string">"{0} 前不允许表达式存在"</span>,
    <span class="hljs-attr">MSG_EP_SYNTAX_M</span>: <span class="hljs-string">"{0} 在不是函数参数列表时不允许出现\",\"分隔符"</span>,
    <span class="hljs-attr">MSG_EP_SYNTAX_N</span>: <span class="hljs-string">"该处 {0} 无意义"</span>,
    <span class="hljs-attr">MSG_EP_SYNTAX_O</span>: <span class="hljs-string">"对象书写格式不正确"</span>,
    <span class="hljs-attr">MSG_EP_SYNTAX_P</span>: <span class="hljs-string">"{0} 操作符必须存在于{}中"</span>,
    <span class="hljs-attr">MSG_EP_SYNTAX_SUB</span>: <span class="hljs-string">"[]用作下标访问时不允许出现 {0} 分隔符"</span>,
    <span class="hljs-attr">MSG_EP_UNKNOWN</span>: <span class="hljs-string">"无法识别 {0}"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-345">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-345">&#182;</a>
              </div>
              <p>list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    MSG_ES_PARSER: <span class="hljs-string">"作用于实体“{0}”上的表达式“{1}”解析出错：{2}"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-346">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-346">&#182;</a>
              </div>
              <p>type &amp; value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    MSG_EX_ADD: <span class="hljs-string">"{0} 和 {1} 无法做加法运算"</span>,
    <span class="hljs-attr">MSG_EX_AND</span>: <span class="hljs-string">"{0} 和 {1} 无法做逻辑与运算"</span>,
    <span class="hljs-attr">MSG_EX_AND_L</span>: <span class="hljs-string">"{0} 无法做逻辑与运算的左运算数"</span>,
    <span class="hljs-attr">MSG_EX_COMPARE_A</span>: <span class="hljs-string">"{0} 和 {1} 无法做大于运算"</span>,
    <span class="hljs-attr">MSG_EX_COMPARE_B</span>: <span class="hljs-string">"{0} 和 {1} 无法做小于运算"</span>,
    <span class="hljs-attr">MSG_EX_COMPARE_C</span>: <span class="hljs-string">"{0} 和 {1} 无法做大于等于运算"</span>,
    <span class="hljs-attr">MSG_EX_COMPARE_D</span>: <span class="hljs-string">"{0} 和 {1} 无法做小于等于运算"</span>,
    <span class="hljs-attr">MSG_EX_DIVIDE</span>: <span class="hljs-string">"{0} 和 {1} 无法做除法运算"</span>,
    <span class="hljs-attr">MSG_EX_DIVIDE_N</span>: <span class="hljs-string">"{0} 不能作为除数使用"</span>,
    <span class="hljs-attr">MSG_EX_DOT</span>: <span class="hljs-string">"{0} 无法做属性访问操作"</span>,
    <span class="hljs-attr">MSG_EX_EQUAL</span>: <span class="hljs-string">"{0} 和 {1} 无法做相等运算"</span>,
    <span class="hljs-attr">MSG_EX_EQUAL_N</span>: <span class="hljs-string">"{0} 和 {1} 无法做不等运算"</span>,
    <span class="hljs-attr">MSG_EX_FUNC_NULL</span>: <span class="hljs-string">"null 不能调用 {0} 方法"</span>,
    <span class="hljs-attr">MSG_EX_LN</span>: <span class="hljs-string">"{0} 无法做自然对数运算"</span>,
    <span class="hljs-attr">MSG_EX_LOG</span>: <span class="hljs-string">"无法做以 {0} 为底 {1} 的对数运算"</span>,
    <span class="hljs-attr">MSG_EX_MULTIPLY</span>: <span class="hljs-string">"{0} 和 {1} 无法做乘法运算"</span>,
    <span class="hljs-attr">MSG_EX_NEGATIVE</span>: <span class="hljs-string">"{0} 无法做一元负数运算"</span>,
    <span class="hljs-attr">MSG_EX_OR</span>: <span class="hljs-string">"{0} 和 {1} 无法做逻辑或运算"</span>,
    <span class="hljs-attr">MSG_EX_OR_L</span>: <span class="hljs-string">"{0} 无法做逻辑或运算的左运算数"</span>,
    <span class="hljs-attr">MSG_EX_POSITIVE</span>: <span class="hljs-string">"{0} 无法做一元正数运算"</span>,
    <span class="hljs-attr">MSG_EX_REMAINDER</span>: <span class="hljs-string">"{0} 和 {1} 无法做余数运算"</span>,
    <span class="hljs-attr">MSG_EX_REMAINDER_N</span>: <span class="hljs-string">"{0} 不能作为除数使用"</span>,
    <span class="hljs-attr">MSG_EX_ROUND</span>: <span class="hljs-string">"做四舍五入运算时，保留小数位数不能为负数: {0}"</span>,
    <span class="hljs-attr">MSG_EX_SUBSCRIPT</span>: <span class="hljs-string">"{0} 无法做下标操作"</span>,
    <span class="hljs-attr">MSG_EX_SUBSCRIPT_T</span>: <span class="hljs-string">"下标必须为数字: {0}"</span>,
    <span class="hljs-attr">MSG_EX_SUBSCRIPT_U</span>: <span class="hljs-string">"{0} 下标越界: {1}"</span>,
    <span class="hljs-attr">MSG_EX_SUBTRACT</span>: <span class="hljs-string">"{0} 和 {1} 无法做减法运算"</span>,
    <span class="hljs-attr">MSG_EX_TRUNC</span>: <span class="hljs-string">"做截断运算时，保留小数位数不能为负数: {0}"</span>,
});</pre></div></div>
            
        </li>
        
        
        <li id="section-347">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-347">&#182;</a>
              </div>
              <p>函数描述</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>locale.defineFunction(<span class="hljs-string">"zh-cn"</span>, {
    <span class="hljs-string">"FieldDisplayName"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取当前字段别名"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"字段别名（显示名称）"</span> },
    <span class="hljs-string">"FieldName"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取当前字段唯一标识"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"字段唯一标识"</span> },
    <span class="hljs-string">"FieldValue"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取当前字段值"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"字段值"</span> },
    <span class="hljs-string">"IIf"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"条件判断函数，如果第一个参数为true，则获取第二个参数，否则获取第三个参数"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"条件值"</span>, <span class="hljs-string">"真值"</span>, <span class="hljs-string">"假值"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"第二个参数或第三个参数"</span> },
    <span class="hljs-string">"IfNull"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"空值判断函数，如果第一个参数为null，则获取第二个参数，否则获取第一个参数"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"值"</span>, <span class="hljs-string">"默认值"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"第一个参数或第二个参数"</span> },
    <span class="hljs-string">"Now"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取本地当前日期时间"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"本地当前日期时间"</span> },
    <span class="hljs-string">"Parent"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取当前实体的父实体对象，如果当前为根则获取自己"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"父实体对象"</span> },
    <span class="hljs-string">"PropValue"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取对象属性值"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"对象或数组(没有分隔符则获取数组第一个元素，有分隔符获取数组所有元素集合)"</span>, <span class="hljs-string">"属性名"</span>, <span class="hljs-string">"分隔符?"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"属性值"</span> },
    <span class="hljs-string">"Random"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"返回介于 0 ~ 1 之间的一个随机数"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"数字"</span> },
    <span class="hljs-string">"RecNo"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取当前实体的索引号，没有记录返回-1"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"索引号"</span> },
    <span class="hljs-string">"Root"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取实体根对象"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"实体根对象"</span> },
    <span class="hljs-string">"array.Average"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取集合元素的平均值"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"表达式?"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"平均值"</span> },
    <span class="hljs-string">"array.Count"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取集合元素个数"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"个数"</span> },
    <span class="hljs-string">"array.Distinct"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取集合中唯一元素的集合"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"表达式?"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"集合"</span> },
    <span class="hljs-string">"array.Max"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取集合元素的最大值"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"表达式?"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"最大值"</span> },
    <span class="hljs-string">"array.Min"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取集合元素的最小值"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"表达式?"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"最小值"</span> },
    <span class="hljs-string">"array.Sum"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取集合元素的合计值"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"表达式?"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"合计值"</span> },
    <span class="hljs-string">"array.Where"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取满足条件的元素集合"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"条件表达式"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"集合"</span> },
    <span class="hljs-string">"boolean.ToString"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"转换布尔类型为字符串"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"字符串"</span> },
    <span class="hljs-string">"date.DateOf"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取 Date 对象的日期部分"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"日期"</span> },
    <span class="hljs-string">"date.DayOf"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"从 Date 对象获取一个月中的某一天（1 ~ 31）"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"日"</span> },
    <span class="hljs-string">"date.DayOfWeek"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"得到一周中的星期几（0 ~ 6）"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"周"</span> },
    <span class="hljs-string">"date.DaysBetween"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取日期差"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"结束日期时间"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"日差"</span> },
    <span class="hljs-string">"date.HourOf"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"从 Date 对象获取一天中的第几个小时"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"时"</span> },
    <span class="hljs-string">"date.HoursBetween"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取小时差"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"结束日期时间"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"时差"</span> },
    <span class="hljs-string">"date.IncDay"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"增加指定的天数"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"天数"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"日期时间"</span> },
    <span class="hljs-string">"date.IncHour"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"增加指定的小时数"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"小时数"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"日期时间"</span> },
    <span class="hljs-string">"date.IncMinute"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"增加指定的分钟数"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"分钟数"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"日期时间"</span> },
    <span class="hljs-string">"date.IncMonth"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"增加指定的月数"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"月数"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"日期时间"</span> },
    <span class="hljs-string">"date.IncSecond"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"增加指定的秒数"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"秒数"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"日期时间"</span> },
    <span class="hljs-string">"date.IncWeek"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"增加指定的周数"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"周数"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"日期时间"</span> },
    <span class="hljs-string">"date.IncYear"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"增加指定的年数"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"年数"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"日期时间"</span> },
    <span class="hljs-string">"date.MilliSecondOf"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"从 Date 对象获取毫秒"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"毫秒"</span> },
    <span class="hljs-string">"date.MilliSecondsBetween"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取毫秒差"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"结束日期时间"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"毫秒差"</span> },
    <span class="hljs-string">"date.MinuteOf"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"从 Date 对象获取分钟（0 ~ 59）"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"分"</span> },
    <span class="hljs-string">"date.MinutesBetween"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取分钟差"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"结束日期时间"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"分差"</span> },
    <span class="hljs-string">"date.MonthOf"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"从 Date 对象获取月份（1 ~ 12）"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"月"</span> },
    <span class="hljs-string">"date.MonthsBetween"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取月份差"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"结束日期时间"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"月差"</span> },
    <span class="hljs-string">"date.SecondOf"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"从 Date 对象获取秒数（0 ~ 59）"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"秒"</span> },
    <span class="hljs-string">"date.SecondsBetween"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取秒差"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"结束日期时间"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"秒差"</span> },
    <span class="hljs-string">"date.ToString"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"转换日期时间类型为字符串"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"日期时间格式?"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"字符串"</span> },
    <span class="hljs-string">"date.WeekOf"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"从 Date 对象获取一年中的第几周（1 ~ 53）"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"周"</span> },
    <span class="hljs-string">"date.WeeksBetween"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取周差"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"结束日期时间"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"周差"</span> },
    <span class="hljs-string">"date.YearOf"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"从 Date 对象获取年份"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"年"</span> },
    <span class="hljs-string">"date.YearsBetween"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取年差"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"结束日期时间"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"年差"</span> },
    <span class="hljs-string">"number.Abs"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取数的绝对值"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"绝对值"</span> },
    <span class="hljs-string">"number.Ceil"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"对数进行向上取整"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"数值"</span> },
    <span class="hljs-string">"number.Cos"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取数的余弦"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"余弦"</span> },
    <span class="hljs-string">"number.Exp"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取 e 的指数"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"指数"</span> },
    <span class="hljs-string">"number.Floor"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"对数进行向下取整"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"数值"</span> },
    <span class="hljs-string">"number.Ln"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取数的自然对数（底为 e）"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"自然对数"</span> },
    <span class="hljs-string">"number.Log"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取数的指定底数的对数"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"底数"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"对数"</span> },
    <span class="hljs-string">"number.Power"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取数的指定指数的次幂"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"指数"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"次幂"</span> },
    <span class="hljs-string">"number.Round"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"根据保留的小数位数对数四舍五入"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"保留小数位数"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"数值"</span> },
    <span class="hljs-string">"number.Sin"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取数的正弦"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"正弦"</span> },
    <span class="hljs-string">"number.Sqrt"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取数的平方根"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"平方根"</span> },
    <span class="hljs-string">"number.Tan"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取树的正切值"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"正切值"</span> },
    <span class="hljs-string">"number.ToRMB"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取人民币大写"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"是否人民币(默认true)?"</span>, <span class="hljs-string">"是否大写(默认true)?"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"人民币大写"</span> },
    <span class="hljs-string">"number.ToString"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"转换数字类型为字符串"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"字符串"</span> },
    <span class="hljs-string">"number.Trunc"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"根据保留的小数位数对数进行截断"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"保留小数位数"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"数值"</span> },
    <span class="hljs-string">"object.Parent"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取父实体对象，如果当前为根则获取自己"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"父实体对象"</span> },
    <span class="hljs-string">"object.RecNo"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取当前实体的索引号，没有实体返回-1"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"索引号"</span> },
    <span class="hljs-string">"string.LeftString"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取字符串的左子字符串，指定长度"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"长度"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"子字符串"</span> },
    <span class="hljs-string">"string.Length"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取字符串长度"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"字符串长度"</span> },
    <span class="hljs-string">"string.Lower"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"转换字符串为小写"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"小写字符串"</span> },
    <span class="hljs-string">"string.Pos"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"检索字符串，获取子字符串在字符串中的起始位置"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"子字符串"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"位置索引"</span> },
    <span class="hljs-string">"string.Replace"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"字符串替换"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"被搜索的子字符串"</span>, <span class="hljs-string">"用于替换的子字符串"</span>, <span class="hljs-string">"匹配模式?"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"替换后的新字符串"</span> },
    <span class="hljs-string">"string.ReplaceReg"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"正则替换"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"用于匹配子字符串的正则表达式"</span>, <span class="hljs-string">"用于替换的子字符串"</span>, <span class="hljs-string">"匹配模式?"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"替换后的新字符串"</span> },
    <span class="hljs-string">"string.RightString"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取字符串的右子字符串，指定长度"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"长度"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"子字符串"</span> },
    <span class="hljs-string">"string.SubString"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"获取字符串的子字符串，指定开始位置和长度"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"开始位置"</span>, <span class="hljs-string">"长度"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"子字符串"</span> },
    <span class="hljs-string">"string.ToDate"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"转换字符串类型为日期时间"</span>, <span class="hljs-attr">p</span>: [<span class="hljs-string">"日期时间格式?"</span>], <span class="hljs-attr">r</span>: <span class="hljs-string">"日期时间"</span> },
    <span class="hljs-string">"string.ToNumber"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"转换字符串类型为数字"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"数字"</span> },
    <span class="hljs-string">"string.ToString"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"转换字符串类型为字符串"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"字符串"</span> },
    <span class="hljs-string">"string.Trim"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"去除字符串两端空格"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"字符串"</span> },
    <span class="hljs-string">"string.TrimLeft"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"去除字符串左端空格"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"字符串"</span> },
    <span class="hljs-string">"string.TrimRight"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"去除字符串右端空格"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"字符串"</span> },
    <span class="hljs-string">"string.Upper"</span>: { <span class="hljs-attr">fn</span>: <span class="hljs-string">"转换字符串为大写"</span>, <span class="hljs-attr">p</span>: [], <span class="hljs-attr">r</span>: <span class="hljs-string">"大写字符串"</span> },
});</pre></div></div>
            
        </li>
        
        
        <li id="section-348">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-348">&#182;</a>
              </div>
              <h2 id="-">表达式管理器</h2>

            </div>
            
        </li>
        
        
        <li id="section-349">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-349">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> ExprManager = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-350">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-350">&#182;</a>
              </div>
              <p>构造函数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ExprManager</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">this</span>.exprContext = <span class="hljs-keyword">new</span> ExprContext();
        <span class="hljs-keyword">this</span>.exprList = <span class="hljs-keyword">new</span> ExprList();
        <span class="hljs-keyword">this</span>.addFunction(func);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-351">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-351">&#182;</a>
              </div>
              <p>注册函数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprManager.prototype.addFunction = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">funcs</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.exprContext.addFunction(funcs);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-352">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-352">&#182;</a>
              </div>
              <p>获取函数列表对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprManager.prototype.getFunction = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.exprContext.getFunction();
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-353">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-353">&#182;</a>
              </div>
              <p>获取表达式列表对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprManager.prototype.getExpressionList = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.exprList;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-354">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-354">&#182;</a>
              </div>
              <p>检查和排序表达式列表</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprManager.prototype.checkAndSort = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.exprList.checkAndSort((<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context</span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">expr, entityName</span>) </span>{
            <span class="hljs-keyword">return</span> context.calcEntityDependencies(expr, entityName);
        }; })(<span class="hljs-keyword">this</span>.exprContext));
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-355">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-355">&#182;</a>
              </div>
              <p>添加表达式</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprManager.prototype.addExpression = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">expr, entityName, propertyName, types, callback, scope</span>) </span>{
       
        <span class="hljs-keyword">this</span>.exprList.add(expr, entityName, propertyName, types, callback, scope);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-356">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-356">&#182;</a>
              </div>
              <p>删除表达式</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprManager.prototype.removeExpression = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">expr, entityName, propertyName, types, callback, scope</span>) </span>{
       
        <span class="hljs-keyword">this</span>.exprList.remove(expr, entityName, propertyName, types, callback, scope);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-357">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-357">&#182;</a>
              </div>
              <p>重置表达式列表对象</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprManager.prototype.resetExpression = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">this</span>.exprList.reset();
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-358">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-358">&#182;</a>
              </div>
              <p>计算表达式</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprManager.prototype.calcExpression = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">type, info</span>) </span>{
        <span class="hljs-keyword">var</span> list;
        <span class="hljs-keyword">switch</span> (type) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">"load"</span>:
                list = <span class="hljs-keyword">this</span>.exprList.getExprsByLoad(info.entityName);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"add"</span>:
                list = <span class="hljs-keyword">this</span>.exprList.getExprsByAdd(info.entityName);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"update"</span>:
                list = <span class="hljs-keyword">this</span>.exprList.getExprsByUpdate(info.entityName, info.propertyName);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"remove"</span>:
                list = <span class="hljs-keyword">this</span>.exprList.getExprsByRemove(info.entityName);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">break</span>;
        }
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _i = <span class="hljs-number">0</span>, list_1 = list; _i &lt; list_1.length; _i++) {
            <span class="hljs-keyword">var</span> item = list_1[_i];
            info.exprInfo = item;
            item.callback.call(item.scope, type, info);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-359">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-359">&#182;</a>
              </div>
              <p>初始化</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprManager.prototype.init = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data, dataContext, context</span>) </span>{
        <span class="hljs-keyword">this</span>.exprContext.setData(data);
        <span class="hljs-keyword">this</span>.exprContext.setDataContext(dataContext);
        <span class="hljs-keyword">this</span>.exprContext.setPageContext(context || {});
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-360">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-360">&#182;</a>
              </div>
              <p>计算表达式的依赖关系</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprManager.prototype.calcDependencies = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">expr, entityName</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.exprContext.calcEntityDependencies(expr, entityName);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-361">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-361">&#182;</a>
              </div>
              <p>计算表达式的值</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprManager.prototype.calcExpr = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">expr, entityName, dataCursor, field</span>) </span>{
       
        <span class="hljs-keyword">this</span>.exprContext.setDataCursor(dataCursor);
        <span class="hljs-keyword">if</span> (field) {
            <span class="hljs-keyword">this</span>.exprContext.pushContextVariables(field);
        }
        <span class="hljs-keyword">var</span> r = <span class="hljs-keyword">this</span>.exprContext.calcEntityExpr(expr, entityName, dataCursor[entityName]);
        <span class="hljs-keyword">if</span> (field) {
            <span class="hljs-keyword">this</span>.exprContext.popContextVariables();
        }
        <span class="hljs-keyword">return</span> r;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-362">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-362">&#182;</a>
              </div>
              <p>计算表达式的值</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ExprManager.prototype.calc = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">expr, data</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.exprContext.calcDataExpr(expr, data);
    };
    <span class="hljs-keyword">return</span> ExprManager;
}());

<span class="hljs-keyword">return</span> ExprManager;

})));</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
